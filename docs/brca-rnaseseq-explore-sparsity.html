<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 7 BrCa RNA-Seq: Exploring Sparsity | DNA Hydroxymethylation in Hepatocellular Carcinoma</title>
  <meta name="description" content="Data from Cai et al. (2019) paper are explored" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 7 BrCa RNA-Seq: Exploring Sparsity | DNA Hydroxymethylation in Hepatocellular Carcinoma" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Data from Cai et al. (2019) paper are explored" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 7 BrCa RNA-Seq: Exploring Sparsity | DNA Hydroxymethylation in Hepatocellular Carcinoma" />
  
  <meta name="twitter:description" content="Data from Cai et al. (2019) paper are explored" />
  

<meta name="author" content="Francois Collin" />


<meta name="date" content="2020-01-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="brca-rnaseq-preproc.html"/>
<link rel="next" href="brca-rnaseq-model-suite.html"/>
<script src="libs/header-attrs-2.2/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script type="text/javascript">
// source:https://stackoverflow.com/questions/45360998/code-folding-in-bookdown
// toggle visibility of R source blocks in R Markdown output
function toggle_R() {
  var x = document.getElementsByClassName('r');
  if (x.length == 0) return;
  function toggle_vis(o) {
    var d = o.style.display;
    o.style.display = (d == 'block' || d == '') ? 'none':'block';
  }

  for (i = 0; i < x.length; i++) {
    var y = x[i];
    if (y.tagName.toLowerCase() === 'pre') toggle_vis(y);
  }

    var elem = document.getElementById("myButton1");
    if (elem.value === "Hide Global") elem.value = "Show Global";
    else elem.value = "Hide Global";
}

document.write('<input onclick="toggle_R();" type="button" value="Hide Global" id="myButton1" style="position: absolute; top: 10%; right: 2%; z-index: 200"></input>')

</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">DNA Hydroxymethylation in Hepatocellular Carcinoma</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preamble</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="modeling-background.html"><a href="modeling-background.html"><i class="fa fa-check"></i><b>2</b> Classification Analysis in the <code>n &lt;&lt; p</code> Context</a>
<ul>
<li class="chapter" data-level="2.1" data-path="modeling-background.html"><a href="modeling-background.html#caret-for-model-evaluation"><i class="fa fa-check"></i><b>2.1</b> caret for model evaluation</a></li>
<li class="chapter" data-level="2.2" data-path="modeling-background.html"><a href="modeling-background.html#the-glmnet-r-package"><i class="fa fa-check"></i><b>2.2</b> The <code>glmnet</code> R package</a>
<ul>
<li><a href="modeling-background.html#alpha-hyper-parameter"><strong>alpha</strong> hyper-parameter</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="modeling-background.html"><a href="modeling-background.html#signal-to-noise"><i class="fa fa-check"></i><b>2.3</b> Signal-to-noise Ratio</a></li>
<li class="chapter" data-level="2.4" data-path="modeling-background.html"><a href="modeling-background.html#lasso-vs-best-sub"><i class="fa fa-check"></i><b>2.4</b> Lasso vs Best Subset</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="hcc-5hmcseq-preproc.html"><a href="hcc-5hmcseq-preproc.html"><i class="fa fa-check"></i><b>3</b> HCC 5hmC-Seq : Preprocessing</a>
<ul>
<li class="chapter" data-level="3.1" data-path="hcc-5hmcseq-preproc.html"><a href="hcc-5hmcseq-preproc.html#load-the-data"><i class="fa fa-check"></i><b>3.1</b> Load the data</a></li>
<li class="chapter" data-level="3.2" data-path="hcc-5hmcseq-preproc.html"><a href="hcc-5hmcseq-preproc.html#dra"><i class="fa fa-check"></i><b>3.2</b> Differential representation analysis</a>
<ul>
<li class="chapter" data-level="" data-path="hcc-5hmcseq-preproc.html"><a href="hcc-5hmcseq-preproc.html#remove-lowly-expressed-genes"><i class="fa fa-check"></i>Remove lowly expressed genes</a></li>
<li class="chapter" data-level="" data-path="hcc-5hmcseq-preproc.html"><a href="hcc-5hmcseq-preproc.html#creating-a-design-matrix-and-contrasts"><i class="fa fa-check"></i>Creating a design matrix and contrasts</a></li>
<li class="chapter" data-level="" data-path="hcc-5hmcseq-preproc.html"><a href="hcc-5hmcseq-preproc.html#removing-heteroscedasticity-from-the-count-data"><i class="fa fa-check"></i>Removing heteroscedasticity from the count data</a></li>
<li class="chapter" data-level="" data-path="hcc-5hmcseq-preproc.html"><a href="hcc-5hmcseq-preproc.html#fit-linear-models-and-examine-the-results"><i class="fa fa-check"></i>Fit linear models and examine the results</a></li>
<li class="chapter" data-level="" data-path="hcc-5hmcseq-preproc.html"><a href="hcc-5hmcseq-preproc.html#graphical-representations-of-de-results-md-plots"><i class="fa fa-check"></i>Graphical representations of DE results: MD Plots</a></li>
<li class="chapter" data-level="" data-path="hcc-5hmcseq-preproc.html"><a href="hcc-5hmcseq-preproc.html#de-genes-at-10-fold-change"><i class="fa fa-check"></i>DE genes at 10% fold change</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="hcc-5hmcseq-preproc.html"><a href="hcc-5hmcseq-preproc.html#snr-regime"><i class="fa fa-check"></i><b>3.3</b> Signal-to-noise ratio regime</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="hcc-5hmcseq-explore-sparsity.html"><a href="hcc-5hmcseq-explore-sparsity.html"><i class="fa fa-check"></i><b>4</b> HCC 5hmC-Seq: Exploring Sparsity</a>
<ul>
<li class="chapter" data-level="4.1" data-path="hcc-5hmcseq-explore-sparsity.html"><a href="hcc-5hmcseq-explore-sparsity.html#cross-validation-analysis-setup"><i class="fa fa-check"></i><b>4.1</b> Cross-validation analysis setup</a></li>
<li class="chapter" data-level="4.2" data-path="hcc-5hmcseq-explore-sparsity.html"><a href="hcc-5hmcseq-explore-sparsity.html#fit-and-compare-models"><i class="fa fa-check"></i><b>4.2</b> Fit and compare models</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="hcc-5hmcseq-explore-sparsity.html"><a href="hcc-5hmcseq-explore-sparsity.html#logistic-regression-in-glmnet"><i class="fa fa-check"></i><b>4.2.1</b> Logistic regression in <code>glmnet</code></a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="hcc-5hmcseq-explore-sparsity.html"><a href="hcc-5hmcseq-explore-sparsity.html#the-relaxed-lasso-and-blended-mix-models"><i class="fa fa-check"></i><b>4.3</b> The relaxed lasso and blended mix models</a></li>
<li class="chapter" data-level="4.4" data-path="hcc-5hmcseq-explore-sparsity.html"><a href="hcc-5hmcseq-explore-sparsity.html#examination-of-sensitivity-vs-specificity"><i class="fa fa-check"></i><b>4.4</b> Examination of sensitivity vs specificity</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="hcc-5hmcseq-explore-sparsity.html"><a href="hcc-5hmcseq-explore-sparsity.html#training-data-out-of-fold-roc-curves"><i class="fa fa-check"></i><b>4.4.1</b> Training data out-of-fold ROC curves</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="hcc-5hmcseq-explore-sparsity.html"><a href="hcc-5hmcseq-explore-sparsity.html#compare-predictions-at-misclassified-samples"><i class="fa fa-check"></i><b>4.5</b> Compare predictions at misclassified samples</a></li>
<li class="chapter" data-level="4.6" data-path="hcc-5hmcseq-explore-sparsity.html"><a href="hcc-5hmcseq-explore-sparsity.html#compare-coefficient-profiles"><i class="fa fa-check"></i><b>4.6</b> Compare coefficient profiles</a></li>
<li class="chapter" data-level="4.7" data-path="hcc-5hmcseq-explore-sparsity.html"><a href="hcc-5hmcseq-explore-sparsity.html#examine-feature-selection"><i class="fa fa-check"></i><b>4.7</b> Examine feature selection</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="hcc-5hmcseq-model-suite.html"><a href="hcc-5hmcseq-model-suite.html"><i class="fa fa-check"></i><b>5</b> HCC 5hmC-Seq: Sample size investigation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="hcc-5hmcseq-model-suite.html"><a href="hcc-5hmcseq-model-suite.html#full-data-set-fit"><i class="fa fa-check"></i><b>5.1</b> Full data set fit</a>
<ul>
<li class="chapter" data-level="" data-path="hcc-5hmcseq-model-suite.html"><a href="hcc-5hmcseq-model-suite.html#get-sample-consistency-scores"><i class="fa fa-check"></i>Get sample consistency scores</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="hcc-5hmcseq-model-suite.html"><a href="hcc-5hmcseq-model-suite.html#selected-feature-list-stability"><i class="fa fa-check"></i><b>5.2</b> Selected feature list stability</a></li>
<li class="chapter" data-level="5.3" data-path="hcc-5hmcseq-model-suite.html"><a href="hcc-5hmcseq-model-suite.html#simulation-design"><i class="fa fa-check"></i><b>5.3</b> Simulation Design</a></li>
<li class="chapter" data-level="5.4" data-path="hcc-5hmcseq-model-suite.html"><a href="hcc-5hmcseq-model-suite.html#setup-simulation"><i class="fa fa-check"></i><b>5.4</b> Setup simulation</a></li>
<li class="chapter" data-level="5.5" data-path="hcc-5hmcseq-model-suite.html"><a href="hcc-5hmcseq-model-suite.html#run-simulations"><i class="fa fa-check"></i><b>5.5</b> Run simulations</a></li>
<li class="chapter" data-level="5.6" data-path="hcc-5hmcseq-model-suite.html"><a href="hcc-5hmcseq-model-suite.html#simulation-results"><i class="fa fa-check"></i><b>5.6</b> Simulation results</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="hcc-5hmcseq-model-suite.html"><a href="hcc-5hmcseq-model-suite.html#simulation-results---look-at-one-simulation"><i class="fa fa-check"></i><b>5.6.1</b> Simulation Results - look at one simulation</a></li>
<li class="chapter" data-level="5.6.2" data-path="hcc-5hmcseq-model-suite.html"><a href="hcc-5hmcseq-model-suite.html#summarize-results-across-simulation-runs."><i class="fa fa-check"></i><b>5.6.2</b> Summarize results across simulation runs.</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="hcc-5hmcseq-model-suite.html"><a href="hcc-5hmcseq-model-suite.html#effect-of-sample-consistency"><i class="fa fa-check"></i><b>5.7</b> Effect of sample consistency</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="brca-rnaseq-preproc.html"><a href="brca-rnaseq-preproc.html"><i class="fa fa-check"></i><b>6</b> BrCa RNA-Seq: Preprocessing</a>
<ul>
<li class="chapter" data-level="6.1" data-path="brca-rnaseq-preproc.html"><a href="brca-rnaseq-preproc.html#load-the-data-1"><i class="fa fa-check"></i><b>6.1</b> Load the data</a></li>
<li class="chapter" data-level="6.2" data-path="brca-rnaseq-preproc.html"><a href="brca-rnaseq-preproc.html#breast-rnaseq-dra"><i class="fa fa-check"></i><b>6.2</b> Differential representation analysis</a>
<ul>
<li class="chapter" data-level="" data-path="brca-rnaseq-preproc.html"><a href="brca-rnaseq-preproc.html#remove-lowly-expressed-genes-1"><i class="fa fa-check"></i>Remove lowly expressed genes</a></li>
<li class="chapter" data-level="" data-path="brca-rnaseq-preproc.html"><a href="brca-rnaseq-preproc.html#creating-a-design-matrix-and-contrasts-1"><i class="fa fa-check"></i>Creating a design matrix and contrasts</a></li>
<li class="chapter" data-level="" data-path="brca-rnaseq-preproc.html"><a href="brca-rnaseq-preproc.html#fit-linear-models-and-examine-the-results-1"><i class="fa fa-check"></i>Fit linear models and examine the results</a></li>
<li class="chapter" data-level="" data-path="brca-rnaseq-preproc.html"><a href="brca-rnaseq-preproc.html#graphical-representations-of-de-results-md-plots-1"><i class="fa fa-check"></i>Graphical representations of DE results: MD Plots</a></li>
<li class="chapter" data-level="" data-path="brca-rnaseq-preproc.html"><a href="brca-rnaseq-preproc.html#de-genes-at-10-fold-change-1"><i class="fa fa-check"></i>DE genes at 10% fold change</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="brca-rnaseq-preproc.html"><a href="brca-rnaseq-preproc.html#breast-rnaseq-snr-regime"><i class="fa fa-check"></i><b>6.3</b> Signal-to-noise ratio regime</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="brca-rnaseseq-explore-sparsity.html"><a href="brca-rnaseseq-explore-sparsity.html"><i class="fa fa-check"></i><b>7</b> BrCa RNA-Seq: Exploring Sparsity</a>
<ul>
<li class="chapter" data-level="7.1" data-path="brca-rnaseseq-explore-sparsity.html"><a href="brca-rnaseseq-explore-sparsity.html#cross-validation-analysis-setup-1"><i class="fa fa-check"></i><b>7.1</b> Cross-validation analysis setup</a></li>
<li class="chapter" data-level="7.2" data-path="brca-rnaseseq-explore-sparsity.html"><a href="brca-rnaseseq-explore-sparsity.html#fit-and-compare-models-1"><i class="fa fa-check"></i><b>7.2</b> Fit and compare models</a></li>
<li class="chapter" data-level="7.3" data-path="brca-rnaseseq-explore-sparsity.html"><a href="brca-rnaseseq-explore-sparsity.html#the-relaxed-lasso-and-blended-mix-models-1"><i class="fa fa-check"></i><b>7.3</b> The relaxed lasso and blended mix models</a></li>
<li class="chapter" data-level="7.4" data-path="brca-rnaseseq-explore-sparsity.html"><a href="brca-rnaseseq-explore-sparsity.html#examination-of-sensitivity-vs-specificity-1"><i class="fa fa-check"></i><b>7.4</b> Examination of sensitivity vs specificity</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="brca-rnaseseq-explore-sparsity.html"><a href="brca-rnaseseq-explore-sparsity.html#training-data-out-of-fold-roc-curves-1"><i class="fa fa-check"></i><b>7.4.1</b> Training data out-of-fold ROC curves</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="brca-rnaseseq-explore-sparsity.html"><a href="brca-rnaseseq-explore-sparsity.html#compare-predictions-at-misclassified-samples-1"><i class="fa fa-check"></i><b>7.5</b> Compare predictions at misclassified samples</a></li>
<li class="chapter" data-level="7.6" data-path="brca-rnaseseq-explore-sparsity.html"><a href="brca-rnaseseq-explore-sparsity.html#compare-coefficient-profiles-1"><i class="fa fa-check"></i><b>7.6</b> Compare coefficient profiles</a></li>
<li class="chapter" data-level="7.7" data-path="brca-rnaseseq-explore-sparsity.html"><a href="brca-rnaseseq-explore-sparsity.html#examine-feature-selection-1"><i class="fa fa-check"></i><b>7.7</b> Examine feature selection</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="brca-rnaseq-model-suite.html"><a href="brca-rnaseq-model-suite.html"><i class="fa fa-check"></i><b>8</b> BrCa RNA-Seq: Sample size investigation</a>
<ul>
<li class="chapter" data-level="8.1" data-path="brca-rnaseq-model-suite.html"><a href="brca-rnaseq-model-suite.html#full-data-set-fit-1"><i class="fa fa-check"></i><b>8.1</b> Full data set fit</a>
<ul>
<li class="chapter" data-level="" data-path="brca-rnaseq-model-suite.html"><a href="brca-rnaseq-model-suite.html#get-sample-consistency-scores-1"><i class="fa fa-check"></i>Get sample consistency scores</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="brca-rnaseq-model-suite.html"><a href="brca-rnaseq-model-suite.html#selected-feature-list-stability-1"><i class="fa fa-check"></i><b>8.2</b> Selected feature list stability</a></li>
<li class="chapter" data-level="8.3" data-path="brca-rnaseq-model-suite.html"><a href="brca-rnaseq-model-suite.html#simulation-design-1"><i class="fa fa-check"></i><b>8.3</b> Simulation Design</a></li>
<li class="chapter" data-level="8.4" data-path="brca-rnaseq-model-suite.html"><a href="brca-rnaseq-model-suite.html#setup-simulation-1"><i class="fa fa-check"></i><b>8.4</b> Setup simulation</a></li>
<li class="chapter" data-level="8.5" data-path="brca-rnaseq-model-suite.html"><a href="brca-rnaseq-model-suite.html#run-simulations-1"><i class="fa fa-check"></i><b>8.5</b> Run simulations</a></li>
<li class="chapter" data-level="8.6" data-path="brca-rnaseq-model-suite.html"><a href="brca-rnaseq-model-suite.html#simulation-results-1"><i class="fa fa-check"></i><b>8.6</b> Simulation results</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="brca-rnaseq-model-suite.html"><a href="brca-rnaseq-model-suite.html#simulation-results---look-at-one-simulation-1"><i class="fa fa-check"></i><b>8.6.1</b> Simulation Results - look at one simulation</a></li>
<li class="chapter" data-level="8.6.2" data-path="brca-rnaseq-model-suite.html"><a href="brca-rnaseq-model-suite.html#summarize-results-across-simulation-runs.-1"><i class="fa fa-check"></i><b>8.6.2</b> Summarize results across simulation runs.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="conclusions.html"><a href="conclusions.html"><i class="fa fa-check"></i><b>9</b> Conclusions</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="" data-path="appendix-1.html"><a href="appendix-1.html"><i class="fa fa-check"></i>Appendix 1 - Sample size in elastic net fits to HCC 5hmC-Seq Data</a>
<ul>
<li class="chapter" data-level="" data-path="appendix-1.html"><a href="appendix-1.html#selected-feature-list-stability-2"><i class="fa fa-check"></i>Selected feature list stability</a></li>
<li class="chapter" data-level="" data-path="appendix-1.html"><a href="appendix-1.html#run-simulations---enet"><i class="fa fa-check"></i>Run simulations - enet</a></li>
<li class="chapter" data-level="" data-path="appendix-1.html"><a href="appendix-1.html#enet-simulation-results"><i class="fa fa-check"></i>enet Simulation results</a>
<ul>
<li class="chapter" data-level="" data-path="appendix-1.html"><a href="appendix-1.html#simulation-results---look-at-one-simulation-2"><i class="fa fa-check"></i>Simulation Results - look at one simulation</a></li>
<li class="chapter" data-level="" data-path="appendix-1.html"><a href="appendix-1.html#summarize-results-across-simulation-runs"><i class="fa fa-check"></i>Summarize results across simulation runs</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="LICENSE.md" style="font:em;" target="blank">Copyright (c) 2020 Francois Collin</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">DNA Hydroxymethylation in Hepatocellular Carcinoma</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="brca-rnaseseq-explore-sparsity" class="section level1" number="7">
<h1><span class="header-section-number">Section 7</span> BrCa RNA-Seq: Exploring Sparsity</h1>
<p>In this section we explore various models fitted to
the Breast Cancer RNA-Seq data set explored in Section <a href="brca-rnaseq-preproc.html#brca-rnaseq-preproc">6</a>.
We focus our analyses on lasso fits which tend to favor sparse models.</p>
<div id="cross-validation-analysis-setup-1" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Cross-validation analysis setup</h2>
<p>We use the same CV set-up as was used with the HCC 5hmC-Seq data set
(Section <a href="hcc-5hmcseq-explore-sparsity.html#hcc-5hmcseq-explore-sparsity">4</a>).</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="brca-rnaseseq-explore-sparsity.html#cb137-1"></a>K_FOLD &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb137-2"><a href="brca-rnaseseq-explore-sparsity.html#cb137-2"></a>trainP &lt;-<span class="st"> </span><span class="fl">0.8</span></span></code></pre></div>
<!-- NOT CURRENTLY USED 
EPS <- 0.05    # Have no idea what "small" epsilon means
-->
<p>First we divide the analysis dataset into <code>train</code> and <code>test</code> in a <span class="math inline">\(4\)</span>:1 ratio.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="brca-rnaseseq-explore-sparsity.html#cb138-1"></a><span class="co">### CLEAR CACHE</span></span>
<span id="cb138-2"><a href="brca-rnaseseq-explore-sparsity.html#cb138-2"></a></span>
<span id="cb138-3"><a href="brca-rnaseseq-explore-sparsity.html#cb138-3"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb138-4"><a href="brca-rnaseseq-explore-sparsity.html#cb138-4"></a>brcaRna_train_sampID_vec &lt;-<span class="st"> </span><span class="kw">with</span>(brcaRna_sampDesc,</span>
<span id="cb138-5"><a href="brca-rnaseseq-explore-sparsity.html#cb138-5"></a>brcaRna_sampDesc<span class="op">$</span>sampID[caret<span class="op">::</span><span class="kw">createDataPartition</span>(<span class="dt">y=</span>group, <span class="dt">p=</span>trainP, <span class="dt">list=</span>F)]</span>
<span id="cb138-6"><a href="brca-rnaseseq-explore-sparsity.html#cb138-6"></a>)</span>
<span id="cb138-7"><a href="brca-rnaseseq-explore-sparsity.html#cb138-7"></a></span>
<span id="cb138-8"><a href="brca-rnaseseq-explore-sparsity.html#cb138-8"></a>brcaRna_test_sampID_vec &lt;-<span class="st"> </span><span class="kw">with</span>(brcaRna_sampDesc,</span>
<span id="cb138-9"><a href="brca-rnaseseq-explore-sparsity.html#cb138-9"></a><span class="kw">setdiff</span>(sampID, brcaRna_train_sampID_vec)</span>
<span id="cb138-10"><a href="brca-rnaseseq-explore-sparsity.html#cb138-10"></a>)</span>
<span id="cb138-11"><a href="brca-rnaseseq-explore-sparsity.html#cb138-11"></a></span>
<span id="cb138-12"><a href="brca-rnaseseq-explore-sparsity.html#cb138-12"></a>brcaRna_train_group_vec &lt;-<span class="st"> </span><span class="kw">factor</span>(brcaRna_sampDesc[brcaRna_train_sampID_vec, <span class="st">&#39;group&#39;</span>],</span>
<span id="cb138-13"><a href="brca-rnaseseq-explore-sparsity.html#cb138-13"></a><span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&#39;Other&#39;</span>, <span class="st">&#39;LumA&#39;</span>))</span>
<span id="cb138-14"><a href="brca-rnaseseq-explore-sparsity.html#cb138-14"></a><span class="kw">names</span>(brcaRna_train_group_vec) &lt;-<span class="st"> </span>brcaRna_sampDesc[brcaRna_train_sampID_vec, <span class="st">&#39;sampID&#39;</span>]</span>
<span id="cb138-15"><a href="brca-rnaseseq-explore-sparsity.html#cb138-15"></a></span>
<span id="cb138-16"><a href="brca-rnaseseq-explore-sparsity.html#cb138-16"></a>brcaRna_test_group_vec &lt;-<span class="st"> </span><span class="kw">factor</span>(brcaRna_sampDesc[brcaRna_test_sampID_vec, <span class="st">&#39;group&#39;</span>],</span>
<span id="cb138-17"><a href="brca-rnaseseq-explore-sparsity.html#cb138-17"></a><span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&#39;Other&#39;</span>, <span class="st">&#39;LumA&#39;</span>))</span>
<span id="cb138-18"><a href="brca-rnaseseq-explore-sparsity.html#cb138-18"></a><span class="kw">names</span>(brcaRna_test_group_vec) &lt;-<span class="st"> </span>brcaRna_sampDesc[brcaRna_test_sampID_vec, <span class="st">&#39;sampID&#39;</span>]</span>
<span id="cb138-19"><a href="brca-rnaseseq-explore-sparsity.html#cb138-19"></a></span>
<span id="cb138-20"><a href="brca-rnaseseq-explore-sparsity.html#cb138-20"></a>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">table</span>(brcaRna_train_group_vec),</span>
<span id="cb138-21"><a href="brca-rnaseseq-explore-sparsity.html#cb138-21"></a>  <span class="dt">caption=</span><span class="st">&quot;Train set&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb138-22"><a href="brca-rnaseseq-explore-sparsity.html#cb138-22"></a><span class="st">   </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F)</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:brcaRna-glmnetFit-getTrainVal">Table 7.1: </span>Train set
</caption>
<thead>
<tr>
<th style="text-align:left;">
brcaRna_train_group_vec
</th>
<th style="text-align:right;">
Freq
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Other
</td>
<td style="text-align:right;">
747
</td>
</tr>
<tr>
<td style="text-align:left;">
LumA
</td>
<td style="text-align:right;">
1194
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="brca-rnaseseq-explore-sparsity.html#cb139-1"></a>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">table</span>(brcaRna_test_group_vec),</span>
<span id="cb139-2"><a href="brca-rnaseseq-explore-sparsity.html#cb139-2"></a>  <span class="dt">caption=</span><span class="st">&quot;Test set&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb139-3"><a href="brca-rnaseseq-explore-sparsity.html#cb139-3"></a><span class="st">   </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F)</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:brcaRna-glmnetFit-getTrainVal">Table 7.1: </span>Test set
</caption>
<thead>
<tr>
<th style="text-align:left;">
brcaRna_test_group_vec
</th>
<th style="text-align:right;">
Freq
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Other
</td>
<td style="text-align:right;">
186
</td>
</tr>
<tr>
<td style="text-align:left;">
LumA
</td>
<td style="text-align:right;">
298
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="brca-rnaseseq-explore-sparsity.html#cb140-1"></a>brcaRna_train_geneExpr_mtx &lt;-<span class="st"> </span><span class="kw">t</span>(brcaRna_geneExpression_F[,brcaRna_train_sampID_vec])</span>
<span id="cb140-2"><a href="brca-rnaseseq-explore-sparsity.html#cb140-2"></a>brcaRna_test_geneExpr_mtx &lt;-<span class="st"> </span><span class="kw">t</span>(brcaRna_geneExpression_F[,brcaRna_test_sampID_vec])</span></code></pre></div>
<p>We explore some glmnet fits and the “bet on sparsity”.
We consider three models, specified by the value of the
<strong>alpha</strong> parameter in the elastic net parametrization:<br />
- lasso: <span class="math inline">\(\alpha = 1.0\)</span> - sparse models<br />
- ridge <span class="math inline">\(\alpha = 0\)</span> - shrunken coefficients models<br />
- elastic net: <span class="math inline">\(\alpha = 0.5\)</span> - semi sparse model<br />
<!-- - lassoC: $\alpha = 1-\epsilon =$ $TICKr 1- EPSTICK - lasso for correlated predictors  --></p>
<p>In this analysis, we will only evaluate models in terms of
model sparsity, stability and performance. We leave the question
of significance testing of hypotheses about model parameters
completely out. See Lockhart et al. (2014) <span class="citation">[<a href="references.html#ref-Lockhart:2014aa" role="doc-biblioref">24</a>]</span>
and Wassermam (2014) <span class="citation">[<a href="references.html#ref-Wasserman:2014aa" role="doc-biblioref">25</a>]</span> for a discussion of this topic.</p>
<p>In this section we look at the relative performance and sparsity of the models
considered. The effect of the size of the sample set on the level and
stability of performance will be investigated in the next section.</p>
<hr />
<p>First we create folds for <span class="math inline">\(10\)</span>-fold cross-validation of models fitted to
training data. We’ll use caret::createFolds to assign samples
to folds while keeping the outcome ratios constant across folds.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="brca-rnaseseq-explore-sparsity.html#cb141-1"></a><span class="co"># This is too variable, both in terms of fold size And composition</span></span>
<span id="cb141-2"><a href="brca-rnaseseq-explore-sparsity.html#cb141-2"></a><span class="co">#foldid_vec &lt;- sample(1:10, size=length(brcaRna_train_group_vec), replace=T)</span></span>
<span id="cb141-3"><a href="brca-rnaseseq-explore-sparsity.html#cb141-3"></a><span class="co">### CLEAR CACHE</span></span>
<span id="cb141-4"><a href="brca-rnaseseq-explore-sparsity.html#cb141-4"></a></span>
<span id="cb141-5"><a href="brca-rnaseseq-explore-sparsity.html#cb141-5"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb141-6"><a href="brca-rnaseseq-explore-sparsity.html#cb141-6"></a>brcaRna_train_foldid_vec &lt;-<span class="st"> </span>caret<span class="op">::</span><span class="kw">createFolds</span>(</span>
<span id="cb141-7"><a href="brca-rnaseseq-explore-sparsity.html#cb141-7"></a> <span class="kw">factor</span>(brcaRna_train_group_vec), </span>
<span id="cb141-8"><a href="brca-rnaseseq-explore-sparsity.html#cb141-8"></a> <span class="dt">k=</span>K_FOLD,</span>
<span id="cb141-9"><a href="brca-rnaseseq-explore-sparsity.html#cb141-9"></a> <span class="dt">list=</span>F)</span>
<span id="cb141-10"><a href="brca-rnaseseq-explore-sparsity.html#cb141-10"></a></span>
<span id="cb141-11"><a href="brca-rnaseseq-explore-sparsity.html#cb141-11"></a><span class="co"># brcaRna_train_foldid_vec contains the left-out IDs </span></span>
<span id="cb141-12"><a href="brca-rnaseseq-explore-sparsity.html#cb141-12"></a><span class="co"># the rest are kept</span></span>
<span id="cb141-13"><a href="brca-rnaseseq-explore-sparsity.html#cb141-13"></a>fold_out_tbl &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">split</span>(brcaRna_train_group_vec, brcaRna_train_foldid_vec),</span>
<span id="cb141-14"><a href="brca-rnaseseq-explore-sparsity.html#cb141-14"></a>  table)</span>
<span id="cb141-15"><a href="brca-rnaseseq-explore-sparsity.html#cb141-15"></a><span class="kw">rownames</span>(fold_out_tbl) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="kw">rownames</span>(fold_out_tbl), <span class="st">&#39;- Out&#39;</span>) </span>
<span id="cb141-16"><a href="brca-rnaseseq-explore-sparsity.html#cb141-16"></a></span>
<span id="cb141-17"><a href="brca-rnaseseq-explore-sparsity.html#cb141-17"></a>fold_in_tbl &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&#39;cbind&#39;</span>, <span class="kw">lapply</span>(<span class="kw">sort</span>(<span class="kw">unique</span>(brcaRna_train_foldid_vec)),</span>
<span id="cb141-18"><a href="brca-rnaseseq-explore-sparsity.html#cb141-18"></a>  <span class="cf">function</span>(FOLD) <span class="kw">table</span>(brcaRna_train_group_vec[brcaRna_train_foldid_vec <span class="op">!=</span><span class="st"> </span>FOLD])))</span>
<span id="cb141-19"><a href="brca-rnaseseq-explore-sparsity.html#cb141-19"></a><span class="kw">rownames</span>(fold_in_tbl) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="kw">rownames</span>(fold_in_tbl), <span class="st">&#39;- In&#39;</span>) </span>
<span id="cb141-20"><a href="brca-rnaseseq-explore-sparsity.html#cb141-20"></a><span class="kw">colnames</span>(fold_in_tbl) &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">sort</span>(<span class="kw">unique</span>(brcaRna_train_foldid_vec)))</span>
<span id="cb141-21"><a href="brca-rnaseseq-explore-sparsity.html#cb141-21"></a></span>
<span id="cb141-22"><a href="brca-rnaseseq-explore-sparsity.html#cb141-22"></a></span>
<span id="cb141-23"><a href="brca-rnaseseq-explore-sparsity.html#cb141-23"></a>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">rbind</span>(fold_in_tbl, fold_out_tbl[,<span class="kw">colnames</span>(fold_in_tbl)]),</span>
<span id="cb141-24"><a href="brca-rnaseseq-explore-sparsity.html#cb141-24"></a>  <span class="dt">caption=</span><span class="st">&quot;training samples fold composition&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb141-25"><a href="brca-rnaseseq-explore-sparsity.html#cb141-25"></a><span class="st">   </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F)</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:brcaRna-glmnetFit-getTrainFolds">Table 7.2: </span>training samples fold composition
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
1
</th>
<th style="text-align:right;">
2
</th>
<th style="text-align:right;">
3
</th>
<th style="text-align:right;">
4
</th>
<th style="text-align:right;">
5
</th>
<th style="text-align:right;">
6
</th>
<th style="text-align:right;">
7
</th>
<th style="text-align:right;">
8
</th>
<th style="text-align:right;">
9
</th>
<th style="text-align:right;">
10
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Other - In
</td>
<td style="text-align:right;">
673
</td>
<td style="text-align:right;">
673
</td>
<td style="text-align:right;">
672
</td>
<td style="text-align:right;">
672
</td>
<td style="text-align:right;">
672
</td>
<td style="text-align:right;">
672
</td>
<td style="text-align:right;">
672
</td>
<td style="text-align:right;">
672
</td>
<td style="text-align:right;">
673
</td>
<td style="text-align:right;">
672
</td>
</tr>
<tr>
<td style="text-align:left;">
LumA - In
</td>
<td style="text-align:right;">
1074
</td>
<td style="text-align:right;">
1075
</td>
<td style="text-align:right;">
1075
</td>
<td style="text-align:right;">
1074
</td>
<td style="text-align:right;">
1075
</td>
<td style="text-align:right;">
1075
</td>
<td style="text-align:right;">
1074
</td>
<td style="text-align:right;">
1075
</td>
<td style="text-align:right;">
1074
</td>
<td style="text-align:right;">
1075
</td>
</tr>
<tr>
<td style="text-align:left;">
Other - Out
</td>
<td style="text-align:right;">
74
</td>
<td style="text-align:right;">
74
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:right;">
74
</td>
<td style="text-align:right;">
75
</td>
</tr>
<tr>
<td style="text-align:left;">
LumA - Out
</td>
<td style="text-align:right;">
120
</td>
<td style="text-align:right;">
119
</td>
<td style="text-align:right;">
119
</td>
<td style="text-align:right;">
120
</td>
<td style="text-align:right;">
119
</td>
<td style="text-align:right;">
119
</td>
<td style="text-align:right;">
120
</td>
<td style="text-align:right;">
119
</td>
<td style="text-align:right;">
120
</td>
<td style="text-align:right;">
119
</td>
</tr>
</tbody>
</table>
<p>Note that the folds identify samples that are left-out of the training
data for each fold fit.</p>
</div>
<div id="fit-and-compare-models-1" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Fit and compare models</h2>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="brca-rnaseseq-explore-sparsity.html#cb142-1"></a><span class="co">### CLEAR CACHE</span></span>
<span id="cb142-2"><a href="brca-rnaseseq-explore-sparsity.html#cb142-2"></a></span>
<span id="cb142-3"><a href="brca-rnaseseq-explore-sparsity.html#cb142-3"></a>start_time &lt;-<span class="st">  </span><span class="kw">proc.time</span>()</span>
<span id="cb142-4"><a href="brca-rnaseseq-explore-sparsity.html#cb142-4"></a></span>
<span id="cb142-5"><a href="brca-rnaseseq-explore-sparsity.html#cb142-5"></a>brcaRna_cv_lasso &lt;-<span class="st"> </span>glmnet<span class="op">::</span><span class="kw">cv.glmnet</span>(</span>
<span id="cb142-6"><a href="brca-rnaseseq-explore-sparsity.html#cb142-6"></a> <span class="dt">x=</span>brcaRna_train_geneExpr_mtx,</span>
<span id="cb142-7"><a href="brca-rnaseseq-explore-sparsity.html#cb142-7"></a> <span class="dt">y=</span>brcaRna_train_group_vec,</span>
<span id="cb142-8"><a href="brca-rnaseseq-explore-sparsity.html#cb142-8"></a> <span class="dt">foldid=</span>brcaRna_train_foldid_vec,</span>
<span id="cb142-9"><a href="brca-rnaseseq-explore-sparsity.html#cb142-9"></a> <span class="dt">alpha=</span><span class="dv">1</span>,</span>
<span id="cb142-10"><a href="brca-rnaseseq-explore-sparsity.html#cb142-10"></a> <span class="dt">family=</span><span class="st">&#39;binomial&#39;</span>, </span>
<span id="cb142-11"><a href="brca-rnaseseq-explore-sparsity.html#cb142-11"></a> <span class="dt">type.measure =</span> <span class="st">&quot;class&quot;</span>,</span>
<span id="cb142-12"><a href="brca-rnaseseq-explore-sparsity.html#cb142-12"></a> <span class="dt">keep=</span>T,</span>
<span id="cb142-13"><a href="brca-rnaseseq-explore-sparsity.html#cb142-13"></a> <span class="dt">nlambda=</span><span class="dv">30</span></span>
<span id="cb142-14"><a href="brca-rnaseseq-explore-sparsity.html#cb142-14"></a>)</span>
<span id="cb142-15"><a href="brca-rnaseseq-explore-sparsity.html#cb142-15"></a></span>
<span id="cb142-16"><a href="brca-rnaseseq-explore-sparsity.html#cb142-16"></a><span class="kw">message</span>(<span class="st">&quot;lasso time: &quot;</span>, <span class="kw">round</span>((<span class="kw">proc.time</span>() <span class="op">-</span><span class="st"> </span>start_time)[<span class="dv">3</span>],<span class="dv">2</span>),<span class="st">&quot;s&quot;</span>)</span></code></pre></div>
<pre><code>## lasso time: 31.48s</code></pre>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="brca-rnaseseq-explore-sparsity.html#cb144-1"></a><span class="co">### CLEAR CACHE</span></span>
<span id="cb144-2"><a href="brca-rnaseseq-explore-sparsity.html#cb144-2"></a></span>
<span id="cb144-3"><a href="brca-rnaseseq-explore-sparsity.html#cb144-3"></a>start_time &lt;-<span class="st">  </span><span class="kw">proc.time</span>()</span>
<span id="cb144-4"><a href="brca-rnaseseq-explore-sparsity.html#cb144-4"></a></span>
<span id="cb144-5"><a href="brca-rnaseseq-explore-sparsity.html#cb144-5"></a>brcaRna_cv_ridge &lt;-<span class="st"> </span>glmnet<span class="op">::</span><span class="kw">cv.glmnet</span>(</span>
<span id="cb144-6"><a href="brca-rnaseseq-explore-sparsity.html#cb144-6"></a> <span class="dt">x=</span>brcaRna_train_geneExpr_mtx,</span>
<span id="cb144-7"><a href="brca-rnaseseq-explore-sparsity.html#cb144-7"></a> <span class="dt">y=</span>brcaRna_train_group_vec,</span>
<span id="cb144-8"><a href="brca-rnaseseq-explore-sparsity.html#cb144-8"></a> <span class="dt">foldid=</span>brcaRna_train_foldid_vec,</span>
<span id="cb144-9"><a href="brca-rnaseseq-explore-sparsity.html#cb144-9"></a> <span class="dt">alpha=</span><span class="dv">0</span>,</span>
<span id="cb144-10"><a href="brca-rnaseseq-explore-sparsity.html#cb144-10"></a> <span class="dt">family=</span><span class="st">&#39;binomial&#39;</span>, </span>
<span id="cb144-11"><a href="brca-rnaseseq-explore-sparsity.html#cb144-11"></a> <span class="dt">type.measure =</span> <span class="st">&quot;class&quot;</span>,</span>
<span id="cb144-12"><a href="brca-rnaseseq-explore-sparsity.html#cb144-12"></a> <span class="dt">keep=</span>T,</span>
<span id="cb144-13"><a href="brca-rnaseseq-explore-sparsity.html#cb144-13"></a> <span class="dt">nlambda=</span><span class="dv">30</span></span>
<span id="cb144-14"><a href="brca-rnaseseq-explore-sparsity.html#cb144-14"></a>)</span>
<span id="cb144-15"><a href="brca-rnaseseq-explore-sparsity.html#cb144-15"></a></span>
<span id="cb144-16"><a href="brca-rnaseseq-explore-sparsity.html#cb144-16"></a><span class="kw">message</span>(<span class="st">&quot;ridge time: &quot;</span>, <span class="kw">round</span>((<span class="kw">proc.time</span>() <span class="op">-</span><span class="st"> </span>start_time)[<span class="dv">3</span>],<span class="dv">2</span>),<span class="st">&quot;s&quot;</span>)</span></code></pre></div>
<pre><code>## ridge time: 258.93s</code></pre>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="brca-rnaseseq-explore-sparsity.html#cb146-1"></a><span class="co">### CLEAR CACHE</span></span>
<span id="cb146-2"><a href="brca-rnaseseq-explore-sparsity.html#cb146-2"></a></span>
<span id="cb146-3"><a href="brca-rnaseseq-explore-sparsity.html#cb146-3"></a>start_time &lt;-<span class="st">  </span><span class="kw">proc.time</span>()</span>
<span id="cb146-4"><a href="brca-rnaseseq-explore-sparsity.html#cb146-4"></a></span>
<span id="cb146-5"><a href="brca-rnaseseq-explore-sparsity.html#cb146-5"></a>brcaRna_cv_enet &lt;-<span class="st"> </span>glmnet<span class="op">::</span><span class="kw">cv.glmnet</span>(</span>
<span id="cb146-6"><a href="brca-rnaseseq-explore-sparsity.html#cb146-6"></a> <span class="dt">x=</span>brcaRna_train_geneExpr_mtx,</span>
<span id="cb146-7"><a href="brca-rnaseseq-explore-sparsity.html#cb146-7"></a> <span class="dt">y=</span>brcaRna_train_group_vec,</span>
<span id="cb146-8"><a href="brca-rnaseseq-explore-sparsity.html#cb146-8"></a> <span class="dt">foldid=</span>brcaRna_train_foldid_vec,</span>
<span id="cb146-9"><a href="brca-rnaseseq-explore-sparsity.html#cb146-9"></a> <span class="dt">alpha=</span><span class="fl">0.5</span>,</span>
<span id="cb146-10"><a href="brca-rnaseseq-explore-sparsity.html#cb146-10"></a> <span class="dt">family=</span><span class="st">&#39;binomial&#39;</span>,</span>
<span id="cb146-11"><a href="brca-rnaseseq-explore-sparsity.html#cb146-11"></a> <span class="dt">type.measure =</span> <span class="st">&quot;class&quot;</span>,</span>
<span id="cb146-12"><a href="brca-rnaseseq-explore-sparsity.html#cb146-12"></a> <span class="dt">keep=</span>T,</span>
<span id="cb146-13"><a href="brca-rnaseseq-explore-sparsity.html#cb146-13"></a> <span class="dt">nlambda=</span><span class="dv">30</span></span>
<span id="cb146-14"><a href="brca-rnaseseq-explore-sparsity.html#cb146-14"></a>)</span>
<span id="cb146-15"><a href="brca-rnaseseq-explore-sparsity.html#cb146-15"></a></span>
<span id="cb146-16"><a href="brca-rnaseseq-explore-sparsity.html#cb146-16"></a><span class="kw">message</span>(<span class="st">&quot;enet time: &quot;</span>, <span class="kw">round</span>((<span class="kw">proc.time</span>() <span class="op">-</span><span class="st"> </span>start_time)[<span class="dv">3</span>],<span class="dv">2</span>),<span class="st">&quot;s&quot;</span>)</span></code></pre></div>
<pre><code>## enet time: 32.59s</code></pre>
<!--
The ridge regression model takes over 10 times longer to compute.
-->
<!-- do not show
Define plotting function.
Maybe show in appendix??
-->
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="brca-rnaseseq-explore-sparsity.html#cb148-1"></a><span class="co">### CLEAR CACHE</span></span>
<span id="cb148-2"><a href="brca-rnaseseq-explore-sparsity.html#cb148-2"></a></span>
<span id="cb148-3"><a href="brca-rnaseseq-explore-sparsity.html#cb148-3"></a>plot_cv_f &lt;-<span class="st"> </span><span class="cf">function</span>(cv_fit, <span class="dt">Nzero=</span>T, ...) {</span>
<span id="cb148-4"><a href="brca-rnaseseq-explore-sparsity.html#cb148-4"></a> </span>
<span id="cb148-5"><a href="brca-rnaseseq-explore-sparsity.html#cb148-5"></a> <span class="kw">suppressPackageStartupMessages</span>(<span class="kw">require</span>(glmnet))</span>
<span id="cb148-6"><a href="brca-rnaseseq-explore-sparsity.html#cb148-6"></a></span>
<span id="cb148-7"><a href="brca-rnaseseq-explore-sparsity.html#cb148-7"></a> <span class="co"># No nonger used</span></span>
<span id="cb148-8"><a href="brca-rnaseseq-explore-sparsity.html#cb148-8"></a> <span class="co">#lambda.1se_p &lt;- cv_fit$nzero[cv_fit$lambda == cv_fit$lambda.1se]</span></span>
<span id="cb148-9"><a href="brca-rnaseseq-explore-sparsity.html#cb148-9"></a> <span class="co">#lambda.min_p &lt;- cv_fit$nzero[cv_fit$lambda == cv_fit$lambda.min]</span></span>
<span id="cb148-10"><a href="brca-rnaseseq-explore-sparsity.html#cb148-10"></a> </span>
<span id="cb148-11"><a href="brca-rnaseseq-explore-sparsity.html#cb148-11"></a> <span class="co"># Get oof error - cv errors produced by extraction method ARE oof!!!</span></span>
<span id="cb148-12"><a href="brca-rnaseseq-explore-sparsity.html#cb148-12"></a> ndx_1se &lt;-<span class="st"> </span><span class="kw">match</span>(cv_fit<span class="op">$</span>lambda<span class="fl">.1</span>se,cv_fit<span class="op">$</span>lambda)</span>
<span id="cb148-13"><a href="brca-rnaseseq-explore-sparsity.html#cb148-13"></a> train_oofPred_1se_vec &lt;-<span class="st"> </span><span class="kw">ifelse</span>(</span>
<span id="cb148-14"><a href="brca-rnaseseq-explore-sparsity.html#cb148-14"></a>  <span class="kw">logistic_f</span>(cv_fit<span class="op">$</span>fit.preval[,ndx_1se]) <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>, <span class="st">&#39;LumA&#39;</span>, <span class="st">&#39;_Other&#39;</span>)</span>
<span id="cb148-15"><a href="brca-rnaseseq-explore-sparsity.html#cb148-15"></a> train_oofPred_1se_error &lt;-<span class="st"> </span><span class="kw">mean</span>(train_oofPred_1se_vec <span class="op">!=</span><span class="st"> </span>brcaRna_train_group_vec)</span>
<span id="cb148-16"><a href="brca-rnaseseq-explore-sparsity.html#cb148-16"></a></span>
<span id="cb148-17"><a href="brca-rnaseseq-explore-sparsity.html#cb148-17"></a> ndx_min &lt;-<span class="st"> </span><span class="kw">match</span>(cv_fit<span class="op">$</span>lambda.min,cv_fit<span class="op">$</span>lambda)</span>
<span id="cb148-18"><a href="brca-rnaseseq-explore-sparsity.html#cb148-18"></a> train_oofPred_min_vec &lt;-<span class="st"> </span><span class="kw">ifelse</span>(</span>
<span id="cb148-19"><a href="brca-rnaseseq-explore-sparsity.html#cb148-19"></a>  <span class="kw">logistic_f</span>(cv_fit<span class="op">$</span>fit.preval[,ndx_min]) <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>, <span class="st">&#39;LumA&#39;</span>, <span class="st">&#39;_Other&#39;</span>)</span>
<span id="cb148-20"><a href="brca-rnaseseq-explore-sparsity.html#cb148-20"></a> train_oofPred_min_error &lt;-<span class="st"> </span><span class="kw">mean</span>(train_oofPred_min_vec <span class="op">!=</span><span class="st"> </span>brcaRna_train_group_vec)</span>
<span id="cb148-21"><a href="brca-rnaseseq-explore-sparsity.html#cb148-21"></a></span>
<span id="cb148-22"><a href="brca-rnaseseq-explore-sparsity.html#cb148-22"></a> <span class="co"># Get test set error</span></span>
<span id="cb148-23"><a href="brca-rnaseseq-explore-sparsity.html#cb148-23"></a> test_pred_1se_vec &lt;-<span class="st"> </span><span class="kw">predict</span>(</span>
<span id="cb148-24"><a href="brca-rnaseseq-explore-sparsity.html#cb148-24"></a>  cv_fit, </span>
<span id="cb148-25"><a href="brca-rnaseseq-explore-sparsity.html#cb148-25"></a>  <span class="dt">newx=</span>brcaRna_test_geneExpr_mtx, </span>
<span id="cb148-26"><a href="brca-rnaseseq-explore-sparsity.html#cb148-26"></a>  <span class="dt">s=</span><span class="st">&quot;lambda.1se&quot;</span>,</span>
<span id="cb148-27"><a href="brca-rnaseseq-explore-sparsity.html#cb148-27"></a>  <span class="dt">type=</span><span class="st">&quot;class&quot;</span></span>
<span id="cb148-28"><a href="brca-rnaseseq-explore-sparsity.html#cb148-28"></a> )</span>
<span id="cb148-29"><a href="brca-rnaseseq-explore-sparsity.html#cb148-29"></a> test_pred_1se_error &lt;-<span class="st"> </span><span class="kw">mean</span>(test_pred_1se_vec <span class="op">!=</span><span class="st"> </span>brcaRna_test_group_vec)</span>
<span id="cb148-30"><a href="brca-rnaseseq-explore-sparsity.html#cb148-30"></a> </span>
<span id="cb148-31"><a href="brca-rnaseseq-explore-sparsity.html#cb148-31"></a> test_pred_min_vec &lt;-<span class="st"> </span><span class="kw">predict</span>(</span>
<span id="cb148-32"><a href="brca-rnaseseq-explore-sparsity.html#cb148-32"></a>  cv_fit, </span>
<span id="cb148-33"><a href="brca-rnaseseq-explore-sparsity.html#cb148-33"></a>  <span class="dt">newx=</span>brcaRna_test_geneExpr_mtx, </span>
<span id="cb148-34"><a href="brca-rnaseseq-explore-sparsity.html#cb148-34"></a>  <span class="dt">s=</span><span class="st">&quot;lambda.min&quot;</span>,</span>
<span id="cb148-35"><a href="brca-rnaseseq-explore-sparsity.html#cb148-35"></a>  <span class="dt">type=</span><span class="st">&quot;class&quot;</span></span>
<span id="cb148-36"><a href="brca-rnaseseq-explore-sparsity.html#cb148-36"></a> )</span>
<span id="cb148-37"><a href="brca-rnaseseq-explore-sparsity.html#cb148-37"></a> test_pred_min_error &lt;-<span class="st"> </span><span class="kw">mean</span>(test_pred_min_vec <span class="op">!=</span><span class="st"> </span>brcaRna_test_group_vec)</span>
<span id="cb148-38"><a href="brca-rnaseseq-explore-sparsity.html#cb148-38"></a> </span>
<span id="cb148-39"><a href="brca-rnaseseq-explore-sparsity.html#cb148-39"></a>  </span>
<span id="cb148-40"><a href="brca-rnaseseq-explore-sparsity.html#cb148-40"></a> <span class="kw">plot</span>(</span>
<span id="cb148-41"><a href="brca-rnaseseq-explore-sparsity.html#cb148-41"></a>  <span class="kw">log</span>(cv_fit<span class="op">$</span>lambda),</span>
<span id="cb148-42"><a href="brca-rnaseseq-explore-sparsity.html#cb148-42"></a>  cv_fit<span class="op">$</span>cvm,</span>
<span id="cb148-43"><a href="brca-rnaseseq-explore-sparsity.html#cb148-43"></a>  <span class="dt">pch=</span><span class="dv">16</span>,<span class="dt">col=</span><span class="st">&quot;red&quot;</span>,</span>
<span id="cb148-44"><a href="brca-rnaseseq-explore-sparsity.html#cb148-44"></a>  <span class="dt">xlab=</span><span class="st">&#39;&#39;</span>,<span class="dt">ylab=</span><span class="st">&#39;&#39;</span>,</span>
<span id="cb148-45"><a href="brca-rnaseseq-explore-sparsity.html#cb148-45"></a>  ...</span>
<span id="cb148-46"><a href="brca-rnaseseq-explore-sparsity.html#cb148-46"></a> )</span>
<span id="cb148-47"><a href="brca-rnaseseq-explore-sparsity.html#cb148-47"></a> <span class="kw">abline</span>(<span class="dt">v=</span><span class="kw">log</span>(<span class="kw">c</span>(cv_fit<span class="op">$</span>lambda<span class="fl">.1</span>se, cv_fit<span class="op">$</span>lambda.min)))</span>
<span id="cb148-48"><a href="brca-rnaseseq-explore-sparsity.html#cb148-48"></a> <span class="cf">if</span>(Nzero)</span>
<span id="cb148-49"><a href="brca-rnaseseq-explore-sparsity.html#cb148-49"></a> <span class="kw">axis</span>(<span class="dt">side=</span><span class="dv">3</span>, <span class="dt">tick=</span>F, <span class="dt">at=</span><span class="kw">log</span>(cv_fit<span class="op">$</span>lambda), </span>
<span id="cb148-50"><a href="brca-rnaseseq-explore-sparsity.html#cb148-50"></a>  <span class="dt">labels=</span>cv_fit<span class="op">$</span>nzero, <span class="dt">line =</span> <span class="dv">-1</span></span>
<span id="cb148-51"><a href="brca-rnaseseq-explore-sparsity.html#cb148-51"></a> )</span>
<span id="cb148-52"><a href="brca-rnaseseq-explore-sparsity.html#cb148-52"></a> LL &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb148-53"><a href="brca-rnaseseq-explore-sparsity.html#cb148-53"></a> <span class="co">#mtext(side=1, outer=F, line = LL, &quot;log(Lambda)&quot;)</span></span>
<span id="cb148-54"><a href="brca-rnaseseq-explore-sparsity.html#cb148-54"></a> <span class="co">#LL &lt;- LL+1</span></span>
<span id="cb148-55"><a href="brca-rnaseseq-explore-sparsity.html#cb148-55"></a> <span class="kw">mtext</span>(<span class="dt">side=</span><span class="dv">1</span>, <span class="dt">outer=</span>F, <span class="dt">line =</span> LL, <span class="kw">paste</span>(</span>
<span id="cb148-56"><a href="brca-rnaseseq-explore-sparsity.html#cb148-56"></a>  <span class="co">#ifelse(Nzero, paste(&quot;1se p =&quot;, lambda.1se_p),&#39;&#39;),</span></span>
<span id="cb148-57"><a href="brca-rnaseseq-explore-sparsity.html#cb148-57"></a>  <span class="st">&quot;1se: train =&quot;</span>, <span class="kw">round</span>(<span class="dv">100</span><span class="op">*</span>cv_fit<span class="op">$</span>cvm[cv_fit<span class="op">$</span>lambda <span class="op">==</span><span class="st"> </span>cv_fit<span class="op">$</span>lambda<span class="fl">.1</span>se], <span class="dv">1</span>),</span>
<span id="cb148-58"><a href="brca-rnaseseq-explore-sparsity.html#cb148-58"></a>  <span class="co">##&quot;oof =&quot;, round(100*train_oofPred_1se_error, 1), </span><span class="al">###</span><span class="co"> REDUNDANT</span></span>
<span id="cb148-59"><a href="brca-rnaseseq-explore-sparsity.html#cb148-59"></a>  <span class="st">&quot;test =&quot;</span>, <span class="kw">round</span>(<span class="dv">100</span><span class="op">*</span>test_pred_1se_error, <span class="dv">1</span>)</span>
<span id="cb148-60"><a href="brca-rnaseseq-explore-sparsity.html#cb148-60"></a> ))</span>
<span id="cb148-61"><a href="brca-rnaseseq-explore-sparsity.html#cb148-61"></a> LL &lt;-<span class="st"> </span>LL<span class="op">+</span><span class="dv">1</span></span>
<span id="cb148-62"><a href="brca-rnaseseq-explore-sparsity.html#cb148-62"></a> <span class="kw">mtext</span>(<span class="dt">side=</span><span class="dv">1</span>, <span class="dt">outer=</span>F, <span class="dt">line =</span> LL, <span class="kw">paste</span>(</span>
<span id="cb148-63"><a href="brca-rnaseseq-explore-sparsity.html#cb148-63"></a>  <span class="co">#ifelse(Nzero, paste(&quot;min p =&quot;, lambda.min_p),&#39;&#39;),</span></span>
<span id="cb148-64"><a href="brca-rnaseseq-explore-sparsity.html#cb148-64"></a>  <span class="st">&quot;min: train =&quot;</span>, <span class="kw">round</span>(<span class="dv">100</span><span class="op">*</span>cv_fit<span class="op">$</span>cvm[cv_fit<span class="op">$</span>lambda <span class="op">==</span><span class="st"> </span>cv_fit<span class="op">$</span>lambda.min], <span class="dv">1</span>),</span>
<span id="cb148-65"><a href="brca-rnaseseq-explore-sparsity.html#cb148-65"></a>  <span class="co">##&quot;oof =&quot;, round(100*train_oofPred_min_error, 1),  </span><span class="al">###</span><span class="co"> REDUNDANT</span></span>
<span id="cb148-66"><a href="brca-rnaseseq-explore-sparsity.html#cb148-66"></a>  <span class="st">&quot;test =&quot;</span>, <span class="kw">round</span>(<span class="dv">100</span><span class="op">*</span>test_pred_min_error, <span class="dv">1</span>)</span>
<span id="cb148-67"><a href="brca-rnaseseq-explore-sparsity.html#cb148-67"></a> ))</span>
<span id="cb148-68"><a href="brca-rnaseseq-explore-sparsity.html#cb148-68"></a> </span>
<span id="cb148-69"><a href="brca-rnaseseq-explore-sparsity.html#cb148-69"></a> tmp &lt;-</span>
<span id="cb148-70"><a href="brca-rnaseseq-explore-sparsity.html#cb148-70"></a><span class="st"> </span><span class="kw">cbind</span>(</span>
<span id="cb148-71"><a href="brca-rnaseseq-explore-sparsity.html#cb148-71"></a>  <span class="dt">error_1se =</span> <span class="kw">c</span>(</span>
<span id="cb148-72"><a href="brca-rnaseseq-explore-sparsity.html#cb148-72"></a>   <span class="dt">p =</span> cv_fit<span class="op">$</span>nzero[cv_fit<span class="op">$</span>lambda <span class="op">==</span><span class="st"> </span>cv_fit<span class="op">$</span>lambda<span class="fl">.1</span>se],</span>
<span id="cb148-73"><a href="brca-rnaseseq-explore-sparsity.html#cb148-73"></a>   <span class="dt">train  =</span> <span class="dv">100</span><span class="op">*</span>cv_fit<span class="op">$</span>cvm[cv_fit<span class="op">$</span>lambda <span class="op">==</span><span class="st"> </span>cv_fit<span class="op">$</span>lambda<span class="fl">.1</span>se],</span>
<span id="cb148-74"><a href="brca-rnaseseq-explore-sparsity.html#cb148-74"></a>   <span class="co">#train_oof = 100*train_oofPred_1se_error,  </span><span class="al">###</span><span class="co"> REDUNANT</span></span>
<span id="cb148-75"><a href="brca-rnaseseq-explore-sparsity.html#cb148-75"></a>   <span class="dt">test =</span> <span class="dv">100</span><span class="op">*</span>test_pred_1se_error),</span>
<span id="cb148-76"><a href="brca-rnaseseq-explore-sparsity.html#cb148-76"></a>  <span class="dt">error_min =</span> <span class="kw">c</span>(</span>
<span id="cb148-77"><a href="brca-rnaseseq-explore-sparsity.html#cb148-77"></a>   <span class="dt">p =</span> cv_fit<span class="op">$</span>nzero[cv_fit<span class="op">$</span>lambda <span class="op">==</span><span class="st"> </span>cv_fit<span class="op">$</span>lambda.min],</span>
<span id="cb148-78"><a href="brca-rnaseseq-explore-sparsity.html#cb148-78"></a>   <span class="dt">train  =</span> <span class="dv">100</span><span class="op">*</span>cv_fit<span class="op">$</span>cvm[cv_fit<span class="op">$</span>lambda <span class="op">==</span><span class="st"> </span>cv_fit<span class="op">$</span>lambda.min],</span>
<span id="cb148-79"><a href="brca-rnaseseq-explore-sparsity.html#cb148-79"></a>   <span class="co">#train_oof = 100*train_oofPred_min_error, </span><span class="al">###</span><span class="co"> REDUNDSANT</span></span>
<span id="cb148-80"><a href="brca-rnaseseq-explore-sparsity.html#cb148-80"></a>   <span class="dt">test =</span> <span class="dv">100</span><span class="op">*</span>test_pred_min_error)</span>
<span id="cb148-81"><a href="brca-rnaseseq-explore-sparsity.html#cb148-81"></a>  )</span>
<span id="cb148-82"><a href="brca-rnaseseq-explore-sparsity.html#cb148-82"></a>  <span class="co"># Need to fix names  </span></span>
<span id="cb148-83"><a href="brca-rnaseseq-explore-sparsity.html#cb148-83"></a>  <span class="kw">rownames</span>(tmp) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;p&#39;</span>, <span class="st">&#39;train&#39;</span>, <span class="st">&#39;test&#39;</span>)</span>
<span id="cb148-84"><a href="brca-rnaseseq-explore-sparsity.html#cb148-84"></a>  tmp </span>
<span id="cb148-85"><a href="brca-rnaseseq-explore-sparsity.html#cb148-85"></a>}</span></code></pre></div>
<p>Examine model performance.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="brca-rnaseseq-explore-sparsity.html#cb149-1"></a><span class="co">### CLEAR CACHE</span></span>
<span id="cb149-2"><a href="brca-rnaseseq-explore-sparsity.html#cb149-2"></a></span>
<span id="cb149-3"><a href="brca-rnaseseq-explore-sparsity.html#cb149-3"></a> <span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>), <span class="dt">oma=</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>)) </span>
<span id="cb149-4"><a href="brca-rnaseseq-explore-sparsity.html#cb149-4"></a></span>
<span id="cb149-5"><a href="brca-rnaseseq-explore-sparsity.html#cb149-5"></a> lasso_errors_mtx &lt;-<span class="st"> </span><span class="kw">plot_cv_f</span>(brcaRna_cv_lasso, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">5</span>))</span>
<span id="cb149-6"><a href="brca-rnaseseq-explore-sparsity.html#cb149-6"></a> <span class="kw">title</span>(<span class="st">&#39;lasso&#39;</span>)</span>
<span id="cb149-7"><a href="brca-rnaseseq-explore-sparsity.html#cb149-7"></a></span>
<span id="cb149-8"><a href="brca-rnaseseq-explore-sparsity.html#cb149-8"></a> rifge_errors_mtx &lt;-<span class="st"> </span><span class="kw">plot_cv_f</span>(brcaRna_cv_ridge, <span class="dt">Nzero=</span>F, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">5</span>))</span>
<span id="cb149-9"><a href="brca-rnaseseq-explore-sparsity.html#cb149-9"></a> <span class="kw">title</span>(<span class="st">&#39;ridge&#39;</span>)</span>
<span id="cb149-10"><a href="brca-rnaseseq-explore-sparsity.html#cb149-10"></a></span>
<span id="cb149-11"><a href="brca-rnaseseq-explore-sparsity.html#cb149-11"></a> enet_errors_mtx &lt;-<span class="st">  </span><span class="kw">plot_cv_f</span>(brcaRna_cv_enet, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">5</span>))</span>
<span id="cb149-12"><a href="brca-rnaseseq-explore-sparsity.html#cb149-12"></a> <span class="kw">title</span>(<span class="st">&#39;enet&#39;</span>)</span>
<span id="cb149-13"><a href="brca-rnaseseq-explore-sparsity.html#cb149-13"></a></span>
<span id="cb149-14"><a href="brca-rnaseseq-explore-sparsity.html#cb149-14"></a> <span class="kw">mtext</span>(<span class="dt">side=</span><span class="dv">1</span>, <span class="dt">outer=</span>T, <span class="dt">cex=</span><span class="fl">1.25</span>, <span class="st">&#39;log(Lambda)&#39;</span>)</span>
<span id="cb149-15"><a href="brca-rnaseseq-explore-sparsity.html#cb149-15"></a> <span class="kw">mtext</span>(<span class="dt">side=</span><span class="dv">2</span>, <span class="dt">outer=</span>T, <span class="dt">cex=</span><span class="fl">1.25</span>, brcaRna_cv_lasso<span class="op">$</span>name)</span></code></pre></div>
<div class="figure"><span id="fig:brcaRna-glmnetFit-lookFits"></span>
<img src="Static/figures/brcaRna-glmnetFit-lookFits-1.png" alt="compare fits" width="1056" />
<p class="caption">
Figure 7.1: compare fits
</p>
</div>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="brca-rnaseseq-explore-sparsity.html#cb150-1"></a><span class="co">### CLEAR CACHE</span></span>
<span id="cb150-2"><a href="brca-rnaseseq-explore-sparsity.html#cb150-2"></a></span>
<span id="cb150-3"><a href="brca-rnaseseq-explore-sparsity.html#cb150-3"></a></span>
<span id="cb150-4"><a href="brca-rnaseseq-explore-sparsity.html#cb150-4"></a>errors_frm &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb150-5"><a href="brca-rnaseseq-explore-sparsity.html#cb150-5"></a>  <span class="dt">lasso =</span> lasso_errors_mtx, <span class="dt">ridge =</span> rifge_errors_mtx, <span class="dt">enet =</span> enet_errors_mtx</span>
<span id="cb150-6"><a href="brca-rnaseseq-explore-sparsity.html#cb150-6"></a>)</span>
<span id="cb150-7"><a href="brca-rnaseseq-explore-sparsity.html#cb150-7"></a><span class="kw">colnames</span>(errors_frm) &lt;-<span class="st"> </span><span class="kw">sub</span>(<span class="st">&#39;</span><span class="ch">\\</span><span class="st">.error&#39;</span>,<span class="st">&#39;&#39;</span>, <span class="kw">colnames</span>(errors_frm))</span>
<span id="cb150-8"><a href="brca-rnaseseq-explore-sparsity.html#cb150-8"></a></span>
<span id="cb150-9"><a href="brca-rnaseseq-explore-sparsity.html#cb150-9"></a>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">t</span>(errors_frm),</span>
<span id="cb150-10"><a href="brca-rnaseseq-explore-sparsity.html#cb150-10"></a> <span class="dt">caption =</span> <span class="st">&#39;Misclassifiaction error rates&#39;</span>,</span>
<span id="cb150-11"><a href="brca-rnaseseq-explore-sparsity.html#cb150-11"></a> <span class="dt">digits=</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb150-12"><a href="brca-rnaseseq-explore-sparsity.html#cb150-12"></a><span class="st">  </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F)</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:brcaRna-glmnetFit-printErrors">Table 7.3: </span>Misclassifiaction error rates
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
p
</th>
<th style="text-align:right;">
train
</th>
<th style="text-align:right;">
test
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
lasso_1se
</td>
<td style="text-align:right;">
168
</td>
<td style="text-align:right;">
11.9
</td>
<td style="text-align:right;">
9.9
</td>
</tr>
<tr>
<td style="text-align:left;">
lasso_min
</td>
<td style="text-align:right;">
408
</td>
<td style="text-align:right;">
11.4
</td>
<td style="text-align:right;">
12.8
</td>
</tr>
<tr>
<td style="text-align:left;">
ridge_1se
</td>
<td style="text-align:right;">
19406
</td>
<td style="text-align:right;">
13.0
</td>
<td style="text-align:right;">
13.0
</td>
</tr>
<tr>
<td style="text-align:left;">
ridge_min
</td>
<td style="text-align:right;">
19406
</td>
<td style="text-align:right;">
12.6
</td>
<td style="text-align:right;">
12.4
</td>
</tr>
<tr>
<td style="text-align:left;">
enet_1se
</td>
<td style="text-align:right;">
315
</td>
<td style="text-align:right;">
11.6
</td>
<td style="text-align:right;">
11.2
</td>
</tr>
<tr>
<td style="text-align:left;">
enet_min
</td>
<td style="text-align:right;">
671
</td>
<td style="text-align:right;">
11.1
</td>
<td style="text-align:right;">
13.4
</td>
</tr>
</tbody>
</table>
<p><br/></p>
<ul>
<li><p>lasso and enet, 1se and min lambda, have comparable performance
on the training data.</p></li>
<li><p>The lasso 1se model gains performance in the test data, but
lasso min lambda and enet models stay at the same level or drop
in performance on the test set.</p></li>
<li><p>lasso 1se is most parsimonious by a factor of 2.</p></li>
</ul>
</div>
<div id="the-relaxed-lasso-and-blended-mix-models-1" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> The relaxed lasso and blended mix models</h2>
<p>Next we look at the so-called <code>relaxed lasso</code> model, and
the <code>blended mix</code> which is an optimized shrinkage
between the relaxed lasso and the regular lasso.
See <a href="modeling-background.html#eq:blended">(2.3)</a> in Section <a href="modeling-background.html#modeling-background">2</a>.</p>
<!--
The relaxed fit takes quite a bit longer.  
-->
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="brca-rnaseseq-explore-sparsity.html#cb151-1"></a><span class="co">### CLEAR CACHE</span></span>
<span id="cb151-2"><a href="brca-rnaseseq-explore-sparsity.html#cb151-2"></a></span>
<span id="cb151-3"><a href="brca-rnaseseq-explore-sparsity.html#cb151-3"></a><span class="kw">library</span>(glmnet)</span>
<span id="cb151-4"><a href="brca-rnaseseq-explore-sparsity.html#cb151-4"></a></span>
<span id="cb151-5"><a href="brca-rnaseseq-explore-sparsity.html#cb151-5"></a>brcaRna_cv_lassoR_sum &lt;-<span class="st"> </span><span class="kw">print</span>(brcaRna_cv_lassoR)</span></code></pre></div>
<pre><code>## 
## Call:  glmnet::cv.glmnet(x = brcaRna_train_geneExpr_mtx, y = brcaRna_train_group_vec,      type.measure = &quot;class&quot;, foldid = brcaRna_train_foldid_vec,      keep = T, relax = T, alpha = 1, family = &quot;binomial&quot;, nlambda = 30) 
## 
## Measure: Misclassification Error 
## 
##     Gamma   Lambda Measure       SE Nonzero
## min  1.00 0.005227  0.1139 0.006167     408
## 1se  0.75 0.021823  0.1180 0.008812      91</code></pre>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="brca-rnaseseq-explore-sparsity.html#cb153-1"></a><span class="kw">plot</span>(brcaRna_cv_lassoR)</span></code></pre></div>
<div class="figure"><span id="fig:brcaRna-glmnetFit-lookLassoR"></span>
<img src="Static/figures/brcaRna-glmnetFit-lookLassoR-1.png" alt="Relaxed lasso fit" width="576" />
<p class="caption">
Figure 7.2: Relaxed lasso fit
</p>
</div>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="brca-rnaseseq-explore-sparsity.html#cb154-1"></a><span class="co">### CLEAR CACHE</span></span>
<span id="cb154-2"><a href="brca-rnaseseq-explore-sparsity.html#cb154-2"></a><span class="co"># only report  1se</span></span>
<span id="cb154-3"><a href="brca-rnaseseq-explore-sparsity.html#cb154-3"></a>ndx_1se &lt;-<span class="st"> </span><span class="kw">match</span>(brcaRna_cv_lassoR<span class="op">$</span>lambda<span class="fl">.1</span>se, brcaRna_cv_lassoR<span class="op">$</span>lambda)</span>
<span id="cb154-4"><a href="brca-rnaseseq-explore-sparsity.html#cb154-4"></a>ndx_min &lt;-<span class="st"> </span><span class="kw">match</span>(brcaRna_cv_lassoR<span class="op">$</span>lambda.min, brcaRna_cv_lassoR<span class="op">$</span>lambda)</span>
<span id="cb154-5"><a href="brca-rnaseseq-explore-sparsity.html#cb154-5"></a></span>
<span id="cb154-6"><a href="brca-rnaseseq-explore-sparsity.html#cb154-6"></a><span class="co"># only show 1se anyway</span></span>
<span id="cb154-7"><a href="brca-rnaseseq-explore-sparsity.html#cb154-7"></a><span class="co"># if(ndx_1se != ndx_min) stop(&quot;lambda.1se != lambda.min&quot;)</span></span>
<span id="cb154-8"><a href="brca-rnaseseq-explore-sparsity.html#cb154-8"></a></span>
<span id="cb154-9"><a href="brca-rnaseseq-explore-sparsity.html#cb154-9"></a></span>
<span id="cb154-10"><a href="brca-rnaseseq-explore-sparsity.html#cb154-10"></a><span class="co"># train oof data - NOT CLEAR WHY THESE DIFFER FROM CV ERRORS EXTRACTED FROM MODEL</span></span>
<span id="cb154-11"><a href="brca-rnaseseq-explore-sparsity.html#cb154-11"></a><span class="co"># Get relaxed lasso (gamma=0) oof error</span></span>
<span id="cb154-12"><a href="brca-rnaseseq-explore-sparsity.html#cb154-12"></a>train_oofPred_relaxed_1se_vec &lt;-<span class="st"> </span><span class="kw">ifelse</span>(</span>
<span id="cb154-13"><a href="brca-rnaseseq-explore-sparsity.html#cb154-13"></a>  <span class="kw">logistic_f</span>(brcaRna_cv_lassoR<span class="op">$</span>fit.preval[[<span class="st">&quot;g:0&quot;</span>]][, ndx_1se]) <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>, <span class="st">&quot;LumA&quot;</span>, <span class="st">&quot;Other&quot;</span></span>
<span id="cb154-14"><a href="brca-rnaseseq-explore-sparsity.html#cb154-14"></a>)</span>
<span id="cb154-15"><a href="brca-rnaseseq-explore-sparsity.html#cb154-15"></a>train_oofPred_relaxed_1se_error &lt;-<span class="st"> </span><span class="kw">mean</span>(train_oofPred_relaxed_1se_vec <span class="op">!=</span><span class="st"> </span>brcaRna_train_group_vec)</span>
<span id="cb154-16"><a href="brca-rnaseseq-explore-sparsity.html#cb154-16"></a></span>
<span id="cb154-17"><a href="brca-rnaseseq-explore-sparsity.html#cb154-17"></a><span class="co"># blended mix (gamma=0.5)</span></span>
<span id="cb154-18"><a href="brca-rnaseseq-explore-sparsity.html#cb154-18"></a>train_oofPred_blended_1se_vec &lt;-<span class="st"> </span><span class="kw">ifelse</span>(</span>
<span id="cb154-19"><a href="brca-rnaseseq-explore-sparsity.html#cb154-19"></a>  <span class="kw">logistic_f</span>(brcaRna_cv_lassoR<span class="op">$</span>fit.preval[[<span class="st">&quot;g:0.5&quot;</span>]][, ndx_1se]) <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>, <span class="st">&quot;LumA&quot;</span>, <span class="st">&quot;Other&quot;</span></span>
<span id="cb154-20"><a href="brca-rnaseseq-explore-sparsity.html#cb154-20"></a>)</span>
<span id="cb154-21"><a href="brca-rnaseseq-explore-sparsity.html#cb154-21"></a>train_oofPred_blended_1se_error &lt;-<span class="st"> </span><span class="kw">mean</span>(train_oofPred_blended_1se_vec <span class="op">!=</span><span class="st"> </span>brcaRna_train_group_vec)</span>
<span id="cb154-22"><a href="brca-rnaseseq-explore-sparsity.html#cb154-22"></a></span>
<span id="cb154-23"><a href="brca-rnaseseq-explore-sparsity.html#cb154-23"></a></span>
<span id="cb154-24"><a href="brca-rnaseseq-explore-sparsity.html#cb154-24"></a><span class="co"># Test set error - relaxed</span></span>
<span id="cb154-25"><a href="brca-rnaseseq-explore-sparsity.html#cb154-25"></a>test_pred_relaxed_1se_vec &lt;-<span class="st"> </span><span class="kw">predict</span>(</span>
<span id="cb154-26"><a href="brca-rnaseseq-explore-sparsity.html#cb154-26"></a>  brcaRna_cv_lassoR,</span>
<span id="cb154-27"><a href="brca-rnaseseq-explore-sparsity.html#cb154-27"></a>  <span class="dt">newx =</span> brcaRna_test_geneExpr_mtx,</span>
<span id="cb154-28"><a href="brca-rnaseseq-explore-sparsity.html#cb154-28"></a>  <span class="dt">s =</span> <span class="st">&quot;lambda.1se&quot;</span>,</span>
<span id="cb154-29"><a href="brca-rnaseseq-explore-sparsity.html#cb154-29"></a>  <span class="dt">type =</span> <span class="st">&quot;class&quot;</span>,</span>
<span id="cb154-30"><a href="brca-rnaseseq-explore-sparsity.html#cb154-30"></a>  <span class="dt">gamma =</span> <span class="dv">0</span></span>
<span id="cb154-31"><a href="brca-rnaseseq-explore-sparsity.html#cb154-31"></a>)</span>
<span id="cb154-32"><a href="brca-rnaseseq-explore-sparsity.html#cb154-32"></a>test_pred_relaxed_1se_error &lt;-<span class="st"> </span><span class="kw">mean</span>(test_pred_relaxed_1se_vec <span class="op">!=</span><span class="st"> </span>brcaRna_test_group_vec)</span>
<span id="cb154-33"><a href="brca-rnaseseq-explore-sparsity.html#cb154-33"></a></span>
<span id="cb154-34"><a href="brca-rnaseseq-explore-sparsity.html#cb154-34"></a><span class="co"># Test set error - blended</span></span>
<span id="cb154-35"><a href="brca-rnaseseq-explore-sparsity.html#cb154-35"></a>test_pred_blended_1se_vec &lt;-<span class="st"> </span><span class="kw">predict</span>(</span>
<span id="cb154-36"><a href="brca-rnaseseq-explore-sparsity.html#cb154-36"></a>  brcaRna_cv_lassoR,</span>
<span id="cb154-37"><a href="brca-rnaseseq-explore-sparsity.html#cb154-37"></a>  <span class="dt">newx =</span> brcaRna_test_geneExpr_mtx,</span>
<span id="cb154-38"><a href="brca-rnaseseq-explore-sparsity.html#cb154-38"></a>  <span class="dt">s =</span> <span class="st">&quot;lambda.1se&quot;</span>,</span>
<span id="cb154-39"><a href="brca-rnaseseq-explore-sparsity.html#cb154-39"></a>  <span class="dt">type =</span> <span class="st">&quot;class&quot;</span>,</span>
<span id="cb154-40"><a href="brca-rnaseseq-explore-sparsity.html#cb154-40"></a>  <span class="dt">gamma =</span> <span class="fl">0.5</span></span>
<span id="cb154-41"><a href="brca-rnaseseq-explore-sparsity.html#cb154-41"></a>)</span>
<span id="cb154-42"><a href="brca-rnaseseq-explore-sparsity.html#cb154-42"></a>test_pred_blended_1se_error &lt;-<span class="st"> </span><span class="kw">mean</span>(test_pred_blended_1se_vec <span class="op">!=</span><span class="st"> </span>brcaRna_test_group_vec)</span>
<span id="cb154-43"><a href="brca-rnaseseq-explore-sparsity.html#cb154-43"></a></span>
<span id="cb154-44"><a href="brca-rnaseseq-explore-sparsity.html#cb154-44"></a></span>
<span id="cb154-45"><a href="brca-rnaseseq-explore-sparsity.html#cb154-45"></a>brcaRna_cv_lassoR_1se_error &lt;-<span class="st"> </span>brcaRna_cv_lassoR<span class="op">$</span>cvm[brcaRna_cv_lassoR<span class="op">$</span>lambda<span class="op">==</span>brcaRna_cv_lassoR<span class="op">$</span>lambda.min]</span>
<span id="cb154-46"><a href="brca-rnaseseq-explore-sparsity.html#cb154-46"></a></span>
<span id="cb154-47"><a href="brca-rnaseseq-explore-sparsity.html#cb154-47"></a>cv_blended_statlist &lt;-<span class="st"> </span>brcaRna_cv_lassoR<span class="op">$</span>relaxed<span class="op">$</span>statlist[[<span class="st">&#39;g:0.5&#39;</span>]]</span>
<span id="cb154-48"><a href="brca-rnaseseq-explore-sparsity.html#cb154-48"></a>cv_blended_1se_error &lt;-<span class="st"> </span>cv_blended_statlist<span class="op">$</span>cvm[cv_blended_statlist<span class="op">$</span>lambda<span class="op">==</span></span>
<span id="cb154-49"><a href="brca-rnaseseq-explore-sparsity.html#cb154-49"></a><span class="st">   </span>brcaRna_cv_lassoR<span class="op">$</span>relaxed<span class="op">$</span>lambda<span class="fl">.1</span>se]</span>
<span id="cb154-50"><a href="brca-rnaseseq-explore-sparsity.html#cb154-50"></a> </span>
<span id="cb154-51"><a href="brca-rnaseseq-explore-sparsity.html#cb154-51"></a></span>
<span id="cb154-52"><a href="brca-rnaseseq-explore-sparsity.html#cb154-52"></a></span>
<span id="cb154-53"><a href="brca-rnaseseq-explore-sparsity.html#cb154-53"></a>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">t</span>(<span class="kw">data.frame</span>(</span>
<span id="cb154-54"><a href="brca-rnaseseq-explore-sparsity.html#cb154-54"></a>  <span class="dt">train_relaxed  =</span> brcaRna_cv_lassoR_1se_error,</span>
<span id="cb154-55"><a href="brca-rnaseseq-explore-sparsity.html#cb154-55"></a>  <span class="dt">train_blended  =</span> cv_blended_1se_error,</span>
<span id="cb154-56"><a href="brca-rnaseseq-explore-sparsity.html#cb154-56"></a>  <span class="co">#train_relaxed_oof = train_oofPred_relaxed_1se_error,</span></span>
<span id="cb154-57"><a href="brca-rnaseseq-explore-sparsity.html#cb154-57"></a>  <span class="co">#train_blended_oof = train_oofPred_blended_1se_error,</span></span>
<span id="cb154-58"><a href="brca-rnaseseq-explore-sparsity.html#cb154-58"></a>  <span class="dt">test_relaxed  =</span> test_pred_relaxed_1se_error,</span>
<span id="cb154-59"><a href="brca-rnaseseq-explore-sparsity.html#cb154-59"></a>  <span class="dt">test_blended  =</span> test_pred_blended_1se_error</span>
<span id="cb154-60"><a href="brca-rnaseseq-explore-sparsity.html#cb154-60"></a>)) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb154-61"><a href="brca-rnaseseq-explore-sparsity.html#cb154-61"></a><span class="dt">digits =</span> <span class="dv">1</span>,</span>
<span id="cb154-62"><a href="brca-rnaseseq-explore-sparsity.html#cb154-62"></a><span class="dt">caption =</span> <span class="st">&quot;Relaxed lasso and blended mix error rates&quot;</span></span>
<span id="cb154-63"><a href="brca-rnaseseq-explore-sparsity.html#cb154-63"></a>) <span class="op">%&gt;%</span></span>
<span id="cb154-64"><a href="brca-rnaseseq-explore-sparsity.html#cb154-64"></a><span class="st">  </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F)</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:brcaRna-glmnetFit-lookLassoR2">Table 7.4: </span>Relaxed lasso and blended mix error rates
</caption>
<tbody>
<tr>
<td style="text-align:left;">
train_relaxed
</td>
<td style="text-align:right;">
11.4
</td>
</tr>
<tr>
<td style="text-align:left;">
train_blended
</td>
<td style="text-align:right;">
11.8
</td>
</tr>
<tr>
<td style="text-align:left;">
test_relaxed
</td>
<td style="text-align:right;">
11.4
</td>
</tr>
<tr>
<td style="text-align:left;">
test_blended
</td>
<td style="text-align:right;">
10.3
</td>
</tr>
</tbody>
</table>
<p><br/></p>
<p>The relaxed lasso and blended mix error rates are comparable to the
regular lasso fit error rate. We see here too that the reported cv
error rates are comparable to test set error rates.</p>
<!-- , while out-of-fold error rates
continue to be good indicators of unseen data error rates, as captured
by the test set.  
-->
<p>The <em>1se</em> lambda rule applied to the relaxed lasso fit selected a model with
<span class="math inline">\(168\)</span> features,
while for the blended mix model
(See <a href="modeling-background.html#eq:blended">(2.3)</a> in Section <a href="modeling-background.html#modeling-background">2</a>)
the <em>1se</em> lambda rule selected
<span class="math inline">\(91\)</span> features (vertical
dotted reference line in Figure <a href="#fig:lookLassoR"><strong>??</strong></a>).
This feature is pointed out in the
<a href="https://cran.r-project.org/web/packages/glmnet/vignettes/relax.pdf">glmnet 3.0 vignette</a>:
<em>The debiasing will potentially improve prediction performance,
and CV will typically select a model with a smaller number of variables.</em></p>
</div>
<div id="examination-of-sensitivity-vs-specificity-1" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> Examination of sensitivity vs specificity</h2>
<p>In the results above we reported error rates without inspecting the
sensitivity versus specificity trade-off. ROC curves can be examined
to get a sense of the trade-off.</p>
<div id="training-data-out-of-fold-roc-curves-1" class="section level3" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> Training data out-of-fold ROC curves</h3>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="brca-rnaseseq-explore-sparsity.html#cb155-1"></a><span class="co">### CLEAR CACHE</span></span>
<span id="cb155-2"><a href="brca-rnaseseq-explore-sparsity.html#cb155-2"></a><span class="co">### CLEAR CACHE</span></span>
<span id="cb155-3"><a href="brca-rnaseseq-explore-sparsity.html#cb155-3"></a></span>
<span id="cb155-4"><a href="brca-rnaseseq-explore-sparsity.html#cb155-4"></a><span class="co"># train</span></span>
<span id="cb155-5"><a href="brca-rnaseseq-explore-sparsity.html#cb155-5"></a><span class="co"># lasso</span></span>
<span id="cb155-6"><a href="brca-rnaseseq-explore-sparsity.html#cb155-6"></a>ndx_1se &lt;-<span class="st"> </span><span class="kw">match</span>(brcaRna_cv_lasso<span class="op">$</span>lambda<span class="fl">.1</span>se,brcaRna_cv_lasso<span class="op">$</span>lambda)</span>
<span id="cb155-7"><a href="brca-rnaseseq-explore-sparsity.html#cb155-7"></a>train_lasso_oofProb_vec &lt;-<span class="st"> </span><span class="kw">logistic_f</span>(brcaRna_cv_lasso<span class="op">$</span>fit.preval[,ndx_1se])</span>
<span id="cb155-8"><a href="brca-rnaseseq-explore-sparsity.html#cb155-8"></a>train_lasso_roc &lt;-<span class="st"> </span>pROC<span class="op">::</span><span class="kw">roc</span>(</span>
<span id="cb155-9"><a href="brca-rnaseseq-explore-sparsity.html#cb155-9"></a> <span class="dt">response =</span> <span class="kw">as.numeric</span>(brcaRna_train_group_vec<span class="op">==</span><span class="st">&#39;LumA&#39;</span>),</span>
<span id="cb155-10"><a href="brca-rnaseseq-explore-sparsity.html#cb155-10"></a> <span class="dt">predictor =</span> train_lasso_oofProb_vec)</span></code></pre></div>
<pre><code>## Setting levels: control = 0, case = 1</code></pre>
<pre><code>## Setting direction: controls &lt; cases</code></pre>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="brca-rnaseseq-explore-sparsity.html#cb158-1"></a><span class="co"># enet</span></span>
<span id="cb158-2"><a href="brca-rnaseseq-explore-sparsity.html#cb158-2"></a>ndx_1se &lt;-<span class="st"> </span><span class="kw">match</span>(brcaRna_cv_enet<span class="op">$</span>lambda<span class="fl">.1</span>se,brcaRna_cv_enet<span class="op">$</span>lambda)</span>
<span id="cb158-3"><a href="brca-rnaseseq-explore-sparsity.html#cb158-3"></a>train_enet_oofProb_vec &lt;-<span class="st"> </span><span class="kw">logistic_f</span>(brcaRna_cv_enet<span class="op">$</span>fit.preval[,ndx_1se])</span>
<span id="cb158-4"><a href="brca-rnaseseq-explore-sparsity.html#cb158-4"></a>train_enet_roc &lt;-<span class="st"> </span>pROC<span class="op">::</span><span class="kw">roc</span>(</span>
<span id="cb158-5"><a href="brca-rnaseseq-explore-sparsity.html#cb158-5"></a> <span class="dt">response =</span> <span class="kw">as.numeric</span>(brcaRna_train_group_vec<span class="op">==</span><span class="st">&#39;LumA&#39;</span>),</span>
<span id="cb158-6"><a href="brca-rnaseseq-explore-sparsity.html#cb158-6"></a> <span class="dt">predictor =</span> train_enet_oofProb_vec)</span></code></pre></div>
<pre><code>## Setting levels: control = 0, case = 1
## Setting direction: controls &lt; cases</code></pre>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="brca-rnaseseq-explore-sparsity.html#cb160-1"></a><span class="co"># lasso - relaxed</span></span>
<span id="cb160-2"><a href="brca-rnaseseq-explore-sparsity.html#cb160-2"></a>ndx_1se &lt;-<span class="st"> </span><span class="kw">match</span>(brcaRna_cv_lassoR<span class="op">$</span>lambda<span class="fl">.1</span>se,brcaRna_cv_lassoR<span class="op">$</span>lambda)</span>
<span id="cb160-3"><a href="brca-rnaseseq-explore-sparsity.html#cb160-3"></a>train_relaxed_oofProb_vec &lt;-<span class="st"> </span><span class="kw">logistic_f</span>(brcaRna_cv_lassoR<span class="op">$</span>fit.preval[[<span class="st">&#39;g:0&#39;</span>]][,ndx_1se])</span>
<span id="cb160-4"><a href="brca-rnaseseq-explore-sparsity.html#cb160-4"></a>train_relaxed_roc &lt;-<span class="st"> </span>pROC<span class="op">::</span><span class="kw">roc</span>(</span>
<span id="cb160-5"><a href="brca-rnaseseq-explore-sparsity.html#cb160-5"></a> <span class="dt">response =</span> <span class="kw">as.numeric</span>(brcaRna_train_group_vec<span class="op">==</span><span class="st">&#39;LumA&#39;</span>),</span>
<span id="cb160-6"><a href="brca-rnaseseq-explore-sparsity.html#cb160-6"></a> <span class="dt">predictor =</span> train_relaxed_oofProb_vec)</span></code></pre></div>
<pre><code>## Setting levels: control = 0, case = 1
## Setting direction: controls &lt; cases</code></pre>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="brca-rnaseseq-explore-sparsity.html#cb162-1"></a><span class="co"># blended mix (gamma=0.5)</span></span>
<span id="cb162-2"><a href="brca-rnaseseq-explore-sparsity.html#cb162-2"></a>ndx_1se &lt;-<span class="st"> </span><span class="kw">match</span>(brcaRna_cv_lassoR<span class="op">$</span>lambda<span class="fl">.1</span>se,brcaRna_cv_lassoR<span class="op">$</span>lambda)</span>
<span id="cb162-3"><a href="brca-rnaseseq-explore-sparsity.html#cb162-3"></a>train_blended_oofProb_vec &lt;-<span class="st"> </span><span class="kw">logistic_f</span>(brcaRna_cv_lassoR<span class="op">$</span>fit.preval[[<span class="st">&#39;g:0.5&#39;</span>]][,ndx_1se])</span>
<span id="cb162-4"><a href="brca-rnaseseq-explore-sparsity.html#cb162-4"></a>train_blended_roc &lt;-<span class="st"> </span>pROC<span class="op">::</span><span class="kw">roc</span>(</span>
<span id="cb162-5"><a href="brca-rnaseseq-explore-sparsity.html#cb162-5"></a> <span class="dt">response =</span> <span class="kw">as.numeric</span>(brcaRna_train_group_vec<span class="op">==</span><span class="st">&#39;LumA&#39;</span>),</span>
<span id="cb162-6"><a href="brca-rnaseseq-explore-sparsity.html#cb162-6"></a> <span class="dt">predictor =</span> train_blended_oofProb_vec)</span></code></pre></div>
<pre><code>## Setting levels: control = 0, case = 1
## Setting direction: controls &lt; cases</code></pre>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="brca-rnaseseq-explore-sparsity.html#cb164-1"></a><span class="kw">plot</span>(train_lasso_roc, <span class="dt">col =</span> col_vec[<span class="dv">1</span>])</span>
<span id="cb164-2"><a href="brca-rnaseseq-explore-sparsity.html#cb164-2"></a><span class="kw">lines</span>(train_enet_roc, <span class="dt">col =</span> col_vec[<span class="dv">2</span>])</span>
<span id="cb164-3"><a href="brca-rnaseseq-explore-sparsity.html#cb164-3"></a><span class="kw">lines</span>(train_relaxed_roc, <span class="dt">col =</span> col_vec[<span class="dv">3</span>])</span>
<span id="cb164-4"><a href="brca-rnaseseq-explore-sparsity.html#cb164-4"></a><span class="kw">lines</span>(train_blended_roc, <span class="dt">col =</span> col_vec[<span class="dv">4</span>])</span>
<span id="cb164-5"><a href="brca-rnaseseq-explore-sparsity.html#cb164-5"></a></span>
<span id="cb164-6"><a href="brca-rnaseseq-explore-sparsity.html#cb164-6"></a><span class="kw">legend</span>(<span class="st">&#39;bottomright&#39;</span>, <span class="dt">title=</span><span class="st">&#39;AUC&#39;</span>,</span>
<span id="cb164-7"><a href="brca-rnaseseq-explore-sparsity.html#cb164-7"></a> <span class="dt">legend=</span><span class="kw">c</span>(</span>
<span id="cb164-8"><a href="brca-rnaseseq-explore-sparsity.html#cb164-8"></a>  <span class="kw">paste</span>(<span class="st">&#39;lasso =&#39;</span>, <span class="kw">round</span>(train_lasso_roc[[<span class="st">&#39;auc&#39;</span>]],<span class="dv">3</span>)),</span>
<span id="cb164-9"><a href="brca-rnaseseq-explore-sparsity.html#cb164-9"></a>  <span class="kw">paste</span>(<span class="st">&#39;enet =&#39;</span>, <span class="kw">round</span>(train_enet_roc[[<span class="st">&#39;auc&#39;</span>]],<span class="dv">3</span>)),</span>
<span id="cb164-10"><a href="brca-rnaseseq-explore-sparsity.html#cb164-10"></a>  <span class="kw">paste</span>(<span class="st">&#39;relaxed =&#39;</span>, <span class="kw">round</span>(train_relaxed_roc[[<span class="st">&#39;auc&#39;</span>]],<span class="dv">3</span>)),</span>
<span id="cb164-11"><a href="brca-rnaseseq-explore-sparsity.html#cb164-11"></a>  <span class="kw">paste</span>(<span class="st">&#39;blended =&#39;</span>, <span class="kw">round</span>(train_blended_roc[[<span class="st">&#39;auc&#39;</span>]],<span class="dv">3</span>))</span>
<span id="cb164-12"><a href="brca-rnaseseq-explore-sparsity.html#cb164-12"></a> ),</span>
<span id="cb164-13"><a href="brca-rnaseseq-explore-sparsity.html#cb164-13"></a> <span class="dt">text.col =</span> col_vec[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>],</span>
<span id="cb164-14"><a href="brca-rnaseseq-explore-sparsity.html#cb164-14"></a> <span class="dt">bty=</span><span class="st">&#39;n&#39;</span></span>
<span id="cb164-15"><a href="brca-rnaseseq-explore-sparsity.html#cb164-15"></a>)</span></code></pre></div>
<div class="figure"><span id="fig:brcaRna-glmnetFit-trainROC"></span>
<img src="Static/figures/brcaRna-glmnetFit-trainROC-1.png" alt="Train data out-of-sample ROCs" width="480" />
<p class="caption">
Figure 7.3: Train data out-of-sample ROCs
</p>
</div>
<p>Compare thresholds for 90% Specificity:</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="brca-rnaseseq-explore-sparsity.html#cb165-1"></a><span class="co">### CLEAR CACHE</span></span>
<span id="cb165-2"><a href="brca-rnaseseq-explore-sparsity.html#cb165-2"></a></span>
<span id="cb165-3"><a href="brca-rnaseseq-explore-sparsity.html#cb165-3"></a> lasso_ndx &lt;-<span class="st"> </span><span class="kw">with</span>(<span class="kw">as.data.frame</span>(pROC<span class="op">::</span><span class="kw">coords</span>(train_lasso_roc, <span class="dt">transpose=</span>F)), </span>
<span id="cb165-4"><a href="brca-rnaseseq-explore-sparsity.html#cb165-4"></a>   <span class="kw">min</span>(<span class="kw">which</span>(specificity <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.9</span>)))</span>
<span id="cb165-5"><a href="brca-rnaseseq-explore-sparsity.html#cb165-5"></a></span>
<span id="cb165-6"><a href="brca-rnaseseq-explore-sparsity.html#cb165-6"></a> enet_ndx &lt;-<span class="st"> </span><span class="kw">with</span>(<span class="kw">as.data.frame</span>(pROC<span class="op">::</span><span class="kw">coords</span>(train_enet_roc, <span class="dt">transpose=</span>F)), </span>
<span id="cb165-7"><a href="brca-rnaseseq-explore-sparsity.html#cb165-7"></a>   <span class="kw">min</span>(<span class="kw">which</span>(specificity <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.9</span>)))</span>
<span id="cb165-8"><a href="brca-rnaseseq-explore-sparsity.html#cb165-8"></a></span>
<span id="cb165-9"><a href="brca-rnaseseq-explore-sparsity.html#cb165-9"></a> lassoR_ndx &lt;-<span class="st"> </span><span class="kw">with</span>(<span class="kw">as.data.frame</span>(pROC<span class="op">::</span><span class="kw">coords</span>(train_relaxed_roc, <span class="dt">transpose=</span>F)), </span>
<span id="cb165-10"><a href="brca-rnaseseq-explore-sparsity.html#cb165-10"></a>   <span class="kw">min</span>(<span class="kw">which</span>(specificity <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.9</span>)))</span>
<span id="cb165-11"><a href="brca-rnaseseq-explore-sparsity.html#cb165-11"></a></span>
<span id="cb165-12"><a href="brca-rnaseseq-explore-sparsity.html#cb165-12"></a> blended_ndx &lt;-<span class="st"> </span><span class="kw">with</span>(<span class="kw">as.data.frame</span>(pROC<span class="op">::</span><span class="kw">coords</span>(train_blended_roc, <span class="dt">transpose=</span>F)), </span>
<span id="cb165-13"><a href="brca-rnaseseq-explore-sparsity.html#cb165-13"></a>   <span class="kw">min</span>(<span class="kw">which</span>(specificity <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.9</span>)))</span>
<span id="cb165-14"><a href="brca-rnaseseq-explore-sparsity.html#cb165-14"></a></span>
<span id="cb165-15"><a href="brca-rnaseseq-explore-sparsity.html#cb165-15"></a>  spec90_frm &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">rbind</span>(</span>
<span id="cb165-16"><a href="brca-rnaseseq-explore-sparsity.html#cb165-16"></a>  <span class="dt">lasso=</span><span class="kw">as.data.frame</span>(pROC<span class="op">::</span><span class="kw">coords</span>(train_lasso_roc, <span class="dt">transpose=</span>F))[lasso_ndx,],</span>
<span id="cb165-17"><a href="brca-rnaseseq-explore-sparsity.html#cb165-17"></a>  <span class="dt">enet=</span><span class="kw">as.data.frame</span>(pROC<span class="op">::</span><span class="kw">coords</span>(train_enet_roc, <span class="dt">transpose=</span>F))[enet_ndx,],</span>
<span id="cb165-18"><a href="brca-rnaseseq-explore-sparsity.html#cb165-18"></a>  <span class="dt">relaxed=</span><span class="kw">as.data.frame</span>(pROC<span class="op">::</span><span class="kw">coords</span>(train_relaxed_roc, <span class="dt">transpose=</span>F))[lassoR_ndx,],</span>
<span id="cb165-19"><a href="brca-rnaseseq-explore-sparsity.html#cb165-19"></a>  <span class="dt">blended=</span><span class="kw">as.data.frame</span>(pROC<span class="op">::</span><span class="kw">coords</span>(train_blended_roc, <span class="dt">transpose=</span>F))[blended_ndx,]</span>
<span id="cb165-20"><a href="brca-rnaseseq-explore-sparsity.html#cb165-20"></a> ))</span>
<span id="cb165-21"><a href="brca-rnaseseq-explore-sparsity.html#cb165-21"></a></span>
<span id="cb165-22"><a href="brca-rnaseseq-explore-sparsity.html#cb165-22"></a></span>
<span id="cb165-23"><a href="brca-rnaseseq-explore-sparsity.html#cb165-23"></a>knitr<span class="op">::</span><span class="kw">kable</span>(spec90_frm,</span>
<span id="cb165-24"><a href="brca-rnaseseq-explore-sparsity.html#cb165-24"></a>  <span class="dt">digits=</span><span class="dv">3</span>,</span>
<span id="cb165-25"><a href="brca-rnaseseq-explore-sparsity.html#cb165-25"></a>  <span class="dt">caption=</span><span class="st">&quot;Specificity = .90 Coordinates&quot;</span></span>
<span id="cb165-26"><a href="brca-rnaseseq-explore-sparsity.html#cb165-26"></a>) <span class="op">%&gt;%</span></span>
<span id="cb165-27"><a href="brca-rnaseseq-explore-sparsity.html#cb165-27"></a><span class="st">  </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F)</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:brcaRna-glmnetFit-thresh90">Table 7.5: </span>Specificity = .90 Coordinates
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
threshold
</th>
<th style="text-align:right;">
specificity
</th>
<th style="text-align:right;">
sensitivity
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
lasso
</td>
<td style="text-align:right;">
0.672
</td>
<td style="text-align:right;">
0.901
</td>
<td style="text-align:right;">
0.850
</td>
</tr>
<tr>
<td style="text-align:left;">
enet
</td>
<td style="text-align:right;">
0.661
</td>
<td style="text-align:right;">
0.901
</td>
<td style="text-align:right;">
0.876
</td>
</tr>
<tr>
<td style="text-align:left;">
relaxed
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.901
</td>
<td style="text-align:right;">
0.625
</td>
</tr>
<tr>
<td style="text-align:left;">
blended
</td>
<td style="text-align:right;">
0.999
</td>
<td style="text-align:right;">
0.901
</td>
<td style="text-align:right;">
0.659
</td>
</tr>
</tbody>
</table>
<p>This is strange.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="brca-rnaseseq-explore-sparsity.html#cb166-1"></a><span class="co">### CLEAR CACHE</span></span>
<span id="cb166-2"><a href="brca-rnaseseq-explore-sparsity.html#cb166-2"></a></span>
<span id="cb166-3"><a href="brca-rnaseseq-explore-sparsity.html#cb166-3"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="dt">oma =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb166-4"><a href="brca-rnaseseq-explore-sparsity.html#cb166-4"></a></span>
<span id="cb166-5"><a href="brca-rnaseseq-explore-sparsity.html#cb166-5"></a><span class="co"># lasso</span></span>
<span id="cb166-6"><a href="brca-rnaseseq-explore-sparsity.html#cb166-6"></a><span class="kw">plot</span>(<span class="kw">density</span>(train_lasso_oofProb_vec[brcaRna_train_group_vec <span class="op">==</span><span class="st"> &quot;Other&quot;</span>]),</span>
<span id="cb166-7"><a href="brca-rnaseseq-explore-sparsity.html#cb166-7"></a>  <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">main =</span> <span class="st">&quot;&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;green&quot;</span></span>
<span id="cb166-8"><a href="brca-rnaseseq-explore-sparsity.html#cb166-8"></a>)</span>
<span id="cb166-9"><a href="brca-rnaseseq-explore-sparsity.html#cb166-9"></a><span class="kw">lines</span>(<span class="kw">density</span>(train_lasso_oofProb_vec[brcaRna_train_group_vec <span class="op">==</span><span class="st"> &quot;LumA&quot;</span>]),</span>
<span id="cb166-10"><a href="brca-rnaseseq-explore-sparsity.html#cb166-10"></a>  <span class="dt">col =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb166-11"><a href="brca-rnaseseq-explore-sparsity.html#cb166-11"></a>)</span>
<span id="cb166-12"><a href="brca-rnaseseq-explore-sparsity.html#cb166-12"></a><span class="kw">title</span>(<span class="st">&quot;lasso&quot;</span>)</span>
<span id="cb166-13"><a href="brca-rnaseseq-explore-sparsity.html#cb166-13"></a><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&quot;Other&quot;</span>, <span class="st">&quot;LumA&quot;</span>), <span class="dt">text.col =</span> <span class="kw">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>))</span>
<span id="cb166-14"><a href="brca-rnaseseq-explore-sparsity.html#cb166-14"></a></span>
<span id="cb166-15"><a href="brca-rnaseseq-explore-sparsity.html#cb166-15"></a><span class="co"># enet</span></span>
<span id="cb166-16"><a href="brca-rnaseseq-explore-sparsity.html#cb166-16"></a><span class="kw">plot</span>(<span class="kw">density</span>(train_enet_oofProb_vec[brcaRna_train_group_vec <span class="op">==</span><span class="st"> &quot;Other&quot;</span>]),</span>
<span id="cb166-17"><a href="brca-rnaseseq-explore-sparsity.html#cb166-17"></a>  <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">main =</span> <span class="st">&quot;&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;green&quot;</span></span>
<span id="cb166-18"><a href="brca-rnaseseq-explore-sparsity.html#cb166-18"></a>)</span>
<span id="cb166-19"><a href="brca-rnaseseq-explore-sparsity.html#cb166-19"></a><span class="kw">lines</span>(<span class="kw">density</span>(train_enet_oofProb_vec[brcaRna_train_group_vec <span class="op">==</span><span class="st"> &quot;LumA&quot;</span>]),</span>
<span id="cb166-20"><a href="brca-rnaseseq-explore-sparsity.html#cb166-20"></a>  <span class="dt">col =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb166-21"><a href="brca-rnaseseq-explore-sparsity.html#cb166-21"></a>)</span>
<span id="cb166-22"><a href="brca-rnaseseq-explore-sparsity.html#cb166-22"></a><span class="kw">title</span>(<span class="st">&quot;enet&quot;</span>)</span>
<span id="cb166-23"><a href="brca-rnaseseq-explore-sparsity.html#cb166-23"></a></span>
<span id="cb166-24"><a href="brca-rnaseseq-explore-sparsity.html#cb166-24"></a><span class="co"># lassoR</span></span>
<span id="cb166-25"><a href="brca-rnaseseq-explore-sparsity.html#cb166-25"></a><span class="kw">plot</span>(<span class="kw">density</span>(train_relaxed_oofProb_vec[brcaRna_train_group_vec <span class="op">==</span><span class="st"> &quot;Other&quot;</span>]),</span>
<span id="cb166-26"><a href="brca-rnaseseq-explore-sparsity.html#cb166-26"></a>  <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">main =</span> <span class="st">&quot;&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;green&quot;</span></span>
<span id="cb166-27"><a href="brca-rnaseseq-explore-sparsity.html#cb166-27"></a>)</span>
<span id="cb166-28"><a href="brca-rnaseseq-explore-sparsity.html#cb166-28"></a><span class="kw">lines</span>(<span class="kw">density</span>(train_relaxed_oofProb_vec[brcaRna_train_group_vec <span class="op">==</span><span class="st"> &quot;LumA&quot;</span>]),</span>
<span id="cb166-29"><a href="brca-rnaseseq-explore-sparsity.html#cb166-29"></a>  <span class="dt">col =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb166-30"><a href="brca-rnaseseq-explore-sparsity.html#cb166-30"></a>)</span>
<span id="cb166-31"><a href="brca-rnaseseq-explore-sparsity.html#cb166-31"></a><span class="kw">title</span>(<span class="st">&quot;lassoR&quot;</span>)</span>
<span id="cb166-32"><a href="brca-rnaseseq-explore-sparsity.html#cb166-32"></a></span>
<span id="cb166-33"><a href="brca-rnaseseq-explore-sparsity.html#cb166-33"></a><span class="co"># blended</span></span>
<span id="cb166-34"><a href="brca-rnaseseq-explore-sparsity.html#cb166-34"></a><span class="kw">plot</span>(<span class="kw">density</span>(train_blended_oofProb_vec[brcaRna_train_group_vec <span class="op">==</span><span class="st"> &quot;Other&quot;</span>]),</span>
<span id="cb166-35"><a href="brca-rnaseseq-explore-sparsity.html#cb166-35"></a>  <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">main =</span> <span class="st">&quot;&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;green&quot;</span></span>
<span id="cb166-36"><a href="brca-rnaseseq-explore-sparsity.html#cb166-36"></a>)</span>
<span id="cb166-37"><a href="brca-rnaseseq-explore-sparsity.html#cb166-37"></a><span class="kw">lines</span>(<span class="kw">density</span>(train_blended_oofProb_vec[brcaRna_train_group_vec <span class="op">==</span><span class="st"> &quot;LumA&quot;</span>]),</span>
<span id="cb166-38"><a href="brca-rnaseseq-explore-sparsity.html#cb166-38"></a>  <span class="dt">col =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb166-39"><a href="brca-rnaseseq-explore-sparsity.html#cb166-39"></a>)</span>
<span id="cb166-40"><a href="brca-rnaseseq-explore-sparsity.html#cb166-40"></a><span class="kw">title</span>(<span class="st">&quot;blended&quot;</span>)</span>
<span id="cb166-41"><a href="brca-rnaseseq-explore-sparsity.html#cb166-41"></a></span>
<span id="cb166-42"><a href="brca-rnaseseq-explore-sparsity.html#cb166-42"></a><span class="kw">mtext</span>(<span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">outer =</span> T, <span class="st">&quot;out-of-fold predicted probability&quot;</span>, <span class="dt">cex =</span> <span class="fl">1.25</span>)</span>
<span id="cb166-43"><a href="brca-rnaseseq-explore-sparsity.html#cb166-43"></a><span class="kw">mtext</span>(<span class="dt">side =</span> <span class="dv">2</span>, <span class="dt">outer =</span> T, <span class="st">&quot;density&quot;</span>, <span class="dt">cex =</span> <span class="fl">1.25</span>)</span></code></pre></div>
<div class="figure"><span id="fig:brcaRna-glmnetFit-trainOOFprops"></span>
<img src="Static/figures/brcaRna-glmnetFit-trainOOFprops-1.png" alt="Train data out-of-fold predicted probabilities" width="960" />
<p class="caption">
Figure 7.4: Train data out-of-fold predicted probabilities
</p>
</div>
<p>The relaxed lasso fit results in essentially dichotomized predicted probability
distribution - predicted probabilities are very close to 0 or 1.</p>
<p>Look at test data ROC curves.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="brca-rnaseseq-explore-sparsity.html#cb167-1"></a><span class="co">### CLEAR CACHE</span></span>
<span id="cb167-2"><a href="brca-rnaseseq-explore-sparsity.html#cb167-2"></a><span class="co">### CLEAR CACHE</span></span>
<span id="cb167-3"><a href="brca-rnaseseq-explore-sparsity.html#cb167-3"></a><span class="co"># plot all</span></span>
<span id="cb167-4"><a href="brca-rnaseseq-explore-sparsity.html#cb167-4"></a><span class="kw">plot</span>(test_lasso_roc, <span class="dt">col =</span> col_vec[<span class="dv">1</span>])</span>
<span id="cb167-5"><a href="brca-rnaseseq-explore-sparsity.html#cb167-5"></a><span class="kw">lines</span>(test_enet_roc, <span class="dt">col =</span> col_vec[<span class="dv">2</span>])</span>
<span id="cb167-6"><a href="brca-rnaseseq-explore-sparsity.html#cb167-6"></a><span class="kw">lines</span>(test_relaxed_roc, <span class="dt">col =</span> col_vec[<span class="dv">3</span>])</span>
<span id="cb167-7"><a href="brca-rnaseseq-explore-sparsity.html#cb167-7"></a><span class="kw">lines</span>(test_blended_roc, <span class="dt">col =</span> col_vec[<span class="dv">4</span>])</span>
<span id="cb167-8"><a href="brca-rnaseseq-explore-sparsity.html#cb167-8"></a></span>
<span id="cb167-9"><a href="brca-rnaseseq-explore-sparsity.html#cb167-9"></a><span class="kw">legend</span>(<span class="st">&quot;bottomright&quot;</span>,</span>
<span id="cb167-10"><a href="brca-rnaseseq-explore-sparsity.html#cb167-10"></a>  <span class="dt">title =</span> <span class="st">&quot;AUC&quot;</span>,</span>
<span id="cb167-11"><a href="brca-rnaseseq-explore-sparsity.html#cb167-11"></a>  <span class="dt">legend =</span> <span class="kw">c</span>(</span>
<span id="cb167-12"><a href="brca-rnaseseq-explore-sparsity.html#cb167-12"></a>    <span class="kw">paste</span>(<span class="st">&quot;lasso =&quot;</span>, <span class="kw">round</span>(test_lasso_roc[[<span class="st">&quot;auc&quot;</span>]], <span class="dv">3</span>)),</span>
<span id="cb167-13"><a href="brca-rnaseseq-explore-sparsity.html#cb167-13"></a>    <span class="kw">paste</span>(<span class="st">&quot;enet =&quot;</span>, <span class="kw">round</span>(test_enet_roc[[<span class="st">&quot;auc&quot;</span>]], <span class="dv">3</span>)),</span>
<span id="cb167-14"><a href="brca-rnaseseq-explore-sparsity.html#cb167-14"></a>    <span class="kw">paste</span>(<span class="st">&quot;relaxed =&quot;</span>, <span class="kw">round</span>(test_relaxed_roc[[<span class="st">&quot;auc&quot;</span>]], <span class="dv">3</span>)),</span>
<span id="cb167-15"><a href="brca-rnaseseq-explore-sparsity.html#cb167-15"></a>    <span class="kw">paste</span>(<span class="st">&quot;blended =&quot;</span>, <span class="kw">round</span>(test_blended_roc[[<span class="st">&quot;auc&quot;</span>]], <span class="dv">3</span>))</span>
<span id="cb167-16"><a href="brca-rnaseseq-explore-sparsity.html#cb167-16"></a>  ),</span>
<span id="cb167-17"><a href="brca-rnaseseq-explore-sparsity.html#cb167-17"></a>  <span class="dt">text.col =</span> col_vec[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>],</span>
<span id="cb167-18"><a href="brca-rnaseseq-explore-sparsity.html#cb167-18"></a>  <span class="dt">bty=</span><span class="st">&#39;n&#39;</span></span>
<span id="cb167-19"><a href="brca-rnaseseq-explore-sparsity.html#cb167-19"></a>)</span></code></pre></div>
<div class="figure"><span id="fig:brcaRna-glmnetFit-testROC2"></span>
<img src="Static/figures/brcaRna-glmnetFit-testROC2-1.png" alt="Test data out-of-sample ROCs" width="480" />
<p class="caption">
Figure 7.5: Test data out-of-sample ROCs
</p>
</div>
<p>Look at densities of predicted probabilities.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="brca-rnaseseq-explore-sparsity.html#cb168-1"></a><span class="co">### CLEAR CACHE</span></span>
<span id="cb168-2"><a href="brca-rnaseseq-explore-sparsity.html#cb168-2"></a></span>
<span id="cb168-3"><a href="brca-rnaseseq-explore-sparsity.html#cb168-3"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="dt">oma =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb168-4"><a href="brca-rnaseseq-explore-sparsity.html#cb168-4"></a></span>
<span id="cb168-5"><a href="brca-rnaseseq-explore-sparsity.html#cb168-5"></a><span class="co"># lasso</span></span>
<span id="cb168-6"><a href="brca-rnaseseq-explore-sparsity.html#cb168-6"></a><span class="kw">plot</span>(<span class="kw">density</span>(test_lasso_predProb_vec[brcaRna_test_group_vec <span class="op">==</span><span class="st"> &quot;Other&quot;</span>]),</span>
<span id="cb168-7"><a href="brca-rnaseseq-explore-sparsity.html#cb168-7"></a>  <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">main =</span> <span class="st">&quot;&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;green&quot;</span></span>
<span id="cb168-8"><a href="brca-rnaseseq-explore-sparsity.html#cb168-8"></a>)</span>
<span id="cb168-9"><a href="brca-rnaseseq-explore-sparsity.html#cb168-9"></a><span class="kw">lines</span>(<span class="kw">density</span>(test_lasso_predProb_vec[brcaRna_test_group_vec <span class="op">==</span><span class="st"> &quot;LumA&quot;</span>]),</span>
<span id="cb168-10"><a href="brca-rnaseseq-explore-sparsity.html#cb168-10"></a>  <span class="dt">col =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb168-11"><a href="brca-rnaseseq-explore-sparsity.html#cb168-11"></a>)</span>
<span id="cb168-12"><a href="brca-rnaseseq-explore-sparsity.html#cb168-12"></a><span class="kw">title</span>(<span class="st">&quot;lasso&quot;</span>)</span>
<span id="cb168-13"><a href="brca-rnaseseq-explore-sparsity.html#cb168-13"></a><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&quot;Other&quot;</span>, <span class="st">&quot;LumA&quot;</span>), <span class="dt">text.col =</span> <span class="kw">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>))</span>
<span id="cb168-14"><a href="brca-rnaseseq-explore-sparsity.html#cb168-14"></a></span>
<span id="cb168-15"><a href="brca-rnaseseq-explore-sparsity.html#cb168-15"></a><span class="co"># enet</span></span>
<span id="cb168-16"><a href="brca-rnaseseq-explore-sparsity.html#cb168-16"></a><span class="kw">plot</span>(<span class="kw">density</span>(test_enet_predProb_vec[brcaRna_test_group_vec <span class="op">==</span><span class="st"> &quot;Other&quot;</span>]),</span>
<span id="cb168-17"><a href="brca-rnaseseq-explore-sparsity.html#cb168-17"></a>  <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">main =</span> <span class="st">&quot;&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;green&quot;</span></span>
<span id="cb168-18"><a href="brca-rnaseseq-explore-sparsity.html#cb168-18"></a>)</span>
<span id="cb168-19"><a href="brca-rnaseseq-explore-sparsity.html#cb168-19"></a><span class="kw">lines</span>(<span class="kw">density</span>(test_enet_predProb_vec[brcaRna_test_group_vec <span class="op">==</span><span class="st"> &quot;LumA&quot;</span>]),</span>
<span id="cb168-20"><a href="brca-rnaseseq-explore-sparsity.html#cb168-20"></a>  <span class="dt">col =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb168-21"><a href="brca-rnaseseq-explore-sparsity.html#cb168-21"></a>)</span>
<span id="cb168-22"><a href="brca-rnaseseq-explore-sparsity.html#cb168-22"></a><span class="kw">title</span>(<span class="st">&quot;enet&quot;</span>)</span>
<span id="cb168-23"><a href="brca-rnaseseq-explore-sparsity.html#cb168-23"></a></span>
<span id="cb168-24"><a href="brca-rnaseseq-explore-sparsity.html#cb168-24"></a><span class="co"># relaxed</span></span>
<span id="cb168-25"><a href="brca-rnaseseq-explore-sparsity.html#cb168-25"></a><span class="kw">plot</span>(<span class="kw">density</span>(test_relaxed_predProb_vec[brcaRna_test_group_vec <span class="op">==</span><span class="st"> &quot;Other&quot;</span>]),</span>
<span id="cb168-26"><a href="brca-rnaseseq-explore-sparsity.html#cb168-26"></a>  <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">main =</span> <span class="st">&quot;&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;green&quot;</span></span>
<span id="cb168-27"><a href="brca-rnaseseq-explore-sparsity.html#cb168-27"></a>)</span>
<span id="cb168-28"><a href="brca-rnaseseq-explore-sparsity.html#cb168-28"></a><span class="kw">lines</span>(<span class="kw">density</span>(test_relaxed_predProb_vec[brcaRna_test_group_vec <span class="op">==</span><span class="st"> &quot;LumA&quot;</span>]),</span>
<span id="cb168-29"><a href="brca-rnaseseq-explore-sparsity.html#cb168-29"></a>  <span class="dt">col =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb168-30"><a href="brca-rnaseseq-explore-sparsity.html#cb168-30"></a>)</span>
<span id="cb168-31"><a href="brca-rnaseseq-explore-sparsity.html#cb168-31"></a><span class="kw">title</span>(<span class="st">&quot;relaxed&quot;</span>)</span>
<span id="cb168-32"><a href="brca-rnaseseq-explore-sparsity.html#cb168-32"></a></span>
<span id="cb168-33"><a href="brca-rnaseseq-explore-sparsity.html#cb168-33"></a><span class="co">#sapply(split(test_relaxed_predProb_vec, brcaRna_test_group_vec), summary)</span></span>
<span id="cb168-34"><a href="brca-rnaseseq-explore-sparsity.html#cb168-34"></a></span>
<span id="cb168-35"><a href="brca-rnaseseq-explore-sparsity.html#cb168-35"></a></span>
<span id="cb168-36"><a href="brca-rnaseseq-explore-sparsity.html#cb168-36"></a><span class="co"># blended</span></span>
<span id="cb168-37"><a href="brca-rnaseseq-explore-sparsity.html#cb168-37"></a><span class="kw">plot</span>(<span class="kw">density</span>(test_blended_predProb_vec[brcaRna_test_group_vec <span class="op">==</span><span class="st"> &quot;Other&quot;</span>]),</span>
<span id="cb168-38"><a href="brca-rnaseseq-explore-sparsity.html#cb168-38"></a>  <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">main =</span> <span class="st">&quot;&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;green&quot;</span></span>
<span id="cb168-39"><a href="brca-rnaseseq-explore-sparsity.html#cb168-39"></a>)</span>
<span id="cb168-40"><a href="brca-rnaseseq-explore-sparsity.html#cb168-40"></a><span class="kw">lines</span>(<span class="kw">density</span>(test_blended_predProb_vec[brcaRna_test_group_vec <span class="op">==</span><span class="st"> &quot;LumA&quot;</span>]),</span>
<span id="cb168-41"><a href="brca-rnaseseq-explore-sparsity.html#cb168-41"></a>  <span class="dt">col =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb168-42"><a href="brca-rnaseseq-explore-sparsity.html#cb168-42"></a>)</span>
<span id="cb168-43"><a href="brca-rnaseseq-explore-sparsity.html#cb168-43"></a><span class="kw">title</span>(<span class="st">&quot;blended&quot;</span>)</span>
<span id="cb168-44"><a href="brca-rnaseseq-explore-sparsity.html#cb168-44"></a></span>
<span id="cb168-45"><a href="brca-rnaseseq-explore-sparsity.html#cb168-45"></a><span class="kw">mtext</span>(<span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">outer =</span> T, <span class="st">&quot;test set predicted probability&quot;</span>, <span class="dt">cex =</span> <span class="fl">1.25</span>)</span>
<span id="cb168-46"><a href="brca-rnaseseq-explore-sparsity.html#cb168-46"></a><span class="kw">mtext</span>(<span class="dt">side =</span> <span class="dv">2</span>, <span class="dt">outer =</span> T, <span class="st">&quot;density&quot;</span>, <span class="dt">cex =</span> <span class="fl">1.25</span>)</span></code></pre></div>
<div class="figure"><span id="fig:brcaRna-glmnetFit-testOOFprobs"></span>
<img src="Static/figures/brcaRna-glmnetFit-testOOFprobs-1.png" alt="Test data out-of-fold predicted probabilities" width="960" />
<p class="caption">
Figure 7.6: Test data out-of-fold predicted probabilities
</p>
</div>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="brca-rnaseseq-explore-sparsity.html#cb169-1"></a><span class="co">### CLEAR CACHE</span></span>
<span id="cb169-2"><a href="brca-rnaseseq-explore-sparsity.html#cb169-2"></a></span>
<span id="cb169-3"><a href="brca-rnaseseq-explore-sparsity.html#cb169-3"></a><span class="co"># Define plotting function</span></span>
<span id="cb169-4"><a href="brca-rnaseseq-explore-sparsity.html#cb169-4"></a>bxpPredProb_f &lt;-<span class="st"> </span><span class="cf">function</span>(cv_fit, <span class="dt">Gamma=</span><span class="ot">NULL</span>) {</span>
<span id="cb169-5"><a href="brca-rnaseseq-explore-sparsity.html#cb169-5"></a>  <span class="co"># Train - preval is out-of-fold linear predictor for training design points</span></span>
<span id="cb169-6"><a href="brca-rnaseseq-explore-sparsity.html#cb169-6"></a>  onese_ndx &lt;-<span class="st"> </span><span class="kw">match</span>(cv_fit<span class="op">$</span>lambda<span class="fl">.1</span>se, cv_fit<span class="op">$</span>lambda)</span>
<span id="cb169-7"><a href="brca-rnaseseq-explore-sparsity.html#cb169-7"></a>  <span class="cf">if</span>(<span class="kw">is.null</span>(Gamma)) </span>
<span id="cb169-8"><a href="brca-rnaseseq-explore-sparsity.html#cb169-8"></a>   train_1se_preval_vec &lt;-<span class="st"> </span>cv_fit<span class="op">$</span>fit.preval[, onese_ndx] <span class="cf">else</span></span>
<span id="cb169-9"><a href="brca-rnaseseq-explore-sparsity.html#cb169-9"></a>   train_1se_preval_vec &lt;-<span class="st"> </span>cv_fit<span class="op">$</span>fit.preval[[Gamma]][, onese_ndx] </span>
<span id="cb169-10"><a href="brca-rnaseseq-explore-sparsity.html#cb169-10"></a></span>
<span id="cb169-11"><a href="brca-rnaseseq-explore-sparsity.html#cb169-11"></a>  train_1se_predProb_vec &lt;-<span class="st"> </span><span class="kw">logistic_f</span>(train_1se_preval_vec)</span>
<span id="cb169-12"><a href="brca-rnaseseq-explore-sparsity.html#cb169-12"></a></span>
<span id="cb169-13"><a href="brca-rnaseseq-explore-sparsity.html#cb169-13"></a>  <span class="co"># Test</span></span>
<span id="cb169-14"><a href="brca-rnaseseq-explore-sparsity.html#cb169-14"></a>  test_1se_predProb_vec &lt;-<span class="st"> </span><span class="kw">predict</span>(</span>
<span id="cb169-15"><a href="brca-rnaseseq-explore-sparsity.html#cb169-15"></a>    cv_fit,</span>
<span id="cb169-16"><a href="brca-rnaseseq-explore-sparsity.html#cb169-16"></a>    <span class="dt">newx =</span> brcaRna_test_geneExpr_mtx,</span>
<span id="cb169-17"><a href="brca-rnaseseq-explore-sparsity.html#cb169-17"></a>    <span class="dt">s =</span> <span class="st">&quot;lambda.1se&quot;</span>,</span>
<span id="cb169-18"><a href="brca-rnaseseq-explore-sparsity.html#cb169-18"></a>    <span class="dt">type =</span> <span class="st">&quot;resp&quot;</span></span>
<span id="cb169-19"><a href="brca-rnaseseq-explore-sparsity.html#cb169-19"></a>  )</span>
<span id="cb169-20"><a href="brca-rnaseseq-explore-sparsity.html#cb169-20"></a></span>
<span id="cb169-21"><a href="brca-rnaseseq-explore-sparsity.html#cb169-21"></a>  tmp &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb169-22"><a href="brca-rnaseseq-explore-sparsity.html#cb169-22"></a>    <span class="dt">train =</span> <span class="kw">split</span>(train_1se_predProb_vec, brcaRna_train_group_vec),</span>
<span id="cb169-23"><a href="brca-rnaseseq-explore-sparsity.html#cb169-23"></a>    <span class="dt">test =</span> <span class="kw">split</span>(test_1se_predProb_vec, brcaRna_test_group_vec)</span>
<span id="cb169-24"><a href="brca-rnaseseq-explore-sparsity.html#cb169-24"></a>  )</span>
<span id="cb169-25"><a href="brca-rnaseseq-explore-sparsity.html#cb169-25"></a>  <span class="kw">names</span>(tmp) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="kw">sub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">.&quot;</span>, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="kw">names</span>(tmp)))</span>
<span id="cb169-26"><a href="brca-rnaseseq-explore-sparsity.html#cb169-26"></a></span>
<span id="cb169-27"><a href="brca-rnaseseq-explore-sparsity.html#cb169-27"></a>  <span class="kw">boxplot</span>(tmp)</span>
<span id="cb169-28"><a href="brca-rnaseseq-explore-sparsity.html#cb169-28"></a>}</span>
<span id="cb169-29"><a href="brca-rnaseseq-explore-sparsity.html#cb169-29"></a></span>
<span id="cb169-30"><a href="brca-rnaseseq-explore-sparsity.html#cb169-30"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="dt">oma =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb169-31"><a href="brca-rnaseseq-explore-sparsity.html#cb169-31"></a></span>
<span id="cb169-32"><a href="brca-rnaseseq-explore-sparsity.html#cb169-32"></a><span class="kw">bxpPredProb_f</span>(brcaRna_cv_lasso)</span>
<span id="cb169-33"><a href="brca-rnaseseq-explore-sparsity.html#cb169-33"></a><span class="kw">title</span>(<span class="st">&#39;lasso&#39;</span>)</span>
<span id="cb169-34"><a href="brca-rnaseseq-explore-sparsity.html#cb169-34"></a></span>
<span id="cb169-35"><a href="brca-rnaseseq-explore-sparsity.html#cb169-35"></a><span class="kw">bxpPredProb_f</span>(brcaRna_cv_enet)</span>
<span id="cb169-36"><a href="brca-rnaseseq-explore-sparsity.html#cb169-36"></a><span class="kw">title</span>(<span class="st">&#39;enet&#39;</span>)</span>
<span id="cb169-37"><a href="brca-rnaseseq-explore-sparsity.html#cb169-37"></a></span>
<span id="cb169-38"><a href="brca-rnaseseq-explore-sparsity.html#cb169-38"></a><span class="kw">bxpPredProb_f</span>(brcaRna_cv_lassoR, <span class="dt">Gamma=</span><span class="st">&#39;g:0&#39;</span>)</span>
<span id="cb169-39"><a href="brca-rnaseseq-explore-sparsity.html#cb169-39"></a><span class="kw">title</span>(<span class="st">&#39;relaxed&#39;</span>)</span>
<span id="cb169-40"><a href="brca-rnaseseq-explore-sparsity.html#cb169-40"></a></span>
<span id="cb169-41"><a href="brca-rnaseseq-explore-sparsity.html#cb169-41"></a><span class="kw">bxpPredProb_f</span>(brcaRna_cv_lassoR, <span class="dt">Gamma=</span><span class="st">&#39;g:0.5&#39;</span>)</span>
<span id="cb169-42"><a href="brca-rnaseseq-explore-sparsity.html#cb169-42"></a><span class="kw">title</span>(<span class="st">&#39;blended&#39;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:brcaRna-glmnetFit-fitPrevalByGroup"></span>
<img src="Static/figures/brcaRna-glmnetFit-fitPrevalByGroup-1.png" alt="Predicted Probabilities - Train and Test" width="768" />
<p class="caption">
Figure 7.7: Predicted Probabilities - Train and Test
</p>
</div>
<!--
Another look - plot train and test set logistic curves with annotation.

The following shows that predicted classes come from fitted
probabilities - not out of sample probabilities.

Also shows that threshold is at 0.5 

SKIP
-->
<!-- SKIP ALL THIS 
We have seen above that assessments of model performance based on the out-of-fold 
predicted values are close to the test set assessments, and that
assessments based on prediction extracted from glmnet object are optimistic.
Here we look at confusion matrices to see how this affects the
classification results.

Here we use a threshold of 0.5 to dichotomize the predicted
probabilities into a class prediction, as is done in the
glmnet predictions.

-->
<!-- SKIPPED
The out-of-fold error rates are larger for the relaxed lasso and blended fit models.
On the test set, errors are slightly higher for the elastic net model.
-->
</div>
</div>
<div id="compare-predictions-at-misclassified-samples-1" class="section level2" number="7.5">
<h2><span class="header-section-number">7.5</span> Compare predictions at misclassified samples</h2>
<p>It is useful to examine classification errors more carefully.
If models have different failure modes, one might get improved
performance by combining model predictions. Note that the models
considered here are not expected to compliment each other usefully
as they are too similar in nature.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="brca-rnaseseq-explore-sparsity.html#cb170-1"></a><span class="co">### CLEAR CACHE</span></span>
<span id="cb170-2"><a href="brca-rnaseseq-explore-sparsity.html#cb170-2"></a></span>
<span id="cb170-3"><a href="brca-rnaseseq-explore-sparsity.html#cb170-3"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: here we use computred oofClass rather than predClass </span></span>
<span id="cb170-4"><a href="brca-rnaseseq-explore-sparsity.html#cb170-4"></a><span class="co"># as predClass extracted from predict() are fitted values.</span></span>
<span id="cb170-5"><a href="brca-rnaseseq-explore-sparsity.html#cb170-5"></a></span>
<span id="cb170-6"><a href="brca-rnaseseq-explore-sparsity.html#cb170-6"></a><span class="co"># train - oof</span></span>
<span id="cb170-7"><a href="brca-rnaseseq-explore-sparsity.html#cb170-7"></a>ndx_1se &lt;-<span class="st"> </span><span class="kw">match</span>(brcaRna_cv_lasso<span class="op">$</span>lambda<span class="fl">.1</span>se,brcaRna_cv_lasso<span class="op">$</span>lambda)</span>
<span id="cb170-8"><a href="brca-rnaseseq-explore-sparsity.html#cb170-8"></a>train_lasso_oofProb_vec &lt;-<span class="st"> </span><span class="kw">logistic_f</span>(brcaRna_cv_lasso<span class="op">$</span>fit.preval[,ndx_1se])</span>
<span id="cb170-9"><a href="brca-rnaseseq-explore-sparsity.html#cb170-9"></a>train_lasso_oofClass_vec &lt;-<span class="st"> </span><span class="kw">ifelse</span>(</span>
<span id="cb170-10"><a href="brca-rnaseseq-explore-sparsity.html#cb170-10"></a>   train_lasso_oofProb_vec <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>, <span class="st">&#39;LumA&#39;</span>, <span class="st">&#39;_Other&#39;</span>)</span>
<span id="cb170-11"><a href="brca-rnaseseq-explore-sparsity.html#cb170-11"></a></span>
<span id="cb170-12"><a href="brca-rnaseseq-explore-sparsity.html#cb170-12"></a>ndx_1se &lt;-<span class="st"> </span><span class="kw">match</span>(brcaRna_cv_enet<span class="op">$</span>lambda<span class="fl">.1</span>se,brcaRna_cv_enet<span class="op">$</span>lambda)</span>
<span id="cb170-13"><a href="brca-rnaseseq-explore-sparsity.html#cb170-13"></a>train_enet_oofProb_vec &lt;-<span class="st"> </span><span class="kw">logistic_f</span>(brcaRna_cv_enet<span class="op">$</span>fit.preval[,ndx_1se])</span>
<span id="cb170-14"><a href="brca-rnaseseq-explore-sparsity.html#cb170-14"></a>train_enet_oofClass_vec &lt;-<span class="st"> </span><span class="kw">ifelse</span>(</span>
<span id="cb170-15"><a href="brca-rnaseseq-explore-sparsity.html#cb170-15"></a>   train_enet_oofProb_vec <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>, <span class="st">&#39;LumA&#39;</span>, <span class="st">&#39;_Other&#39;</span>)</span>
<span id="cb170-16"><a href="brca-rnaseseq-explore-sparsity.html#cb170-16"></a></span>
<span id="cb170-17"><a href="brca-rnaseseq-explore-sparsity.html#cb170-17"></a><span class="co"># RECALL: brcaRna_cv_lassoR$nzero[brcaRna_cv_lassoR$lambda==brcaRna_cv_lassoR$lambda.1se]</span></span>
<span id="cb170-18"><a href="brca-rnaseseq-explore-sparsity.html#cb170-18"></a><span class="co"># train - oof</span></span>
<span id="cb170-19"><a href="brca-rnaseseq-explore-sparsity.html#cb170-19"></a>ndx_1se &lt;-<span class="st"> </span><span class="kw">match</span>(brcaRna_cv_lassoR<span class="op">$</span>lambda<span class="fl">.1</span>se,brcaRna_cv_lassoR<span class="op">$</span>lambda)</span>
<span id="cb170-20"><a href="brca-rnaseseq-explore-sparsity.html#cb170-20"></a>train_relaxed_oofProb_vec &lt;-<span class="st"> </span><span class="kw">logistic_f</span>(brcaRna_cv_lassoR<span class="op">$</span>fit.preval[[<span class="st">&#39;g:0&#39;</span>]][,ndx_1se])</span>
<span id="cb170-21"><a href="brca-rnaseseq-explore-sparsity.html#cb170-21"></a>train_relaxed_oofClass_vec &lt;-<span class="st"> </span><span class="kw">ifelse</span>(</span>
<span id="cb170-22"><a href="brca-rnaseseq-explore-sparsity.html#cb170-22"></a>   train_relaxed_oofProb_vec <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>, <span class="st">&#39;LumA&#39;</span>, <span class="st">&#39;_Other&#39;</span>)</span>
<span id="cb170-23"><a href="brca-rnaseseq-explore-sparsity.html#cb170-23"></a></span>
<span id="cb170-24"><a href="brca-rnaseseq-explore-sparsity.html#cb170-24"></a><span class="co"># RECALL $`r brcaRna_cv_lassoR$relaxed$nzero.1se`$ features (vertical</span></span>
<span id="cb170-25"><a href="brca-rnaseseq-explore-sparsity.html#cb170-25"></a><span class="co">#  cv_blended_statlist &lt;- brcaRna_cv_lassoR$relaxed$statlist[[&#39;g:0.5&#39;]]</span></span>
<span id="cb170-26"><a href="brca-rnaseseq-explore-sparsity.html#cb170-26"></a><span class="co">#  cv_blended_1se_error &lt;- cv_blended_statlist$cvm[cv_blended_statlist$lambda==</span></span>
<span id="cb170-27"><a href="brca-rnaseseq-explore-sparsity.html#cb170-27"></a>      <span class="co">#brcaRna_cv_lassoR$relaxed$lambda.1se]</span></span>
<span id="cb170-28"><a href="brca-rnaseseq-explore-sparsity.html#cb170-28"></a></span>
<span id="cb170-29"><a href="brca-rnaseseq-explore-sparsity.html#cb170-29"></a><span class="co"># train - oof</span></span>
<span id="cb170-30"><a href="brca-rnaseseq-explore-sparsity.html#cb170-30"></a>cv_blended_statlist &lt;-<span class="st"> </span>brcaRna_cv_lassoR<span class="op">$</span>relaxed<span class="op">$</span>statlist[[<span class="st">&#39;g:0.5&#39;</span>]]</span>
<span id="cb170-31"><a href="brca-rnaseseq-explore-sparsity.html#cb170-31"></a>ndx_1se &lt;-<span class="st"> </span><span class="kw">match</span>(brcaRna_cv_lassoR<span class="op">$</span>relaxed<span class="op">$</span>lambda<span class="fl">.1</span>se, cv_blended_statlist<span class="op">$</span>lambda)</span>
<span id="cb170-32"><a href="brca-rnaseseq-explore-sparsity.html#cb170-32"></a>train_blended_oofProb_vec &lt;-<span class="st"> </span><span class="kw">logistic_f</span>(brcaRna_cv_lassoR<span class="op">$</span>fit.preval[[<span class="st">&#39;g:0.5&#39;</span>]][,ndx_1se])</span>
<span id="cb170-33"><a href="brca-rnaseseq-explore-sparsity.html#cb170-33"></a>train_blended_oofClass_vec &lt;-<span class="st"> </span><span class="kw">ifelse</span>(</span>
<span id="cb170-34"><a href="brca-rnaseseq-explore-sparsity.html#cb170-34"></a>   train_blended_oofProb_vec <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>, <span class="st">&#39;LumA&#39;</span>, <span class="st">&#39;_Other&#39;</span>)</span>
<span id="cb170-35"><a href="brca-rnaseseq-explore-sparsity.html#cb170-35"></a></span>
<span id="cb170-36"><a href="brca-rnaseseq-explore-sparsity.html#cb170-36"></a></span>
<span id="cb170-37"><a href="brca-rnaseseq-explore-sparsity.html#cb170-37"></a>misclass_id_vec &lt;-<span class="st"> </span><span class="kw">unique</span>(<span class="kw">c</span>(</span>
<span id="cb170-38"><a href="brca-rnaseseq-explore-sparsity.html#cb170-38"></a> <span class="kw">names</span>(train_lasso_oofClass_vec)[train_lasso_oofClass_vec <span class="op">!=</span><span class="st"> </span>brcaRna_train_group_vec],</span>
<span id="cb170-39"><a href="brca-rnaseseq-explore-sparsity.html#cb170-39"></a> <span class="kw">names</span>(train_enet_oofClass_vec)[train_enet_oofClass_vec <span class="op">!=</span><span class="st"> </span>brcaRna_train_group_vec],</span>
<span id="cb170-40"><a href="brca-rnaseseq-explore-sparsity.html#cb170-40"></a> <span class="kw">names</span>(train_relaxed_oofClass_vec)[train_relaxed_oofClass_vec <span class="op">!=</span><span class="st"> </span>brcaRna_train_group_vec],</span>
<span id="cb170-41"><a href="brca-rnaseseq-explore-sparsity.html#cb170-41"></a> <span class="kw">names</span>(train_blended_oofClass_vec)[train_blended_oofClass_vec <span class="op">!=</span><span class="st"> </span>brcaRna_train_group_vec]</span>
<span id="cb170-42"><a href="brca-rnaseseq-explore-sparsity.html#cb170-42"></a> )</span>
<span id="cb170-43"><a href="brca-rnaseseq-explore-sparsity.html#cb170-43"></a>)</span>
<span id="cb170-44"><a href="brca-rnaseseq-explore-sparsity.html#cb170-44"></a></span>
<span id="cb170-45"><a href="brca-rnaseseq-explore-sparsity.html#cb170-45"></a></span>
<span id="cb170-46"><a href="brca-rnaseseq-explore-sparsity.html#cb170-46"></a>missclass_oofProb_mtx &lt;-<span class="st"> </span><span class="kw">cbind</span>(</span>
<span id="cb170-47"><a href="brca-rnaseseq-explore-sparsity.html#cb170-47"></a> train_lasso_oofProb_vec[misclass_id_vec],</span>
<span id="cb170-48"><a href="brca-rnaseseq-explore-sparsity.html#cb170-48"></a> train_enet_oofProb_vec[misclass_id_vec],</span>
<span id="cb170-49"><a href="brca-rnaseseq-explore-sparsity.html#cb170-49"></a> train_relaxed_oofProb_vec[misclass_id_vec],</span>
<span id="cb170-50"><a href="brca-rnaseseq-explore-sparsity.html#cb170-50"></a> train_blended_oofProb_vec[misclass_id_vec]</span>
<span id="cb170-51"><a href="brca-rnaseseq-explore-sparsity.html#cb170-51"></a>)</span>
<span id="cb170-52"><a href="brca-rnaseseq-explore-sparsity.html#cb170-52"></a><span class="kw">colnames</span>(missclass_oofProb_mtx) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;lasso&#39;</span>,<span class="st">&#39;enet&#39;</span>, <span class="st">&#39;lassoR&#39;</span>, <span class="st">&#39;blended&#39;</span>)</span>
<span id="cb170-53"><a href="brca-rnaseseq-explore-sparsity.html#cb170-53"></a></span>
<span id="cb170-54"><a href="brca-rnaseseq-explore-sparsity.html#cb170-54"></a>row_med_vec &lt;-<span class="st"> </span><span class="kw">apply</span>(missclass_oofProb_mtx, <span class="dv">1</span>, median)</span>
<span id="cb170-55"><a href="brca-rnaseseq-explore-sparsity.html#cb170-55"></a>missclass_oofProb_mtx &lt;-<span class="st"> </span>missclass_oofProb_mtx[</span>
<span id="cb170-56"><a href="brca-rnaseseq-explore-sparsity.html#cb170-56"></a>  <span class="kw">order</span>(brcaRna_train_group_vec[<span class="kw">rownames</span>(missclass_oofProb_mtx)], row_med_vec),]</span>
<span id="cb170-57"><a href="brca-rnaseseq-explore-sparsity.html#cb170-57"></a></span>
<span id="cb170-58"><a href="brca-rnaseseq-explore-sparsity.html#cb170-58"></a><span class="kw">plot</span>(</span>
<span id="cb170-59"><a href="brca-rnaseseq-explore-sparsity.html#cb170-59"></a> <span class="dt">x=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="kw">nrow</span>(missclass_oofProb_mtx)), <span class="dt">xlab=</span><span class="st">&#39;samples&#39;</span>,</span>
<span id="cb170-60"><a href="brca-rnaseseq-explore-sparsity.html#cb170-60"></a> <span class="dt">y=</span><span class="kw">range</span>(missclass_oofProb_mtx), <span class="dt">ylab=</span><span class="st">&#39;out-of-fold predicted probability&#39;</span>,</span>
<span id="cb170-61"><a href="brca-rnaseseq-explore-sparsity.html#cb170-61"></a> <span class="dt">xaxt=</span><span class="st">&#39;n&#39;</span>, <span class="dt">type=</span><span class="st">&#39;n&#39;</span>)</span>
<span id="cb170-62"><a href="brca-rnaseseq-explore-sparsity.html#cb170-62"></a></span>
<span id="cb170-63"><a href="brca-rnaseseq-explore-sparsity.html#cb170-63"></a><span class="cf">for</span>(RR <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(missclass_oofProb_mtx))</span>
<span id="cb170-64"><a href="brca-rnaseseq-explore-sparsity.html#cb170-64"></a><span class="kw">points</span>(</span>
<span id="cb170-65"><a href="brca-rnaseseq-explore-sparsity.html#cb170-65"></a> <span class="kw">rep</span>(RR, <span class="kw">ncol</span>(missclass_oofProb_mtx)), </span>
<span id="cb170-66"><a href="brca-rnaseseq-explore-sparsity.html#cb170-66"></a> missclass_oofProb_mtx[RR,],</span>
<span id="cb170-67"><a href="brca-rnaseseq-explore-sparsity.html#cb170-67"></a> <span class="dt">col=</span><span class="kw">ifelse</span>(brcaRna_train_group_vec[<span class="kw">rownames</span>(missclass_oofProb_mtx)[RR]] <span class="op">==</span><span class="st"> &#39;Other&#39;</span>,</span>
<span id="cb170-68"><a href="brca-rnaseseq-explore-sparsity.html#cb170-68"></a>  <span class="st">&#39;green&#39;</span>, <span class="st">&#39;red&#39;</span>),</span>
<span id="cb170-69"><a href="brca-rnaseseq-explore-sparsity.html#cb170-69"></a> <span class="dt">pch=</span><span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(missclass_oofProb_mtx))</span>
<span id="cb170-70"><a href="brca-rnaseseq-explore-sparsity.html#cb170-70"></a></span>
<span id="cb170-71"><a href="brca-rnaseseq-explore-sparsity.html#cb170-71"></a><span class="kw">legend</span>(<span class="st">&#39;top&#39;</span>, <span class="dt">ncol=</span><span class="dv">2</span>, <span class="dt">legend=</span><span class="kw">colnames</span>(missclass_oofProb_mtx), </span>
<span id="cb170-72"><a href="brca-rnaseseq-explore-sparsity.html#cb170-72"></a> <span class="dt">pch=</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">bty=</span><span class="st">&#39;n&#39;</span>)</span>
<span id="cb170-73"><a href="brca-rnaseseq-explore-sparsity.html#cb170-73"></a></span>
<span id="cb170-74"><a href="brca-rnaseseq-explore-sparsity.html#cb170-74"></a><span class="kw">abline</span>(<span class="dt">h=</span><span class="fl">0.5</span>)</span></code></pre></div>
<div class="figure"><span id="fig:brcaRna-glmnetFit-misclassTrain"></span>
<img src="Static/figures/brcaRna-glmnetFit-misclassTrain-1.png" alt="out-of-fold predicted probabilities at miscassified samples" width="768" />
<p class="caption">
Figure 7.8: out-of-fold predicted probabilities at miscassified samples
</p>
</div>
<p>As we’ve seen above, predictions from lassoR and the blended mix model
are basically dichotomous; 0 or 1. Samples have been order by group, and
median P(LumA) within group. For the Other (green), predicted probabilities
less than 0.5 are considered correct here. For the LumA (red) samples,
predicted probabilities greater than 0.5 are considered correct here.</p>
<p>Now look at the same plot on the test data set.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="brca-rnaseseq-explore-sparsity.html#cb171-1"></a><span class="co">### CLEAR CACHE</span></span>
<span id="cb171-2"><a href="brca-rnaseseq-explore-sparsity.html#cb171-2"></a></span>
<span id="cb171-3"><a href="brca-rnaseseq-explore-sparsity.html#cb171-3"></a>test_lasso_predClass_vec &lt;-<span class="st"> </span><span class="kw">predict</span>(</span>
<span id="cb171-4"><a href="brca-rnaseseq-explore-sparsity.html#cb171-4"></a> brcaRna_cv_lasso,</span>
<span id="cb171-5"><a href="brca-rnaseseq-explore-sparsity.html#cb171-5"></a> <span class="dt">newx=</span>brcaRna_test_geneExpr_mtx,</span>
<span id="cb171-6"><a href="brca-rnaseseq-explore-sparsity.html#cb171-6"></a> <span class="dt">s=</span><span class="st">&#39;lambda.1se&#39;</span>,</span>
<span id="cb171-7"><a href="brca-rnaseseq-explore-sparsity.html#cb171-7"></a> <span class="dt">type=</span><span class="st">&#39;class&#39;</span></span>
<span id="cb171-8"><a href="brca-rnaseseq-explore-sparsity.html#cb171-8"></a>)</span>
<span id="cb171-9"><a href="brca-rnaseseq-explore-sparsity.html#cb171-9"></a></span>
<span id="cb171-10"><a href="brca-rnaseseq-explore-sparsity.html#cb171-10"></a>test_enet_predClass_vec &lt;-<span class="st"> </span><span class="kw">predict</span>(</span>
<span id="cb171-11"><a href="brca-rnaseseq-explore-sparsity.html#cb171-11"></a> brcaRna_cv_enet,</span>
<span id="cb171-12"><a href="brca-rnaseseq-explore-sparsity.html#cb171-12"></a> <span class="dt">newx=</span>brcaRna_test_geneExpr_mtx,</span>
<span id="cb171-13"><a href="brca-rnaseseq-explore-sparsity.html#cb171-13"></a> <span class="dt">s=</span><span class="st">&#39;lambda.1se&#39;</span>,</span>
<span id="cb171-14"><a href="brca-rnaseseq-explore-sparsity.html#cb171-14"></a> <span class="dt">type=</span><span class="st">&#39;class&#39;</span></span>
<span id="cb171-15"><a href="brca-rnaseseq-explore-sparsity.html#cb171-15"></a>)</span>
<span id="cb171-16"><a href="brca-rnaseseq-explore-sparsity.html#cb171-16"></a></span>
<span id="cb171-17"><a href="brca-rnaseseq-explore-sparsity.html#cb171-17"></a>test_relaxed_predClass_vec &lt;-<span class="st"> </span><span class="kw">predict</span>(</span>
<span id="cb171-18"><a href="brca-rnaseseq-explore-sparsity.html#cb171-18"></a> brcaRna_cv_lassoR,</span>
<span id="cb171-19"><a href="brca-rnaseseq-explore-sparsity.html#cb171-19"></a> <span class="dt">g=</span><span class="dv">0</span>,</span>
<span id="cb171-20"><a href="brca-rnaseseq-explore-sparsity.html#cb171-20"></a> <span class="dt">newx=</span>brcaRna_test_geneExpr_mtx,</span>
<span id="cb171-21"><a href="brca-rnaseseq-explore-sparsity.html#cb171-21"></a> <span class="dt">s=</span><span class="st">&#39;lambda.1se&#39;</span>,</span>
<span id="cb171-22"><a href="brca-rnaseseq-explore-sparsity.html#cb171-22"></a> <span class="dt">type=</span><span class="st">&#39;class&#39;</span></span>
<span id="cb171-23"><a href="brca-rnaseseq-explore-sparsity.html#cb171-23"></a>)</span>
<span id="cb171-24"><a href="brca-rnaseseq-explore-sparsity.html#cb171-24"></a></span>
<span id="cb171-25"><a href="brca-rnaseseq-explore-sparsity.html#cb171-25"></a>test_blended_predClass_vec &lt;-<span class="st"> </span><span class="kw">predict</span>(</span>
<span id="cb171-26"><a href="brca-rnaseseq-explore-sparsity.html#cb171-26"></a> brcaRna_cv_lassoR,</span>
<span id="cb171-27"><a href="brca-rnaseseq-explore-sparsity.html#cb171-27"></a> <span class="dt">g=</span><span class="fl">0.5</span>,</span>
<span id="cb171-28"><a href="brca-rnaseseq-explore-sparsity.html#cb171-28"></a> <span class="dt">newx=</span>brcaRna_test_geneExpr_mtx,</span>
<span id="cb171-29"><a href="brca-rnaseseq-explore-sparsity.html#cb171-29"></a> <span class="dt">s=</span><span class="st">&#39;lambda.1se&#39;</span>,</span>
<span id="cb171-30"><a href="brca-rnaseseq-explore-sparsity.html#cb171-30"></a> <span class="dt">type=</span><span class="st">&#39;class&#39;</span></span>
<span id="cb171-31"><a href="brca-rnaseseq-explore-sparsity.html#cb171-31"></a>)</span>
<span id="cb171-32"><a href="brca-rnaseseq-explore-sparsity.html#cb171-32"></a></span>
<span id="cb171-33"><a href="brca-rnaseseq-explore-sparsity.html#cb171-33"></a>misclass_id_vec &lt;-<span class="st"> </span><span class="kw">unique</span>(<span class="kw">c</span>(</span>
<span id="cb171-34"><a href="brca-rnaseseq-explore-sparsity.html#cb171-34"></a> <span class="kw">names</span>(test_lasso_predClass_vec[,<span class="dv">1</span>])[test_lasso_predClass_vec <span class="op">!=</span><span class="st"> </span>brcaRna_test_group_vec],</span>
<span id="cb171-35"><a href="brca-rnaseseq-explore-sparsity.html#cb171-35"></a> <span class="kw">names</span>(test_enet_predClass_vec[,<span class="dv">1</span>])[test_enet_predClass_vec <span class="op">!=</span><span class="st"> </span>brcaRna_test_group_vec],</span>
<span id="cb171-36"><a href="brca-rnaseseq-explore-sparsity.html#cb171-36"></a> <span class="kw">names</span>(test_relaxed_predClass_vec[,<span class="dv">1</span>])[test_relaxed_predClass_vec <span class="op">!=</span><span class="st"> </span>brcaRna_test_group_vec],</span>
<span id="cb171-37"><a href="brca-rnaseseq-explore-sparsity.html#cb171-37"></a> <span class="kw">names</span>(test_blended_predClass_vec[,<span class="dv">1</span>])[test_blended_predClass_vec <span class="op">!=</span><span class="st"> </span>brcaRna_test_group_vec]</span>
<span id="cb171-38"><a href="brca-rnaseseq-explore-sparsity.html#cb171-38"></a> )</span>
<span id="cb171-39"><a href="brca-rnaseseq-explore-sparsity.html#cb171-39"></a>)</span>
<span id="cb171-40"><a href="brca-rnaseseq-explore-sparsity.html#cb171-40"></a></span>
<span id="cb171-41"><a href="brca-rnaseseq-explore-sparsity.html#cb171-41"></a></span>
<span id="cb171-42"><a href="brca-rnaseseq-explore-sparsity.html#cb171-42"></a>missclass_oofProb_mtx &lt;-<span class="st"> </span><span class="kw">cbind</span>(</span>
<span id="cb171-43"><a href="brca-rnaseseq-explore-sparsity.html#cb171-43"></a> test_lasso_predProb_vec[misclass_id_vec,],</span>
<span id="cb171-44"><a href="brca-rnaseseq-explore-sparsity.html#cb171-44"></a> test_enet_predProb_vec[misclass_id_vec,],</span>
<span id="cb171-45"><a href="brca-rnaseseq-explore-sparsity.html#cb171-45"></a> test_relaxed_predProb_vec[misclass_id_vec,],</span>
<span id="cb171-46"><a href="brca-rnaseseq-explore-sparsity.html#cb171-46"></a> test_blended_predProb_vec[misclass_id_vec,]</span>
<span id="cb171-47"><a href="brca-rnaseseq-explore-sparsity.html#cb171-47"></a>)</span>
<span id="cb171-48"><a href="brca-rnaseseq-explore-sparsity.html#cb171-48"></a><span class="kw">colnames</span>(missclass_oofProb_mtx) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;lasso&#39;</span>,<span class="st">&#39;enet&#39;</span>, <span class="st">&#39;lassoR&#39;</span>, <span class="st">&#39;blended&#39;</span>)</span>
<span id="cb171-49"><a href="brca-rnaseseq-explore-sparsity.html#cb171-49"></a></span>
<span id="cb171-50"><a href="brca-rnaseseq-explore-sparsity.html#cb171-50"></a>row_med_vec &lt;-<span class="st"> </span><span class="kw">apply</span>(missclass_oofProb_mtx, <span class="dv">1</span>, median)</span>
<span id="cb171-51"><a href="brca-rnaseseq-explore-sparsity.html#cb171-51"></a>missclass_oofProb_mtx &lt;-<span class="st"> </span>missclass_oofProb_mtx[</span>
<span id="cb171-52"><a href="brca-rnaseseq-explore-sparsity.html#cb171-52"></a>  <span class="kw">order</span>(brcaRna_test_group_vec[<span class="kw">rownames</span>(missclass_oofProb_mtx)], row_med_vec),]</span>
<span id="cb171-53"><a href="brca-rnaseseq-explore-sparsity.html#cb171-53"></a></span>
<span id="cb171-54"><a href="brca-rnaseseq-explore-sparsity.html#cb171-54"></a><span class="kw">plot</span>(</span>
<span id="cb171-55"><a href="brca-rnaseseq-explore-sparsity.html#cb171-55"></a> <span class="dt">x=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="kw">nrow</span>(missclass_oofProb_mtx)), <span class="dt">xlab=</span><span class="st">&#39;samples&#39;</span>,</span>
<span id="cb171-56"><a href="brca-rnaseseq-explore-sparsity.html#cb171-56"></a> <span class="dt">y=</span><span class="kw">range</span>(missclass_oofProb_mtx), <span class="dt">ylab=</span><span class="st">&#39;out-of-fold predicted probability&#39;</span>,</span>
<span id="cb171-57"><a href="brca-rnaseseq-explore-sparsity.html#cb171-57"></a> <span class="dt">xaxt=</span><span class="st">&#39;n&#39;</span>, <span class="dt">type=</span><span class="st">&#39;n&#39;</span>)</span>
<span id="cb171-58"><a href="brca-rnaseseq-explore-sparsity.html#cb171-58"></a></span>
<span id="cb171-59"><a href="brca-rnaseseq-explore-sparsity.html#cb171-59"></a><span class="cf">for</span>(RR <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(missclass_oofProb_mtx))</span>
<span id="cb171-60"><a href="brca-rnaseseq-explore-sparsity.html#cb171-60"></a><span class="kw">points</span>(</span>
<span id="cb171-61"><a href="brca-rnaseseq-explore-sparsity.html#cb171-61"></a> <span class="kw">rep</span>(RR, <span class="kw">ncol</span>(missclass_oofProb_mtx)), </span>
<span id="cb171-62"><a href="brca-rnaseseq-explore-sparsity.html#cb171-62"></a> missclass_oofProb_mtx[RR,],</span>
<span id="cb171-63"><a href="brca-rnaseseq-explore-sparsity.html#cb171-63"></a> <span class="dt">col=</span><span class="kw">ifelse</span>(brcaRna_test_group_vec[<span class="kw">rownames</span>(missclass_oofProb_mtx)[RR]] <span class="op">==</span><span class="st"> &#39;Other&#39;</span>,</span>
<span id="cb171-64"><a href="brca-rnaseseq-explore-sparsity.html#cb171-64"></a>  <span class="st">&#39;green&#39;</span>, <span class="st">&#39;red&#39;</span>),</span>
<span id="cb171-65"><a href="brca-rnaseseq-explore-sparsity.html#cb171-65"></a> <span class="dt">pch=</span><span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(missclass_oofProb_mtx))</span>
<span id="cb171-66"><a href="brca-rnaseseq-explore-sparsity.html#cb171-66"></a></span>
<span id="cb171-67"><a href="brca-rnaseseq-explore-sparsity.html#cb171-67"></a><span class="kw">legend</span>(<span class="st">&#39;top&#39;</span>, <span class="dt">ncol=</span><span class="dv">2</span>, <span class="dt">legend=</span><span class="kw">colnames</span>(missclass_oofProb_mtx), </span>
<span id="cb171-68"><a href="brca-rnaseseq-explore-sparsity.html#cb171-68"></a> <span class="dt">pch=</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">bty=</span><span class="st">&#39;n&#39;</span>)</span>
<span id="cb171-69"><a href="brca-rnaseseq-explore-sparsity.html#cb171-69"></a></span>
<span id="cb171-70"><a href="brca-rnaseseq-explore-sparsity.html#cb171-70"></a><span class="kw">abline</span>(<span class="dt">h=</span><span class="fl">0.5</span>)</span></code></pre></div>
<div class="figure"><span id="fig:brcaRna-glmnetFit-misclassTest"></span>
<img src="Static/figures/brcaRna-glmnetFit-misclassTest-1.png" alt="Test data predicted probabilities at miscassified samples" width="768" />
<p class="caption">
Figure 7.9: Test data predicted probabilities at miscassified samples
</p>
</div>
<p>The relaxed lasso fit results in essentially dichotomized predicted probability
distribution - predicted probabilities are very close to 0 or 1.</p>
<p>We see that for design points in the training set, the predicted probabilies from the relaxed lasso
are essentially dichotomized to be tightly distributed at the extremes of the
response range. For design points in the test set, the predicted probabilies from the relaxed lasso
are comparable to the lasso model predicted porbabilities. This seems to indicate over-fitting
in the relaxed lasso fit.</p>
</div>
<div id="compare-coefficient-profiles-1" class="section level2" number="7.6">
<h2><span class="header-section-number">7.6</span> Compare coefficient profiles</h2>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="brca-rnaseseq-explore-sparsity.html#cb172-1"></a><span class="co">### CLEAR CACHE</span></span>
<span id="cb172-2"><a href="brca-rnaseseq-explore-sparsity.html#cb172-2"></a></span>
<span id="cb172-3"><a href="brca-rnaseseq-explore-sparsity.html#cb172-3"></a><span class="co"># lasso </span></span>
<span id="cb172-4"><a href="brca-rnaseseq-explore-sparsity.html#cb172-4"></a><span class="co">##########################</span></span>
<span id="cb172-5"><a href="brca-rnaseseq-explore-sparsity.html#cb172-5"></a><span class="co"># train - cv predicted</span></span>
<span id="cb172-6"><a href="brca-rnaseseq-explore-sparsity.html#cb172-6"></a>lasso_coef &lt;-<span class="st"> </span><span class="kw">coef</span>(</span>
<span id="cb172-7"><a href="brca-rnaseseq-explore-sparsity.html#cb172-7"></a> brcaRna_cv_lasso,</span>
<span id="cb172-8"><a href="brca-rnaseseq-explore-sparsity.html#cb172-8"></a> <span class="dt">s=</span><span class="st">&#39;lambda.1se&#39;</span></span>
<span id="cb172-9"><a href="brca-rnaseseq-explore-sparsity.html#cb172-9"></a>)</span>
<span id="cb172-10"><a href="brca-rnaseseq-explore-sparsity.html#cb172-10"></a>lasso_coef_frm &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb172-11"><a href="brca-rnaseseq-explore-sparsity.html#cb172-11"></a> <span class="dt">gene=</span>lasso_coef<span class="op">@</span>Dimnames[[<span class="dv">1</span>]][<span class="kw">c</span>(<span class="dv">1</span>, lasso_coef<span class="op">@</span>i[<span class="op">-</span><span class="dv">1</span>])],</span>
<span id="cb172-12"><a href="brca-rnaseseq-explore-sparsity.html#cb172-12"></a> <span class="dt">lasso=</span>lasso_coef<span class="op">@</span>x)</span>
<span id="cb172-13"><a href="brca-rnaseseq-explore-sparsity.html#cb172-13"></a></span>
<span id="cb172-14"><a href="brca-rnaseseq-explore-sparsity.html#cb172-14"></a></span>
<span id="cb172-15"><a href="brca-rnaseseq-explore-sparsity.html#cb172-15"></a><span class="co"># enet</span></span>
<span id="cb172-16"><a href="brca-rnaseseq-explore-sparsity.html#cb172-16"></a><span class="co">##########################</span></span>
<span id="cb172-17"><a href="brca-rnaseseq-explore-sparsity.html#cb172-17"></a>enet_coef &lt;-<span class="st"> </span><span class="kw">coef</span>(</span>
<span id="cb172-18"><a href="brca-rnaseseq-explore-sparsity.html#cb172-18"></a> brcaRna_cv_enet,</span>
<span id="cb172-19"><a href="brca-rnaseseq-explore-sparsity.html#cb172-19"></a> <span class="dt">s=</span><span class="st">&#39;lambda.1se&#39;</span></span>
<span id="cb172-20"><a href="brca-rnaseseq-explore-sparsity.html#cb172-20"></a>)</span>
<span id="cb172-21"><a href="brca-rnaseseq-explore-sparsity.html#cb172-21"></a>enet_coef_frm &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb172-22"><a href="brca-rnaseseq-explore-sparsity.html#cb172-22"></a> <span class="dt">gene=</span>enet_coef<span class="op">@</span>Dimnames[[<span class="dv">1</span>]][<span class="kw">c</span>(<span class="dv">1</span>, enet_coef<span class="op">@</span>i[<span class="op">-</span><span class="dv">1</span>])],</span>
<span id="cb172-23"><a href="brca-rnaseseq-explore-sparsity.html#cb172-23"></a> <span class="dt">enet=</span>enet_coef<span class="op">@</span>x)</span>
<span id="cb172-24"><a href="brca-rnaseseq-explore-sparsity.html#cb172-24"></a></span>
<span id="cb172-25"><a href="brca-rnaseseq-explore-sparsity.html#cb172-25"></a><span class="co"># THESE ARE NOT CORRECT - SKIP</span></span>
<span id="cb172-26"><a href="brca-rnaseseq-explore-sparsity.html#cb172-26"></a><span class="co"># relaxed lasso (gamma=0)</span></span>
<span id="cb172-27"><a href="brca-rnaseseq-explore-sparsity.html#cb172-27"></a><span class="co">##########################</span></span>
<span id="cb172-28"><a href="brca-rnaseseq-explore-sparsity.html#cb172-28"></a>SKIP &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb172-29"><a href="brca-rnaseseq-explore-sparsity.html#cb172-29"></a>lassoR_coef &lt;-<span class="st"> </span><span class="kw">coef</span>(</span>
<span id="cb172-30"><a href="brca-rnaseseq-explore-sparsity.html#cb172-30"></a> brcaRna_cv_lassoR,</span>
<span id="cb172-31"><a href="brca-rnaseseq-explore-sparsity.html#cb172-31"></a> <span class="dt">s=</span><span class="st">&#39;lambda.1se&#39;</span>,</span>
<span id="cb172-32"><a href="brca-rnaseseq-explore-sparsity.html#cb172-32"></a> <span class="dt">g=</span><span class="dv">0</span></span>
<span id="cb172-33"><a href="brca-rnaseseq-explore-sparsity.html#cb172-33"></a>)</span>
<span id="cb172-34"><a href="brca-rnaseseq-explore-sparsity.html#cb172-34"></a>lassoR_coef_frm &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb172-35"><a href="brca-rnaseseq-explore-sparsity.html#cb172-35"></a> <span class="dt">gene=</span>lassoR_coef<span class="op">@</span>Dimnames[[<span class="dv">1</span>]][<span class="kw">c</span>(<span class="dv">1</span>, lassoR_coef<span class="op">@</span>i[<span class="op">-</span><span class="dv">1</span>])],</span>
<span id="cb172-36"><a href="brca-rnaseseq-explore-sparsity.html#cb172-36"></a> <span class="dt">lassoR=</span>lassoR_coef<span class="op">@</span>x)</span>
<span id="cb172-37"><a href="brca-rnaseseq-explore-sparsity.html#cb172-37"></a>}</span>
<span id="cb172-38"><a href="brca-rnaseseq-explore-sparsity.html#cb172-38"></a></span>
<span id="cb172-39"><a href="brca-rnaseseq-explore-sparsity.html#cb172-39"></a><span class="co"># blended mix (gamma=0.5)</span></span>
<span id="cb172-40"><a href="brca-rnaseseq-explore-sparsity.html#cb172-40"></a><span class="co">###############################</span></span>
<span id="cb172-41"><a href="brca-rnaseseq-explore-sparsity.html#cb172-41"></a>blended_coef &lt;-<span class="st"> </span><span class="kw">coef</span>(</span>
<span id="cb172-42"><a href="brca-rnaseseq-explore-sparsity.html#cb172-42"></a> brcaRna_cv_lassoR,</span>
<span id="cb172-43"><a href="brca-rnaseseq-explore-sparsity.html#cb172-43"></a> <span class="dt">s=</span><span class="st">&#39;lambda.1se&#39;</span>,</span>
<span id="cb172-44"><a href="brca-rnaseseq-explore-sparsity.html#cb172-44"></a> <span class="dt">g=</span><span class="fl">0.5</span></span>
<span id="cb172-45"><a href="brca-rnaseseq-explore-sparsity.html#cb172-45"></a>)</span>
<span id="cb172-46"><a href="brca-rnaseseq-explore-sparsity.html#cb172-46"></a>blended_coef_frm &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb172-47"><a href="brca-rnaseseq-explore-sparsity.html#cb172-47"></a> <span class="dt">gene=</span>blended_coef<span class="op">@</span>Dimnames[[<span class="dv">1</span>]][<span class="kw">c</span>(<span class="dv">1</span>, blended_coef<span class="op">@</span>i[<span class="op">-</span><span class="dv">1</span>])],</span>
<span id="cb172-48"><a href="brca-rnaseseq-explore-sparsity.html#cb172-48"></a> <span class="dt">blended=</span>blended_coef<span class="op">@</span>x)</span>
<span id="cb172-49"><a href="brca-rnaseseq-explore-sparsity.html#cb172-49"></a></span>
<span id="cb172-50"><a href="brca-rnaseseq-explore-sparsity.html#cb172-50"></a></span>
<span id="cb172-51"><a href="brca-rnaseseq-explore-sparsity.html#cb172-51"></a><span class="co"># put it all together</span></span>
<span id="cb172-52"><a href="brca-rnaseseq-explore-sparsity.html#cb172-52"></a>all_coef_frm &lt;-<span class="st"> </span></span>
<span id="cb172-53"><a href="brca-rnaseseq-explore-sparsity.html#cb172-53"></a><span class="st"> </span>base<span class="op">::</span><span class="kw">merge</span>(</span>
<span id="cb172-54"><a href="brca-rnaseseq-explore-sparsity.html#cb172-54"></a> <span class="dt">x =</span> lasso_coef_frm, </span>
<span id="cb172-55"><a href="brca-rnaseseq-explore-sparsity.html#cb172-55"></a> <span class="dt">y =</span> base<span class="op">::</span><span class="kw">merge</span>(</span>
<span id="cb172-56"><a href="brca-rnaseseq-explore-sparsity.html#cb172-56"></a>     <span class="dt">x =</span> enet_coef_frm,</span>
<span id="cb172-57"><a href="brca-rnaseseq-explore-sparsity.html#cb172-57"></a>     <span class="dt">y =</span> blended_coef_frm,</span>
<span id="cb172-58"><a href="brca-rnaseseq-explore-sparsity.html#cb172-58"></a>         <span class="dt">by=</span><span class="st">&#39;gene&#39;</span>, <span class="dt">all=</span>T),</span>
<span id="cb172-59"><a href="brca-rnaseseq-explore-sparsity.html#cb172-59"></a> <span class="dt">by=</span><span class="st">&#39;gene&#39;</span>, <span class="dt">all=</span>T)</span>
<span id="cb172-60"><a href="brca-rnaseseq-explore-sparsity.html#cb172-60"></a></span>
<span id="cb172-61"><a href="brca-rnaseseq-explore-sparsity.html#cb172-61"></a><span class="co"># SKIPPED</span></span>
<span id="cb172-62"><a href="brca-rnaseseq-explore-sparsity.html#cb172-62"></a><span class="co">#base::merge(</span></span>
<span id="cb172-63"><a href="brca-rnaseseq-explore-sparsity.html#cb172-63"></a>         <span class="co">#x = lassoR_coef_frm,</span></span>
<span id="cb172-64"><a href="brca-rnaseseq-explore-sparsity.html#cb172-64"></a>         <span class="co">#y = blended_coef_frm,</span></span>
<span id="cb172-65"><a href="brca-rnaseseq-explore-sparsity.html#cb172-65"></a>         <span class="co">#by=&#39;gene&#39;, all=T),</span></span>
<span id="cb172-66"><a href="brca-rnaseseq-explore-sparsity.html#cb172-66"></a></span>
<span id="cb172-67"><a href="brca-rnaseseq-explore-sparsity.html#cb172-67"></a>all_coef_frm[,<span class="op">-</span><span class="dv">1</span>][<span class="kw">is.na</span>(all_coef_frm[,<span class="op">-</span><span class="dv">1</span>])] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb172-68"><a href="brca-rnaseseq-explore-sparsity.html#cb172-68"></a></span>
<span id="cb172-69"><a href="brca-rnaseseq-explore-sparsity.html#cb172-69"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="kw">ncol</span>(all_coef_frm)<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>), <span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">oma=</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">0</span>))</span>
<span id="cb172-70"><a href="brca-rnaseseq-explore-sparsity.html#cb172-70"></a></span>
<span id="cb172-71"><a href="brca-rnaseseq-explore-sparsity.html#cb172-71"></a><span class="cf">for</span>(CC <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span><span class="kw">ncol</span>(all_coef_frm)) {</span>
<span id="cb172-72"><a href="brca-rnaseseq-explore-sparsity.html#cb172-72"></a> <span class="kw">plot</span>(</span>
<span id="cb172-73"><a href="brca-rnaseseq-explore-sparsity.html#cb172-73"></a>  <span class="dt">x=</span><span class="dv">1</span><span class="op">:</span>(<span class="kw">nrow</span>(all_coef_frm)<span class="op">-</span><span class="dv">1</span>), <span class="dt">xlab=</span><span class="st">&#39;&#39;</span>, </span>
<span id="cb172-74"><a href="brca-rnaseseq-explore-sparsity.html#cb172-74"></a>  <span class="dt">y=</span>all_coef_frm[<span class="op">-</span><span class="dv">1</span>, CC], <span class="dt">ylab=</span><span class="kw">colnames</span>(all_coef_frm)[CC],</span>
<span id="cb172-75"><a href="brca-rnaseseq-explore-sparsity.html#cb172-75"></a>  <span class="dt">type=</span><span class="st">&#39;h&#39;</span>, <span class="dt">xaxt=</span><span class="st">&#39;n&#39;</span>)</span>
<span id="cb172-76"><a href="brca-rnaseseq-explore-sparsity.html#cb172-76"></a>}</span></code></pre></div>
<div class="figure"><span id="fig:brcaRna-glmnetFit-compCoeffProf"></span>
<img src="Static/figures/brcaRna-glmnetFit-compCoeffProf-1.png" alt="Coefficient Profiles" width="768" />
<p class="caption">
Figure 7.10: Coefficient Profiles
</p>
</div>
<p>Note that there is little difference between the elastic net and the lasso
in the selected features, and when the coefficient is zero in one set, it
is smaell in the other. By contrast, the blended fit produces more shrinkage.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="brca-rnaseseq-explore-sparsity.html#cb173-1"></a><span class="co">### CLEAR CACHE</span></span>
<span id="cb173-2"><a href="brca-rnaseseq-explore-sparsity.html#cb173-2"></a></span>
<span id="cb173-3"><a href="brca-rnaseseq-explore-sparsity.html#cb173-3"></a>knitr<span class="op">::</span><span class="kw">kable</span>(</span>
<span id="cb173-4"><a href="brca-rnaseseq-explore-sparsity.html#cb173-4"></a><span class="kw">with</span>(all_coef_frm[,<span class="op">-</span><span class="dv">1</span>], <span class="kw">table</span>(<span class="dt">lassoZero=</span>lasso<span class="op">==</span><span class="dv">0</span>, <span class="dt">enetZero=</span>enet<span class="op">==</span><span class="dv">0</span>)),</span>
<span id="cb173-5"><a href="brca-rnaseseq-explore-sparsity.html#cb173-5"></a> <span class="dt">caption=</span><span class="st">&#39;Zero Ceofficient: rows are lasso, columns enet&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb173-6"><a href="brca-rnaseseq-explore-sparsity.html#cb173-6"></a><span class="st">  </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F)</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:brcaRna-glmnetFit-zreros">Table 7.6: </span>Zero Ceofficient: rows are lasso, columns enet
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
FALSE
</th>
<th style="text-align:right;">
TRUE
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
169
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:right;">
147
</td>
<td style="text-align:right;">
6
</td>
</tr>
</tbody>
</table>
<!--
Coefficients in the relaxed lasso fit are much larger than those in the
lasso fit, or zero.  As a consequence, the blended fit coefficients look 
like a shrunken version of the relaxed lasso fit coefficients.  
-->
<p>Coefficients in the blended fit are larger than those in the
lasso fit, or zero.</p>
<p>We can also examine these with a scatter plot matrix.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="brca-rnaseseq-explore-sparsity.html#cb174-1"></a><span class="co">### CLEAR CACHE</span></span>
<span id="cb174-2"><a href="brca-rnaseseq-explore-sparsity.html#cb174-2"></a></span>
<span id="cb174-3"><a href="brca-rnaseseq-explore-sparsity.html#cb174-3"></a></span>
<span id="cb174-4"><a href="brca-rnaseseq-explore-sparsity.html#cb174-4"></a><span class="kw">pairs</span>(all_coef_frm[<span class="op">-</span><span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>],</span>
<span id="cb174-5"><a href="brca-rnaseseq-explore-sparsity.html#cb174-5"></a>  <span class="dt">lower.panel =</span> <span class="ot">NULL</span>,</span>
<span id="cb174-6"><a href="brca-rnaseseq-explore-sparsity.html#cb174-6"></a>  <span class="dt">panel =</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb174-7"><a href="brca-rnaseseq-explore-sparsity.html#cb174-7"></a>    <span class="kw">points</span>(x, y, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb174-8"><a href="brca-rnaseseq-explore-sparsity.html#cb174-8"></a>  }</span>
<span id="cb174-9"><a href="brca-rnaseseq-explore-sparsity.html#cb174-9"></a>)</span></code></pre></div>
<div class="figure"><span id="fig:brcaRna-glmnetFit-pairsCoeffProf"></span>
<img src="Static/figures/brcaRna-glmnetFit-pairsCoeffProf-1.png" alt="Coefficients from fits" width="768" />
<p class="caption">
Figure 7.11: Coefficients from fits
</p>
</div>
</div>
<div id="examine-feature-selection-1" class="section level2" number="7.7">
<h2><span class="header-section-number">7.7</span> Examine feature selection</h2>
<p>Recall from <code>glmnet</code> vignette:</p>
<pre><code>It is known that the ridge penalty shrinks the coefficients of correlated predictors
towards each other while the lasso tends to pick one of them and discard the others.
The elastic-net penalty mixes these two; if predictors are correlated in groups,
an $\alpha$=0.5 tends to select the groups in or out together.
This is a higher level parameter, and users might pick a value upfront,
else experiment with a few different values. One use of $\alpha$ is for numerical stability;
for example, the *elastic net with $\alpha = 1 - \epsilon$ for some small $\epsilon$&gt;0
performs much like the lasso, but removes any degeneracies and wild behavior caused
by extreme correlations*.</code></pre>
<p>To see how this plays out in this dataset, we can look at feature expression
heat maps.</p>
<p>Reader notes:</p>
<pre><code>Heat maps are rarely useful other than to display the obvious.
Here too heat maps fail to yield any insights, or confirmation
of the relationship between feature correlation and lasso vs enet
feature selection.</code></pre>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="brca-rnaseseq-explore-sparsity.html#cb177-1"></a><span class="co">### CLEAR CACHE</span></span>
<span id="cb177-2"><a href="brca-rnaseseq-explore-sparsity.html#cb177-2"></a> <span class="kw">suppressPackageStartupMessages</span>(<span class="kw">require</span>(gplots))</span>
<span id="cb177-3"><a href="brca-rnaseseq-explore-sparsity.html#cb177-3"></a></span>
<span id="cb177-4"><a href="brca-rnaseseq-explore-sparsity.html#cb177-4"></a><span class="co"># train - cv predicted</span></span>
<span id="cb177-5"><a href="brca-rnaseseq-explore-sparsity.html#cb177-5"></a>lasso_coef &lt;-<span class="st"> </span><span class="kw">coef</span>(</span>
<span id="cb177-6"><a href="brca-rnaseseq-explore-sparsity.html#cb177-6"></a> brcaRna_cv_lasso,</span>
<span id="cb177-7"><a href="brca-rnaseseq-explore-sparsity.html#cb177-7"></a> <span class="dt">s=</span><span class="st">&#39;lambda.1se&#39;</span></span>
<span id="cb177-8"><a href="brca-rnaseseq-explore-sparsity.html#cb177-8"></a>)</span>
<span id="cb177-9"><a href="brca-rnaseseq-explore-sparsity.html#cb177-9"></a>lasso_coef_frm &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb177-10"><a href="brca-rnaseseq-explore-sparsity.html#cb177-10"></a> <span class="dt">gene=</span>lasso_coef<span class="op">@</span>Dimnames[[<span class="dv">1</span>]][<span class="kw">c</span>(<span class="dv">1</span>, lasso_coef<span class="op">@</span>i[<span class="op">-</span><span class="dv">1</span>])],</span>
<span id="cb177-11"><a href="brca-rnaseseq-explore-sparsity.html#cb177-11"></a> <span class="dt">lasso=</span>lasso_coef<span class="op">@</span>x)</span>
<span id="cb177-12"><a href="brca-rnaseseq-explore-sparsity.html#cb177-12"></a></span>
<span id="cb177-13"><a href="brca-rnaseseq-explore-sparsity.html#cb177-13"></a> </span>
<span id="cb177-14"><a href="brca-rnaseseq-explore-sparsity.html#cb177-14"></a>  Mycol &lt;-<span class="st"> </span><span class="kw">colorpanel</span>(<span class="dv">1000</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>)</span>
<span id="cb177-15"><a href="brca-rnaseseq-explore-sparsity.html#cb177-15"></a>  <span class="kw">heatmap.2</span>(</span>
<span id="cb177-16"><a href="brca-rnaseseq-explore-sparsity.html#cb177-16"></a>    <span class="dt">x=</span><span class="kw">t</span>(brcaRna_train_geneExpr_mtx[,lasso_coef_frm<span class="op">$</span>gene[<span class="op">-</span><span class="dv">1</span>]]),</span>
<span id="cb177-17"><a href="brca-rnaseseq-explore-sparsity.html#cb177-17"></a>    <span class="dt">scale=</span><span class="st">&quot;row&quot;</span>,</span>
<span id="cb177-18"><a href="brca-rnaseseq-explore-sparsity.html#cb177-18"></a>    <span class="dt">labRow=</span>lasso_coef_frm<span class="op">$</span>gene,</span>
<span id="cb177-19"><a href="brca-rnaseseq-explore-sparsity.html#cb177-19"></a>    <span class="dt">labCol=</span>brcaRna_train_group_vec,</span>
<span id="cb177-20"><a href="brca-rnaseseq-explore-sparsity.html#cb177-20"></a>    <span class="dt">col=</span>Mycol, </span>
<span id="cb177-21"><a href="brca-rnaseseq-explore-sparsity.html#cb177-21"></a>    <span class="dt">trace=</span><span class="st">&quot;none&quot;</span>, <span class="dt">density.info=</span><span class="st">&quot;none&quot;</span>, </span>
<span id="cb177-22"><a href="brca-rnaseseq-explore-sparsity.html#cb177-22"></a>    <span class="co">#margin=c(8,6), lhei=c(2,10), </span></span>
<span id="cb177-23"><a href="brca-rnaseseq-explore-sparsity.html#cb177-23"></a>    <span class="co">#lwid=c(0.1,4), #lhei=c(0.1,4)</span></span>
<span id="cb177-24"><a href="brca-rnaseseq-explore-sparsity.html#cb177-24"></a>    <span class="dt">key=</span>F,</span>
<span id="cb177-25"><a href="brca-rnaseseq-explore-sparsity.html#cb177-25"></a>    <span class="dt">ColSideColors=</span><span class="kw">ifelse</span>(brcaRna_train_group_vec<span class="op">==</span><span class="st">&#39;_Other&#39;</span>, <span class="st">&#39;green&#39;</span>,<span class="st">&#39;red&#39;</span>),</span>
<span id="cb177-26"><a href="brca-rnaseseq-explore-sparsity.html#cb177-26"></a>    <span class="dt">dendrogram=</span><span class="st">&quot;both&quot;</span>,</span>
<span id="cb177-27"><a href="brca-rnaseseq-explore-sparsity.html#cb177-27"></a>    <span class="dt">main=</span><span class="kw">paste</span>(<span class="st">&#39;lasso genes - N =&#39;</span>, <span class="kw">nrow</span>(lasso_coef_frm)<span class="op">-</span><span class="dv">1</span>))</span></code></pre></div>
<div class="figure"><span id="fig:brcaRna-glmnetFit-heatmapLasso"></span>
<img src="Static/figures/brcaRna-glmnetFit-heatmapLasso-1.png" alt="Lasso Model Genes" width="768" />
<p class="caption">
Figure 7.12: Lasso Model Genes
</p>
</div>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="brca-rnaseseq-explore-sparsity.html#cb178-1"></a><span class="co">### CLEAR CACHE</span></span>
<span id="cb178-2"><a href="brca-rnaseseq-explore-sparsity.html#cb178-2"></a> <span class="kw">suppressPackageStartupMessages</span>(<span class="kw">require</span>(gplots))</span>
<span id="cb178-3"><a href="brca-rnaseseq-explore-sparsity.html#cb178-3"></a></span>
<span id="cb178-4"><a href="brca-rnaseseq-explore-sparsity.html#cb178-4"></a><span class="co"># train - cv predicted</span></span>
<span id="cb178-5"><a href="brca-rnaseseq-explore-sparsity.html#cb178-5"></a>enet_coef &lt;-<span class="st"> </span><span class="kw">coef</span>(</span>
<span id="cb178-6"><a href="brca-rnaseseq-explore-sparsity.html#cb178-6"></a> brcaRna_cv_enet,</span>
<span id="cb178-7"><a href="brca-rnaseseq-explore-sparsity.html#cb178-7"></a> <span class="dt">s=</span><span class="st">&#39;lambda.1se&#39;</span></span>
<span id="cb178-8"><a href="brca-rnaseseq-explore-sparsity.html#cb178-8"></a>)</span>
<span id="cb178-9"><a href="brca-rnaseseq-explore-sparsity.html#cb178-9"></a>enet_coef_frm &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb178-10"><a href="brca-rnaseseq-explore-sparsity.html#cb178-10"></a> <span class="dt">gene=</span>enet_coef<span class="op">@</span>Dimnames[[<span class="dv">1</span>]][<span class="kw">c</span>(<span class="dv">1</span>, enet_coef<span class="op">@</span>i[<span class="op">-</span><span class="dv">1</span>])],</span>
<span id="cb178-11"><a href="brca-rnaseseq-explore-sparsity.html#cb178-11"></a> <span class="dt">enet=</span>enet_coef<span class="op">@</span>x)</span>
<span id="cb178-12"><a href="brca-rnaseseq-explore-sparsity.html#cb178-12"></a></span>
<span id="cb178-13"><a href="brca-rnaseseq-explore-sparsity.html#cb178-13"></a> </span>
<span id="cb178-14"><a href="brca-rnaseseq-explore-sparsity.html#cb178-14"></a>  Mycol &lt;-<span class="st"> </span><span class="kw">colorpanel</span>(<span class="dv">1000</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>)</span>
<span id="cb178-15"><a href="brca-rnaseseq-explore-sparsity.html#cb178-15"></a>  <span class="kw">heatmap.2</span>(</span>
<span id="cb178-16"><a href="brca-rnaseseq-explore-sparsity.html#cb178-16"></a>    <span class="dt">x=</span><span class="kw">t</span>(brcaRna_train_geneExpr_mtx[,enet_coef_frm<span class="op">$</span>gene[<span class="op">-</span><span class="dv">1</span>]]),</span>
<span id="cb178-17"><a href="brca-rnaseseq-explore-sparsity.html#cb178-17"></a>    <span class="dt">scale=</span><span class="st">&quot;row&quot;</span>,</span>
<span id="cb178-18"><a href="brca-rnaseseq-explore-sparsity.html#cb178-18"></a>    <span class="dt">labRow=</span>enet_coef_frm<span class="op">$</span>gene,</span>
<span id="cb178-19"><a href="brca-rnaseseq-explore-sparsity.html#cb178-19"></a>    <span class="dt">labCol=</span>brcaRna_train_group_vec,</span>
<span id="cb178-20"><a href="brca-rnaseseq-explore-sparsity.html#cb178-20"></a>    <span class="dt">col=</span>Mycol, </span>
<span id="cb178-21"><a href="brca-rnaseseq-explore-sparsity.html#cb178-21"></a>    <span class="dt">trace=</span><span class="st">&quot;none&quot;</span>, <span class="dt">density.info=</span><span class="st">&quot;none&quot;</span>, </span>
<span id="cb178-22"><a href="brca-rnaseseq-explore-sparsity.html#cb178-22"></a>    <span class="co">#margin=c(8,6), lhei=c(2,10), </span></span>
<span id="cb178-23"><a href="brca-rnaseseq-explore-sparsity.html#cb178-23"></a>    <span class="co">#lwid=c(0.1,4), #lhei=c(0.1,4)</span></span>
<span id="cb178-24"><a href="brca-rnaseseq-explore-sparsity.html#cb178-24"></a>    <span class="dt">key=</span>F,</span>
<span id="cb178-25"><a href="brca-rnaseseq-explore-sparsity.html#cb178-25"></a>    <span class="dt">ColSideColors=</span><span class="kw">ifelse</span>(brcaRna_train_group_vec<span class="op">==</span><span class="st">&#39;_Other&#39;</span>, <span class="st">&#39;green&#39;</span>,<span class="st">&#39;red&#39;</span>),</span>
<span id="cb178-26"><a href="brca-rnaseseq-explore-sparsity.html#cb178-26"></a>    <span class="dt">dendrogram=</span><span class="st">&quot;both&quot;</span>,</span>
<span id="cb178-27"><a href="brca-rnaseseq-explore-sparsity.html#cb178-27"></a>    <span class="dt">main=</span><span class="kw">paste</span>(<span class="st">&#39;enet genes - N =&#39;</span>, <span class="kw">nrow</span>(enet_coef_frm)<span class="op">-</span><span class="dv">1</span>))</span></code></pre></div>
<div class="figure"><span id="fig:brcaRna-glmnetFit-heatmapEnet"></span>
<img src="Static/figures/brcaRna-glmnetFit-heatmapEnet-1.png" alt="Enet Model Genes" width="768" />
<p class="caption">
Figure 7.13: Enet Model Genes
</p>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="brca-rnaseq-preproc.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="brca-rnaseq-model-suite.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["HCC5hmCExplore.pdf", "HCC5hmCExplore.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
