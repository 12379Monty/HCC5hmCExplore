<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 4 The bet on sparsity | DNA Hydroxymethylation in Hepatocellular Carcinoma</title>
  <meta name="description" content="Data from Cai et al. (2019) paper are explored" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 4 The bet on sparsity | DNA Hydroxymethylation in Hepatocellular Carcinoma" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Data from Cai et al. (2019) paper are explored" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 4 The bet on sparsity | DNA Hydroxymethylation in Hepatocellular Carcinoma" />
  
  <meta name="twitter:description" content="Data from Cai et al. (2019) paper are explored" />
  

<meta name="author" content="Francois Collin" />


<meta name="date" content="2020-09-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="modeling-background.html"/>
<link rel="next" href="examine-feature-selection.html"/>
<script src="libs/header-attrs-2.2/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">DNA Hydroxymethylation in Hepatocellular Carcinoma</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preamble</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="preproc.html"><a href="preproc.html"><i class="fa fa-check"></i><b>2</b> Preprocessing</a>
<ul>
<li class="chapter" data-level="2.1" data-path="preproc.html"><a href="preproc.html#load-the-data"><i class="fa fa-check"></i><b>2.1</b> Load the data</a></li>
<li class="chapter" data-level="2.2" data-path="preproc.html"><a href="preproc.html#dra"><i class="fa fa-check"></i><b>2.2</b> Differential representation analysis</a>
<ul>
<li class="chapter" data-level="" data-path="preproc.html"><a href="preproc.html#remove-lowly-expressed-genes"><i class="fa fa-check"></i>Remove lowly expressed genes</a></li>
<li class="chapter" data-level="" data-path="preproc.html"><a href="preproc.html#creating-a-design-matrix-and-contrasts"><i class="fa fa-check"></i>Creating a design matrix and contrasts</a></li>
<li class="chapter" data-level="" data-path="preproc.html"><a href="preproc.html#removing-heteroscedasticity-from-the-count-data"><i class="fa fa-check"></i>Removing heteroscedasticity from the count data</a></li>
<li class="chapter" data-level="" data-path="preproc.html"><a href="preproc.html#fit-linear-models-and-examine-the-results"><i class="fa fa-check"></i>Fit linear models and examine the results</a></li>
<li class="chapter" data-level="" data-path="preproc.html"><a href="preproc.html#graphical-representations-of-de-results-md-plots"><i class="fa fa-check"></i>Graphical representations of DE results: MD Plots</a></li>
<li class="chapter" data-level="" data-path="preproc.html"><a href="preproc.html#de-genes-at-10-fold-change"><i class="fa fa-check"></i>DE genes at 10% fold change</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="preproc.html"><a href="preproc.html#snr-regime"><i class="fa fa-check"></i><b>2.3</b> Signal-to-noise ratio regime</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="modeling-background.html"><a href="modeling-background.html"><i class="fa fa-check"></i><b>3</b> Modeling - Background</a>
<ul>
<li class="chapter" data-level="3.1" data-path="modeling-background.html"><a href="modeling-background.html#predictive-modeling-for-genomic-data"><i class="fa fa-check"></i><b>3.1</b> Predictive modeling for genomic data</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="modeling-background.html"><a href="modeling-background.html#caret-for-model-evaluation"><i class="fa fa-check"></i><b>3.1.1</b> caret for model evaluation</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="modeling-background.html"><a href="modeling-background.html#glmnet"><i class="fa fa-check"></i><b>3.2</b> glmnet</a>
<ul>
<li><a href="modeling-background.html#alpha-hyper-parameter"><strong>alpha</strong> hyper-parameter</a></li>
<li class="chapter" data-level="" data-path="modeling-background.html"><a href="modeling-background.html#lasso-vs-best-subset"><i class="fa fa-check"></i>Lasso vs Best Subset</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="explore-sparsity.html"><a href="explore-sparsity.html"><i class="fa fa-check"></i><b>4</b> The bet on sparsity</a>
<ul>
<li class="chapter" data-level="4.1" data-path="explore-sparsity.html"><a href="explore-sparsity.html#cv-analysis-setup"><i class="fa fa-check"></i><b>4.1</b> CV analysis setup</a></li>
<li class="chapter" data-level="4.2" data-path="explore-sparsity.html"><a href="explore-sparsity.html#fit-and-compare-models"><i class="fa fa-check"></i><b>4.2</b> Fit and compare models</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="explore-sparsity.html"><a href="explore-sparsity.html#logistic-regression-in-glmnet"><i class="fa fa-check"></i><b>4.2.1</b> Logistic regression in <code>glmnet</code></a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="explore-sparsity.html"><a href="explore-sparsity.html#relaxed-lasso-and-blended-mix"><i class="fa fa-check"></i><b>4.3</b> Relaxed lasso and blended mix</a></li>
<li class="chapter" data-level="4.4" data-path="explore-sparsity.html"><a href="explore-sparsity.html#examination-of-sensitivity-vs-specificity"><i class="fa fa-check"></i><b>4.4</b> Examination of sensitivity vs specificity</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="explore-sparsity.html"><a href="explore-sparsity.html#training-data-out-of-fold-roc-curves"><i class="fa fa-check"></i><b>4.4.1</b> Training data out-of-fold ROC curves</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="explore-sparsity.html"><a href="explore-sparsity.html#refit-with-auc-as-optimization"><i class="fa fa-check"></i><b>4.5</b> Refit with “auc” as optimization</a></li>
<li class="chapter" data-level="4.6" data-path="explore-sparsity.html"><a href="explore-sparsity.html#relaxed-lasso-and-blended-mix-1"><i class="fa fa-check"></i><b>4.6</b> Relaxed lasso and blended mix</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="examine-feature-selection.html"><a href="examine-feature-selection.html"><i class="fa fa-check"></i><b>5</b> Examine feature selection</a>
<ul>
<li class="chapter" data-level="5.1" data-path="examine-feature-selection.html"><a href="examine-feature-selection.html#sparsity-stability"><i class="fa fa-check"></i><b>5.1</b> Sparsity stability</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="model-suite.html"><a href="model-suite.html"><i class="fa fa-check"></i><b>6</b> Fitted Model Suite</a></li>
<li class="chapter" data-level="7" data-path="conclusions.html"><a href="conclusions.html"><i class="fa fa-check"></i><b>7</b> Conclusions</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="LICENSE.md" style="font:em;" target="blank">Copyright (c) 2020 Francois Collin</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">DNA Hydroxymethylation in Hepatocellular Carcinoma</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="explore-sparsity" class="section level1" number="4">
<h1><span class="header-section-number">Section 4</span> The bet on sparsity</h1>
<p>In this section we explore various fits that can be computed
ans analyzed with tools provided in the <code>glmnet</code> package.
Refer to the <a href="https://web.stanford.edu/~hastie/glmnet/glmnet_alpha.html">Glmnet Vignette</a>
for a quick reference guide.</p>
<div id="cv-analysis-setup" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> CV analysis setup</h2>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="explore-sparsity.html#cb16-1"></a>K_FOLD &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb16-2"><a href="explore-sparsity.html#cb16-2"></a>trainP &lt;-<span class="st"> </span><span class="fl">0.8</span></span>
<span id="cb16-3"><a href="explore-sparsity.html#cb16-3"></a>EPS &lt;-<span class="st"> </span><span class="fl">0.02</span>    <span class="co"># Have no idea what &quot;small&quot; epsilon means</span></span></code></pre></div>
<p>First we divide the analysis dataset into <code>train</code> and <code>test</code> in a 4:1 ratio.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="explore-sparsity.html#cb17-1"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb17-2"><a href="explore-sparsity.html#cb17-2"></a>train_sampID_vec &lt;-<span class="st"> </span><span class="kw">with</span>(AF_dgel<span class="op">$</span>samples,</span>
<span id="cb17-3"><a href="explore-sparsity.html#cb17-3"></a>AF_dgel<span class="op">$</span>samples<span class="op">$</span>sampID[caret<span class="op">::</span><span class="kw">createDataPartition</span>(<span class="dt">y=</span>group, <span class="dt">p=</span>trainP, <span class="dt">list=</span>F)]</span>
<span id="cb17-4"><a href="explore-sparsity.html#cb17-4"></a>)</span>
<span id="cb17-5"><a href="explore-sparsity.html#cb17-5"></a></span>
<span id="cb17-6"><a href="explore-sparsity.html#cb17-6"></a>test_sampID_vec &lt;-<span class="st"> </span><span class="kw">with</span>(AF_dgel<span class="op">$</span>samples,</span>
<span id="cb17-7"><a href="explore-sparsity.html#cb17-7"></a><span class="kw">setdiff</span>(sampID, train_sampID_vec)</span>
<span id="cb17-8"><a href="explore-sparsity.html#cb17-8"></a>)</span>
<span id="cb17-9"><a href="explore-sparsity.html#cb17-9"></a></span>
<span id="cb17-10"><a href="explore-sparsity.html#cb17-10"></a>train_group_vec &lt;-<span class="st"> </span>AF_dgel<span class="op">$</span>samples[train_sampID_vec, <span class="st">&#39;group&#39;</span>]</span>
<span id="cb17-11"><a href="explore-sparsity.html#cb17-11"></a>test_group_vec &lt;-<span class="st"> </span>AF_dgel<span class="op">$</span>samples[test_sampID_vec, <span class="st">&#39;group&#39;</span>]</span>
<span id="cb17-12"><a href="explore-sparsity.html#cb17-12"></a></span>
<span id="cb17-13"><a href="explore-sparsity.html#cb17-13"></a>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">table</span>(train_group_vec),</span>
<span id="cb17-14"><a href="explore-sparsity.html#cb17-14"></a>  <span class="dt">caption=</span><span class="st">&quot;Train set&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb17-15"><a href="explore-sparsity.html#cb17-15"></a><span class="st">   </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F)</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:getTrainVal">Table 4.1: </span>Train set
</caption>
<thead>
<tr>
<th style="text-align:left;">
train_group_vec
</th>
<th style="text-align:right;">
Freq
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Control
</td>
<td style="text-align:right;">
623
</td>
</tr>
<tr>
<td style="text-align:left;">
HCC
</td>
<td style="text-align:right;">
444
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="explore-sparsity.html#cb18-1"></a>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">table</span>(test_group_vec),</span>
<span id="cb18-2"><a href="explore-sparsity.html#cb18-2"></a>  <span class="dt">caption=</span><span class="st">&quot;Test set&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb18-3"><a href="explore-sparsity.html#cb18-3"></a><span class="st">   </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F)</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:getTrainVal">Table 4.1: </span>Test set
</caption>
<thead>
<tr>
<th style="text-align:left;">
test_group_vec
</th>
<th style="text-align:right;">
Freq
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Control
</td>
<td style="text-align:right;">
155
</td>
</tr>
<tr>
<td style="text-align:left;">
HCC
</td>
<td style="text-align:right;">
111
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="explore-sparsity.html#cb19-1"></a>train_lcpm_mtx &lt;-<span class="st"> </span><span class="kw">t</span>(lcpm_mtx[,train_sampID_vec])</span>
<span id="cb19-2"><a href="explore-sparsity.html#cb19-2"></a>test_lcpm_mtx &lt;-<span class="st"> </span><span class="kw">t</span>(lcpm_mtx[,test_sampID_vec])</span></code></pre></div>
<p>We explore some glmnet fits and the “bet on sparsity”</p>
<ul>
<li>Consider models:
<ul>
<li>lasso: <span class="math inline">\(\alpha = 1.0\)</span> - sparse model<br />
</li>
<li>ridge <span class="math inline">\(\alpha = 0\)</span> - shrunken coefficients model</li>
<li>elastic net: <span class="math inline">\(\alpha = 0.5\)</span> - semi sparse model
<!-- - lassoC: $\alpha = 1-\epsilon =$ 0.98 - lasso for correlated predictors  --></li>
</ul></li>
<li>Does the relaxed lasso improve performance?<br />
</li>
<li>Does the shrunken relaxed lasso (aka the blended mix) improve performance<br />
</li>
<li>How sparse is the model undelying best 5hmC classifier for Early HCC vs Control?<br />
</li>
<li>Is the degree of sparsity, or the size of the model, a stable feature of the problem and data set?</li>
</ul>
<p>In this analysis, we will only evaluate models in terms of
model size, stability and performance. We leave the question
of significance testing of hypotheses about model parameters
completely out. See Lockhart et al. (2014) <span class="citation">[<a href="references.html#ref-Lockhart:2014aa" role="doc-biblioref">24</a>]</span>
and Wassermam (2014) <span class="citation">[<a href="references.html#ref-Wasserman:2014aa" role="doc-biblioref">25</a>]</span> for a discussion of this topic.</p>
<p>Next we create folds for 10-fold cross-validation of models fitted to
training data. We’ll use caret::createFolds to assign samples
to folds while keeping the outcome ratios constant across folds.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="explore-sparsity.html#cb20-1"></a><span class="co"># This is too variable, both in terms of fold size And composition</span></span>
<span id="cb20-2"><a href="explore-sparsity.html#cb20-2"></a><span class="co">#foldid_vec &lt;- sample(1:10, size=length(train_group_vec), replace=T)</span></span>
<span id="cb20-3"><a href="explore-sparsity.html#cb20-3"></a></span>
<span id="cb20-4"><a href="explore-sparsity.html#cb20-4"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb20-5"><a href="explore-sparsity.html#cb20-5"></a>train_foldid_vec &lt;-<span class="st"> </span>caret<span class="op">::</span><span class="kw">createFolds</span>(</span>
<span id="cb20-6"><a href="explore-sparsity.html#cb20-6"></a> <span class="kw">factor</span>(train_group_vec), </span>
<span id="cb20-7"><a href="explore-sparsity.html#cb20-7"></a> <span class="dt">k=</span>K_FOLD,</span>
<span id="cb20-8"><a href="explore-sparsity.html#cb20-8"></a> <span class="dt">list=</span>F)</span>
<span id="cb20-9"><a href="explore-sparsity.html#cb20-9"></a></span>
<span id="cb20-10"><a href="explore-sparsity.html#cb20-10"></a>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">sapply</span>(<span class="kw">split</span>(train_group_vec, train_foldid_vec), </span>
<span id="cb20-11"><a href="explore-sparsity.html#cb20-11"></a>  table), <span class="dt">caption=</span><span class="st">&quot;training samples fold composition&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb20-12"><a href="explore-sparsity.html#cb20-12"></a><span class="st">   </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F)</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:getTrainFolds">Table 4.2: </span>training samples fold composition
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
1
</th>
<th style="text-align:right;">
2
</th>
<th style="text-align:right;">
3
</th>
<th style="text-align:right;">
4
</th>
<th style="text-align:right;">
5
</th>
<th style="text-align:right;">
6
</th>
<th style="text-align:right;">
7
</th>
<th style="text-align:right;">
8
</th>
<th style="text-align:right;">
9
</th>
<th style="text-align:right;">
10
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Control
</td>
<td style="text-align:right;">
62
</td>
<td style="text-align:right;">
62
</td>
<td style="text-align:right;">
62
</td>
<td style="text-align:right;">
63
</td>
<td style="text-align:right;">
62
</td>
<td style="text-align:right;">
62
</td>
<td style="text-align:right;">
63
</td>
<td style="text-align:right;">
62
</td>
<td style="text-align:right;">
63
</td>
<td style="text-align:right;">
62
</td>
</tr>
<tr>
<td style="text-align:left;">
HCC
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
44
</td>
<td style="text-align:right;">
44
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
44
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
44
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
44
</td>
<td style="text-align:right;">
44
</td>
</tr>
</tbody>
</table>
<p>Note that the folds identify samples that are left-out of the training
data for each fold fit.</p>
</div>
<div id="fit-and-compare-models" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Fit and compare models</h2>
<ul>
<li>cross-validated accuracy</li>
<li>test set accuracy<br />
</li>
<li>sparsity
<ul>
<li>for lasso, enet <!--and lassoC-->, examine number of selected variables</li>
</ul></li>
</ul>
<p>Although “the one standard error rule” can produce a model with fewer predictors, it usually results in increased MSE and more biased parameter estimates
(see Engebretsen et al. (2019) <span class="citation">[<a href="references.html#ref-Engebretsen:2019aa" role="doc-biblioref">26</a>]</span> for example).
We will look at both the minimum cv error and the one standard error rule model
preformance.</p>
<div id="logistic-regression-in-glmnet" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Logistic regression in <code>glmnet</code></h3>
<p><code>glmnet</code> provides functionality to extract various predicted of fitted values
from calibrated models. Note in passsing that some folks make a distinction between
<strong>fitted</strong> or <strong>estimated</strong> values for sample points in the training data
vurses <strong>predicted</strong> values for sample points that
are not in the training dataset. <code>glmnet</code> makes no such distinction and the
<code>predict</code> function is used to produce both fitted as well as predicted values.
For logistic regressions, which is the model fitted in a regularized fashion
when models are fitted by glmnet with the parameter <code>family='binomial'</code>, three
fitted or predicted values can be extracted at a given design point.<br />
Suppose our response variable Y is either 0 or 1 (Control or HCC in our case).
These are specified by the <code>type</code> parameter. <code>type='resp'</code> returns
the fitted or predicted probability of <span class="math inline">\(Y=1\)</span>. <code>type='class'</code> returns the fitted or
predicted class for the design point, which is simply dichotomizing the
response: class = 1 if the fitted or predicted probability is greater than 0.5
(check to make sure class is no the Bayes estimate). <code>type='link'</code> returns
the fitted or predicted vealue of the linear predictor <span class="math inline">\(\beta&#39;x\)</span>. The relationship
between the linear predictor and the response can be derided from the
logis toc regression model:</p>
<p><span class="math display">\[P(Y=1|x,\beta) = g^{-1}(\beta&#39;x) = h(\beta&#39;x) = \frac{e^{\beta&#39;x}}{1+e^{\beta&#39;x}}\]</span></p>
<p>where <span class="math inline">\(g\)</span> is the link function, <span class="math inline">\(g^{-1}\)</span> the mean function.
The link function is given by:</p>
<p><span class="math display">\[g(y) = h^{-1}(y) = ln(\frac{y}{1-y})\]</span></p>
<p>This link function is called the logit function, and its inverse the logistic
function.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="explore-sparsity.html#cb21-1"></a>logistic_f &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">exp</span>(x)<span class="op">/</span>(<span class="dv">1</span><span class="op">+</span><span class="kw">exp</span>(x))</span></code></pre></div>
<p>It is important to note that all <em>predicted</em> values extracted from
<code>glmnet</code> fitted models by the <strong>predict()</strong> extraction method
yield <strong>fitted</strong> values for design points that are part of the
training data set. This includes the predicted class for training data
which ae used to estimate misclassification error rates. As a result, the cv error
rates quoted in various <code>glmnet</code> summaries are generally optimistic.
<code>glmnet</code> fitting functions have a
parameter, <em>keep</em>, which instructs the fitting function to keep the
<code>out-of-fold</code>, or <code>prevalidated</code>, predictions as part of the returned object. The
<code>out-of-fold</code> predictions are predicted values for the samples in the
left-out folds, pooled across all cv folds. For each hyper-parameter
specification, we get one full set of <code>out-of-fold</code> predictions for
the training set samples. Performance assessments based on these
values are usually more generalizable - ie. predictive of
performance in unseen data - than assessments based on values
produced from the full fit, which by default is what <code>glmnet</code> extraction
methods provide. See Höfling and Tibshirani (2008) <span class="citation">[<a href="references.html#ref-Hofling:2008aa" role="doc-biblioref">27</a>]</span>
for a description of the use of pre-validation in model assessment.</p>
<p>Because the <code>keep=T</code> option will store predicted values for
all models evaluated in the cross-validation process, we will
limit the number of models tested by setting <strong>nlambda=30</strong>
when calling the fitting functions. This has no effect on
performance in this data set.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="explore-sparsity.html#cb22-1"></a>start_time &lt;-<span class="st">  </span><span class="kw">proc.time</span>()</span>
<span id="cb22-2"><a href="explore-sparsity.html#cb22-2"></a></span>
<span id="cb22-3"><a href="explore-sparsity.html#cb22-3"></a>cv_lasso &lt;-<span class="st"> </span>glmnet<span class="op">::</span><span class="kw">cv.glmnet</span>(</span>
<span id="cb22-4"><a href="explore-sparsity.html#cb22-4"></a> <span class="dt">x=</span>train_lcpm_mtx,</span>
<span id="cb22-5"><a href="explore-sparsity.html#cb22-5"></a> <span class="dt">y=</span>train_group_vec,</span>
<span id="cb22-6"><a href="explore-sparsity.html#cb22-6"></a> <span class="dt">foldid=</span>train_foldid_vec,</span>
<span id="cb22-7"><a href="explore-sparsity.html#cb22-7"></a> <span class="dt">alpha=</span><span class="dv">1</span>,</span>
<span id="cb22-8"><a href="explore-sparsity.html#cb22-8"></a> <span class="dt">family=</span><span class="st">&#39;binomial&#39;</span>, </span>
<span id="cb22-9"><a href="explore-sparsity.html#cb22-9"></a> <span class="dt">type.measure =</span> <span class="st">&quot;class&quot;</span>,</span>
<span id="cb22-10"><a href="explore-sparsity.html#cb22-10"></a> <span class="dt">keep=</span>T,</span>
<span id="cb22-11"><a href="explore-sparsity.html#cb22-11"></a> <span class="dt">nlambda=</span><span class="dv">30</span></span>
<span id="cb22-12"><a href="explore-sparsity.html#cb22-12"></a>)</span>
<span id="cb22-13"><a href="explore-sparsity.html#cb22-13"></a></span>
<span id="cb22-14"><a href="explore-sparsity.html#cb22-14"></a><span class="kw">message</span>(<span class="st">&quot;lasso time: &quot;</span>, <span class="kw">round</span>((<span class="kw">proc.time</span>() <span class="op">-</span><span class="st"> </span>start_time)[<span class="dv">3</span>],<span class="dv">2</span>),<span class="st">&quot;s&quot;</span>)</span></code></pre></div>
<pre><code>## lasso time: 13.3s</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="explore-sparsity.html#cb24-1"></a>start_time &lt;-<span class="st">  </span><span class="kw">proc.time</span>()</span>
<span id="cb24-2"><a href="explore-sparsity.html#cb24-2"></a></span>
<span id="cb24-3"><a href="explore-sparsity.html#cb24-3"></a>cv_ridge &lt;-<span class="st"> </span>glmnet<span class="op">::</span><span class="kw">cv.glmnet</span>(</span>
<span id="cb24-4"><a href="explore-sparsity.html#cb24-4"></a> <span class="dt">x=</span>train_lcpm_mtx,</span>
<span id="cb24-5"><a href="explore-sparsity.html#cb24-5"></a> <span class="dt">y=</span>train_group_vec,</span>
<span id="cb24-6"><a href="explore-sparsity.html#cb24-6"></a> <span class="dt">foldid=</span>train_foldid_vec,</span>
<span id="cb24-7"><a href="explore-sparsity.html#cb24-7"></a> <span class="dt">alpha=</span><span class="dv">0</span>,</span>
<span id="cb24-8"><a href="explore-sparsity.html#cb24-8"></a> <span class="dt">family=</span><span class="st">&#39;binomial&#39;</span>, </span>
<span id="cb24-9"><a href="explore-sparsity.html#cb24-9"></a> <span class="dt">type.measure =</span> <span class="st">&quot;class&quot;</span>,</span>
<span id="cb24-10"><a href="explore-sparsity.html#cb24-10"></a> <span class="dt">keep=</span>T,</span>
<span id="cb24-11"><a href="explore-sparsity.html#cb24-11"></a> <span class="dt">nlambda=</span><span class="dv">30</span></span>
<span id="cb24-12"><a href="explore-sparsity.html#cb24-12"></a>)</span>
<span id="cb24-13"><a href="explore-sparsity.html#cb24-13"></a></span>
<span id="cb24-14"><a href="explore-sparsity.html#cb24-14"></a><span class="kw">message</span>(<span class="st">&quot;ridge time: &quot;</span>, <span class="kw">round</span>((<span class="kw">proc.time</span>() <span class="op">-</span><span class="st"> </span>start_time)[<span class="dv">3</span>],<span class="dv">2</span>),<span class="st">&quot;s&quot;</span>)</span></code></pre></div>
<pre><code>## ridge time: 104.5s</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="explore-sparsity.html#cb26-1"></a>start_time &lt;-<span class="st">  </span><span class="kw">proc.time</span>()</span>
<span id="cb26-2"><a href="explore-sparsity.html#cb26-2"></a></span>
<span id="cb26-3"><a href="explore-sparsity.html#cb26-3"></a>cv_enet &lt;-<span class="st"> </span>glmnet<span class="op">::</span><span class="kw">cv.glmnet</span>(</span>
<span id="cb26-4"><a href="explore-sparsity.html#cb26-4"></a> <span class="dt">x=</span>train_lcpm_mtx,</span>
<span id="cb26-5"><a href="explore-sparsity.html#cb26-5"></a> <span class="dt">y=</span>train_group_vec,</span>
<span id="cb26-6"><a href="explore-sparsity.html#cb26-6"></a> <span class="dt">foldid=</span>train_foldid_vec,</span>
<span id="cb26-7"><a href="explore-sparsity.html#cb26-7"></a> <span class="dt">alpha=</span><span class="fl">0.5</span>,</span>
<span id="cb26-8"><a href="explore-sparsity.html#cb26-8"></a> <span class="dt">family=</span><span class="st">&#39;binomial&#39;</span>,</span>
<span id="cb26-9"><a href="explore-sparsity.html#cb26-9"></a> <span class="dt">type.measure =</span> <span class="st">&quot;class&quot;</span>,</span>
<span id="cb26-10"><a href="explore-sparsity.html#cb26-10"></a> <span class="dt">keep=</span>T,</span>
<span id="cb26-11"><a href="explore-sparsity.html#cb26-11"></a> <span class="dt">nlambda=</span><span class="dv">30</span></span>
<span id="cb26-12"><a href="explore-sparsity.html#cb26-12"></a>)</span>
<span id="cb26-13"><a href="explore-sparsity.html#cb26-13"></a></span>
<span id="cb26-14"><a href="explore-sparsity.html#cb26-14"></a><span class="kw">message</span>(<span class="st">&quot;enet time: &quot;</span>, <span class="kw">round</span>((<span class="kw">proc.time</span>() <span class="op">-</span><span class="st"> </span>start_time)[<span class="dv">3</span>],<span class="dv">2</span>),<span class="st">&quot;s&quot;</span>)</span></code></pre></div>
<pre><code>## enet time: 12.3s</code></pre>
<p>The ridge regression model takes over 10 times longer to compute.</p>
<!-- do not show
Define plotting function.
Maybe show in appendix??
-->
<p>Examine model performance.</p>
<pre><code>## Warning: package &#39;glmnet&#39; was built under R version 4.0.2</code></pre>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## Loaded glmnet 4.0-2</code></pre>
<div class="figure"><span id="fig:lookFits"></span>
<img src="Static/figures/lookFits-1.png" alt="compare fits" width="1056" />
<p class="caption">
Figure 4.1: compare fits
</p>
</div>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="explore-sparsity.html#cb31-1"></a>errors_frm &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb31-2"><a href="explore-sparsity.html#cb31-2"></a>  <span class="dt">lasso =</span> lasso_errors_mtx, <span class="dt">ridge =</span> rifge_errors_mtx, <span class="dt">enet =</span> enet_errors_mtx</span>
<span id="cb31-3"><a href="explore-sparsity.html#cb31-3"></a>)</span>
<span id="cb31-4"><a href="explore-sparsity.html#cb31-4"></a></span>
<span id="cb31-5"><a href="explore-sparsity.html#cb31-5"></a>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">t</span>(errors_frm)<span class="op">*</span><span class="dv">100</span>,</span>
<span id="cb31-6"><a href="explore-sparsity.html#cb31-6"></a> <span class="dt">caption =</span> <span class="st">&#39;Misclassifiaction error rates&#39;</span>,</span>
<span id="cb31-7"><a href="explore-sparsity.html#cb31-7"></a> <span class="dt">digits=</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb31-8"><a href="explore-sparsity.html#cb31-8"></a><span class="st">  </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F)</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:printErrors">Table 4.3: </span>Misclassifiaction error rates
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
train_cv
</th>
<th style="text-align:right;">
train_oof
</th>
<th style="text-align:right;">
test
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
lasso.error_1se
</td>
<td style="text-align:right;">
7.0
</td>
<td style="text-align:right;">
9.7
</td>
<td style="text-align:right;">
10.2
</td>
</tr>
<tr>
<td style="text-align:left;">
lasso.error_min
</td>
<td style="text-align:right;">
7.0
</td>
<td style="text-align:right;">
9.7
</td>
<td style="text-align:right;">
10.2
</td>
</tr>
<tr>
<td style="text-align:left;">
ridge.error_1se
</td>
<td style="text-align:right;">
13.5
</td>
<td style="text-align:right;">
19.0
</td>
<td style="text-align:right;">
18.4
</td>
</tr>
<tr>
<td style="text-align:left;">
ridge.error_min
</td>
<td style="text-align:right;">
12.5
</td>
<td style="text-align:right;">
16.9
</td>
<td style="text-align:right;">
16.2
</td>
</tr>
<tr>
<td style="text-align:left;">
enet.error_1se
</td>
<td style="text-align:right;">
7.2
</td>
<td style="text-align:right;">
11.1
</td>
<td style="text-align:right;">
12.0
</td>
</tr>
<tr>
<td style="text-align:left;">
enet.error_min
</td>
<td style="text-align:right;">
6.7
</td>
<td style="text-align:right;">
9.2
</td>
<td style="text-align:right;">
10.2
</td>
</tr>
</tbody>
</table>
<p>We see that the lasso and enet models do better than the ridge model.
These is very little difference between the min lambda and the
the one standard error rule lambda models (the two are the same for the
lasso in this data set). We also see that the training data out-of-fold
estimates of misclassification error rates are much closer to the
test set estimates than are the cv estimated rates. This has
been our experience with regularized regression models fitted to
genomic scale data. It should also be noted thay the cv estimates of
misclassification rates become more biased as the sample size decreases,
as we will show in Section <a href="model-suite.html#model-suite">6</a>.</p>
</div>
</div>
<div id="relaxed-lasso-and-blended-mix" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Relaxed lasso and blended mix</h2>
<p>Next we look at the so-called <code>relaxed lasso</code> and
the <code>blended mix</code> which is an optimized shrinkage
between the relaxed lasso and the regular lasso.</p>
<!--
The relaxed fit takes quite a bit longer.  
-->
<pre><code>## 
## Call:  glmnet::cv.glmnet(x = train_lcpm_mtx, y = train_group_vec, type.measure = &quot;class&quot;,      foldid = train_foldid_vec, keep = T, relax = T, alpha = 1,      family = &quot;binomial&quot;, nlambda = 30) 
## 
## Measure: Misclassification Error 
## 
##     Gamma Lambda Measure       SE Nonzero
## min   0.5 0.0379 0.06748 0.005274      35
## 1se   0.5 0.0379 0.06748 0.005274      35</code></pre>
<div class="figure"><span id="fig:lookLassoR"></span>
<img src="Static/figures/lookLassoR-1.png" alt="lassoR fit" width="480" />
<p class="caption">
Figure 4.2: lassoR fit
</p>
</div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:lookLassoR">Table 4.4: </span>Relaxed lasso and blended mix error rates
</caption>
<tbody>
<tr>
<td style="text-align:left;">
train_blended_cv
</td>
<td style="text-align:right;">
6.7
</td>
</tr>
<tr>
<td style="text-align:left;">
train_blended_oof
</td>
<td style="text-align:right;">
10.2
</td>
</tr>
<tr>
<td style="text-align:left;">
train_relaxed_oof
</td>
<td style="text-align:right;">
11.1
</td>
</tr>
<tr>
<td style="text-align:left;">
test_blended_oof
</td>
<td style="text-align:right;">
10.2
</td>
</tr>
<tr>
<td style="text-align:left;">
test_relaxed_oof
</td>
<td style="text-align:right;">
10.9
</td>
</tr>
</tbody>
</table>
<p>The relaxed lasso and blended mix error rates are comparable to the
regular lasso fit error rate. We see here too that the reported cv
error rates are quite optimistic, while out-of-fold error rates
continue to be good indicaters of unseen data error rates.</p>
</div>
<div id="examination-of-sensitivity-vs-specificity" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Examination of sensitivity vs specificity</h2>
<p>In the results above we reported error rates without inspecting the
sensitivity vurses specificity trade off. Here we look at this
question with the help of ROC curves.</p>
<div id="training-data-out-of-fold-roc-curves" class="section level3" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Training data out-of-fold ROC curves</h3>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="explore-sparsity.html#cb33-1"></a><span class="co"># train</span></span>
<span id="cb33-2"><a href="explore-sparsity.html#cb33-2"></a><span class="co"># lasso</span></span>
<span id="cb33-3"><a href="explore-sparsity.html#cb33-3"></a>ndx_1se &lt;-<span class="st"> </span><span class="kw">match</span>(cv_lasso<span class="op">$</span>lambda<span class="fl">.1</span>se,cv_lasso<span class="op">$</span>lambda)</span>
<span id="cb33-4"><a href="explore-sparsity.html#cb33-4"></a>train_lasso_oofProb_vec &lt;-<span class="st"> </span><span class="kw">logistic_f</span>(cv_lasso<span class="op">$</span>fit.preval[,ndx_1se])</span>
<span id="cb33-5"><a href="explore-sparsity.html#cb33-5"></a>train_lasso_roc &lt;-<span class="st"> </span>pROC<span class="op">::</span><span class="kw">roc</span>(</span>
<span id="cb33-6"><a href="explore-sparsity.html#cb33-6"></a> <span class="dt">response =</span> <span class="kw">as.numeric</span>(train_group_vec<span class="op">==</span><span class="st">&#39;HCC&#39;</span>),</span>
<span id="cb33-7"><a href="explore-sparsity.html#cb33-7"></a> <span class="dt">predictor =</span> train_lasso_oofProb_vec)</span></code></pre></div>
<pre><code>## Setting levels: control = 0, case = 1</code></pre>
<pre><code>## Setting direction: controls &lt; cases</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="explore-sparsity.html#cb36-1"></a><span class="co"># lasso - relaxed</span></span>
<span id="cb36-2"><a href="explore-sparsity.html#cb36-2"></a>ndx_1se &lt;-<span class="st"> </span><span class="kw">match</span>(cv_lassoR<span class="op">$</span>lambda<span class="fl">.1</span>se,cv_lassoR<span class="op">$</span>lambda)</span>
<span id="cb36-3"><a href="explore-sparsity.html#cb36-3"></a>train_lassoR_oofProb_vec &lt;-<span class="st"> </span><span class="kw">logistic_f</span>(cv_lassoR<span class="op">$</span>fit.preval[[<span class="st">&#39;g:0&#39;</span>]][,ndx_1se])</span>
<span id="cb36-4"><a href="explore-sparsity.html#cb36-4"></a>train_lassoR_roc &lt;-<span class="st"> </span>pROC<span class="op">::</span><span class="kw">roc</span>(</span>
<span id="cb36-5"><a href="explore-sparsity.html#cb36-5"></a> <span class="dt">response =</span> <span class="kw">as.numeric</span>(train_group_vec<span class="op">==</span><span class="st">&#39;HCC&#39;</span>),</span>
<span id="cb36-6"><a href="explore-sparsity.html#cb36-6"></a> <span class="dt">predictor =</span> train_lassoR_oofProb_vec)</span></code></pre></div>
<pre><code>## Setting levels: control = 0, case = 1
## Setting direction: controls &lt; cases</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="explore-sparsity.html#cb38-1"></a><span class="co"># blended mix (gamma=0.5)</span></span>
<span id="cb38-2"><a href="explore-sparsity.html#cb38-2"></a>ndx_1se &lt;-<span class="st"> </span><span class="kw">match</span>(cv_lassoR<span class="op">$</span>lambda<span class="fl">.1</span>se,cv_lassoR<span class="op">$</span>lambda)</span>
<span id="cb38-3"><a href="explore-sparsity.html#cb38-3"></a>train_blended_oofProb_vec &lt;-<span class="st"> </span><span class="kw">logistic_f</span>(cv_lassoR<span class="op">$</span>fit.preval[[<span class="st">&#39;g:0.5&#39;</span>]][,ndx_1se])</span>
<span id="cb38-4"><a href="explore-sparsity.html#cb38-4"></a>train_blended_roc &lt;-<span class="st"> </span>pROC<span class="op">::</span><span class="kw">roc</span>(</span>
<span id="cb38-5"><a href="explore-sparsity.html#cb38-5"></a> <span class="dt">response =</span> <span class="kw">as.numeric</span>(train_group_vec<span class="op">==</span><span class="st">&#39;HCC&#39;</span>),</span>
<span id="cb38-6"><a href="explore-sparsity.html#cb38-6"></a> <span class="dt">predictor =</span> train_blended_oofProb_vec)</span></code></pre></div>
<pre><code>## Setting levels: control = 0, case = 1
## Setting direction: controls &lt; cases</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="explore-sparsity.html#cb40-1"></a><span class="kw">plot</span>(train_lasso_roc)</span>
<span id="cb40-2"><a href="explore-sparsity.html#cb40-2"></a><span class="kw">lines</span>(train_lassoR_roc, <span class="dt">col=</span><span class="st">&#39;blue&#39;</span>)</span>
<span id="cb40-3"><a href="explore-sparsity.html#cb40-3"></a><span class="kw">lines</span>(train_blended_roc, <span class="dt">col=</span><span class="st">&#39;green&#39;</span>)</span>
<span id="cb40-4"><a href="explore-sparsity.html#cb40-4"></a></span>
<span id="cb40-5"><a href="explore-sparsity.html#cb40-5"></a><span class="kw">legend</span>(<span class="st">&#39;bottomright&#39;</span>, <span class="dt">title=</span><span class="st">&#39;AUC&#39;</span>,</span>
<span id="cb40-6"><a href="explore-sparsity.html#cb40-6"></a> <span class="dt">legend=</span><span class="kw">c</span>(</span>
<span id="cb40-7"><a href="explore-sparsity.html#cb40-7"></a>  <span class="kw">paste</span>(<span class="st">&#39;lasso =&#39;</span>, <span class="kw">round</span>(train_lasso_roc[[<span class="st">&#39;auc&#39;</span>]],<span class="dv">3</span>)),</span>
<span id="cb40-8"><a href="explore-sparsity.html#cb40-8"></a>  <span class="kw">paste</span>(<span class="st">&#39;lassoR =&#39;</span>, <span class="kw">round</span>(train_lassoR_roc[[<span class="st">&#39;auc&#39;</span>]],<span class="dv">3</span>)),</span>
<span id="cb40-9"><a href="explore-sparsity.html#cb40-9"></a>  <span class="kw">paste</span>(<span class="st">&#39;blended =&#39;</span>, <span class="kw">round</span>(train_blended_roc[[<span class="st">&#39;auc&#39;</span>]],<span class="dv">3</span>))</span>
<span id="cb40-10"><a href="explore-sparsity.html#cb40-10"></a> ),</span>
<span id="cb40-11"><a href="explore-sparsity.html#cb40-11"></a> <span class="dt">text.col =</span> <span class="kw">c</span>(<span class="st">&#39;black&#39;</span>, <span class="st">&#39;blue&#39;</span>, <span class="st">&#39;green&#39;</span>))</span></code></pre></div>
<div class="figure"><span id="fig:trainROC"></span>
<img src="Static/figures/trainROC-1.png" alt="Train data out-of-sample ROCs" width="480" />
<p class="caption">
Figure 4.3: Train data out-of-sample ROCs
</p>
</div>
<p>Compare thresholds for 90% Specificity:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="explore-sparsity.html#cb41-1"></a> lasso_ndx &lt;-<span class="st"> </span><span class="kw">with</span>(<span class="kw">as.data.frame</span>(pROC<span class="op">::</span><span class="kw">coords</span>(train_lasso_roc, <span class="dt">transpose=</span>F)), </span>
<span id="cb41-2"><a href="explore-sparsity.html#cb41-2"></a>   <span class="kw">min</span>(<span class="kw">which</span>(specificity <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.9</span>)))</span>
<span id="cb41-3"><a href="explore-sparsity.html#cb41-3"></a></span>
<span id="cb41-4"><a href="explore-sparsity.html#cb41-4"></a> lassoR_ndx &lt;-<span class="st"> </span><span class="kw">with</span>(<span class="kw">as.data.frame</span>(pROC<span class="op">::</span><span class="kw">coords</span>(train_lassoR_roc, <span class="dt">transpose=</span>F)), </span>
<span id="cb41-5"><a href="explore-sparsity.html#cb41-5"></a>   <span class="kw">min</span>(<span class="kw">which</span>(specificity <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.9</span>)))</span>
<span id="cb41-6"><a href="explore-sparsity.html#cb41-6"></a></span>
<span id="cb41-7"><a href="explore-sparsity.html#cb41-7"></a> blended_ndx &lt;-<span class="st"> </span><span class="kw">with</span>(<span class="kw">as.data.frame</span>(pROC<span class="op">::</span><span class="kw">coords</span>(train_blended_roc, <span class="dt">transpose=</span>F)), </span>
<span id="cb41-8"><a href="explore-sparsity.html#cb41-8"></a>   <span class="kw">min</span>(<span class="kw">which</span>(specificity <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.9</span>)))</span>
<span id="cb41-9"><a href="explore-sparsity.html#cb41-9"></a></span>
<span id="cb41-10"><a href="explore-sparsity.html#cb41-10"></a>  spec90_frm &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">rbind</span>(</span>
<span id="cb41-11"><a href="explore-sparsity.html#cb41-11"></a>  <span class="dt">lasso=</span><span class="kw">as.data.frame</span>(pROC<span class="op">::</span><span class="kw">coords</span>(train_lasso_roc, <span class="dt">transpose=</span>F))[lasso_ndx,],</span>
<span id="cb41-12"><a href="explore-sparsity.html#cb41-12"></a>  <span class="dt">lassoR=</span><span class="kw">as.data.frame</span>(pROC<span class="op">::</span><span class="kw">coords</span>(train_lassoR_roc, <span class="dt">transpose=</span>F))[lassoR_ndx,],</span>
<span id="cb41-13"><a href="explore-sparsity.html#cb41-13"></a>  <span class="dt">blended=</span><span class="kw">as.data.frame</span>(pROC<span class="op">::</span><span class="kw">coords</span>(train_blended_roc, <span class="dt">transpose=</span>F))[blended_ndx,]</span>
<span id="cb41-14"><a href="explore-sparsity.html#cb41-14"></a> ))</span>
<span id="cb41-15"><a href="explore-sparsity.html#cb41-15"></a></span>
<span id="cb41-16"><a href="explore-sparsity.html#cb41-16"></a></span>
<span id="cb41-17"><a href="explore-sparsity.html#cb41-17"></a>knitr<span class="op">::</span><span class="kw">kable</span>(spec90_frm,</span>
<span id="cb41-18"><a href="explore-sparsity.html#cb41-18"></a>  <span class="dt">digits=</span><span class="dv">3</span>,</span>
<span id="cb41-19"><a href="explore-sparsity.html#cb41-19"></a>  <span class="dt">caption=</span><span class="st">&quot;Specificity = .90 Coordinates&quot;</span></span>
<span id="cb41-20"><a href="explore-sparsity.html#cb41-20"></a>) <span class="op">%&gt;%</span></span>
<span id="cb41-21"><a href="explore-sparsity.html#cb41-21"></a><span class="st">  </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F)</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:thresh90">Table 4.5: </span>Specificity = .90 Coordinates
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
threshold
</th>
<th style="text-align:right;">
specificity
</th>
<th style="text-align:right;">
sensitivity
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
lasso
</td>
<td style="text-align:right;">
0.337
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:right;">
0.932
</td>
</tr>
<tr>
<td style="text-align:left;">
lassoR
</td>
<td style="text-align:right;">
0.003
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:right;">
0.894
</td>
</tr>
<tr>
<td style="text-align:left;">
blended
</td>
<td style="text-align:right;">
0.031
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:right;">
0.899
</td>
</tr>
</tbody>
</table>
<p>This is strange.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="explore-sparsity.html#cb42-1"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb42-2"><a href="explore-sparsity.html#cb42-2"></a></span>
<span id="cb42-3"><a href="explore-sparsity.html#cb42-3"></a><span class="co"># lasso</span></span>
<span id="cb42-4"><a href="explore-sparsity.html#cb42-4"></a><span class="kw">plot</span>(<span class="kw">density</span>(train_lasso_oofProb_vec[train_group_vec<span class="op">==</span><span class="st">&#39;Control&#39;</span>]),</span>
<span id="cb42-5"><a href="explore-sparsity.html#cb42-5"></a> <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">main=</span><span class="st">&#39;&#39;</span>, <span class="dt">xlab=</span><span class="st">&#39;&#39;</span>, <span class="dt">col=</span><span class="st">&#39;green&#39;</span>)</span>
<span id="cb42-6"><a href="explore-sparsity.html#cb42-6"></a><span class="kw">lines</span>(<span class="kw">density</span>(train_lasso_oofProb_vec[train_group_vec<span class="op">==</span><span class="st">&#39;HCC&#39;</span>]),</span>
<span id="cb42-7"><a href="explore-sparsity.html#cb42-7"></a>   <span class="dt">co=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb42-8"><a href="explore-sparsity.html#cb42-8"></a><span class="kw">title</span>(<span class="st">&quot;lasso&quot;</span>)</span>
<span id="cb42-9"><a href="explore-sparsity.html#cb42-9"></a></span>
<span id="cb42-10"><a href="explore-sparsity.html#cb42-10"></a><span class="co"># lassoR</span></span>
<span id="cb42-11"><a href="explore-sparsity.html#cb42-11"></a><span class="kw">plot</span>(<span class="kw">density</span>(train_lassoR_oofProb_vec[train_group_vec<span class="op">==</span><span class="st">&#39;Control&#39;</span>]),</span>
<span id="cb42-12"><a href="explore-sparsity.html#cb42-12"></a> <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">main=</span><span class="st">&#39;&#39;</span>, <span class="dt">xlab=</span><span class="st">&#39;&#39;</span>, <span class="dt">col=</span><span class="st">&#39;green&#39;</span>)</span>
<span id="cb42-13"><a href="explore-sparsity.html#cb42-13"></a><span class="kw">lines</span>(<span class="kw">density</span>(train_lassoR_oofProb_vec[train_group_vec<span class="op">==</span><span class="st">&#39;HCC&#39;</span>]),</span>
<span id="cb42-14"><a href="explore-sparsity.html#cb42-14"></a>   <span class="dt">co=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb42-15"><a href="explore-sparsity.html#cb42-15"></a><span class="kw">title</span>(<span class="st">&quot;lassoR&quot;</span>)</span>
<span id="cb42-16"><a href="explore-sparsity.html#cb42-16"></a></span>
<span id="cb42-17"><a href="explore-sparsity.html#cb42-17"></a><span class="kw">sapply</span>(<span class="kw">split</span>(train_lassoR_oofProb_vec,train_group_vec), summary)</span></code></pre></div>
<pre><code>##              Control          HCC
## Min.    1.328376e-69 3.337696e-41
## 1st Qu. 6.241943e-28 1.000000e+00
## Median  8.812711e-19 1.000000e+00
## Mean    7.668147e-02 8.481142e-01
## 3rd Qu. 4.672541e-10 1.000000e+00
## Max.    1.000000e+00 1.000000e+00</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="explore-sparsity.html#cb44-1"></a><span class="co"># blended</span></span>
<span id="cb44-2"><a href="explore-sparsity.html#cb44-2"></a><span class="kw">plot</span>(<span class="kw">density</span>(train_blended_oofProb_vec[train_group_vec<span class="op">==</span><span class="st">&#39;Control&#39;</span>]),</span>
<span id="cb44-3"><a href="explore-sparsity.html#cb44-3"></a> <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">main=</span><span class="st">&#39;&#39;</span>, <span class="dt">xlab=</span><span class="st">&#39;&#39;</span>, <span class="dt">col=</span><span class="st">&#39;green&#39;</span>)</span>
<span id="cb44-4"><a href="explore-sparsity.html#cb44-4"></a><span class="kw">lines</span>(<span class="kw">density</span>(train_blended_oofProb_vec[train_group_vec<span class="op">==</span><span class="st">&#39;HCC&#39;</span>]),</span>
<span id="cb44-5"><a href="explore-sparsity.html#cb44-5"></a>   <span class="dt">co=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb44-6"><a href="explore-sparsity.html#cb44-6"></a><span class="kw">title</span>(<span class="st">&quot;blended&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:trainOOFprops"></span>
<img src="Static/figures/trainOOFprops-1.png" alt="Train data out-of-fold predicted probabilities" width="960" />
<p class="caption">
Figure 4.4: Train data out-of-fold predicted probabilities
</p>
</div>
<p>This makes no sense.</p>
<p>Look at test data ROC.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="explore-sparsity.html#cb45-1"></a><span class="co"># train</span></span>
<span id="cb45-2"><a href="explore-sparsity.html#cb45-2"></a><span class="co"># lasso</span></span>
<span id="cb45-3"><a href="explore-sparsity.html#cb45-3"></a>test_lasso_oofProb_vec &lt;-<span class="st"> </span><span class="kw">predict</span>(</span>
<span id="cb45-4"><a href="explore-sparsity.html#cb45-4"></a> cv_lasso,</span>
<span id="cb45-5"><a href="explore-sparsity.html#cb45-5"></a> <span class="dt">type=</span><span class="st">&#39;resp&#39;</span>,</span>
<span id="cb45-6"><a href="explore-sparsity.html#cb45-6"></a> <span class="dt">lambda=</span><span class="st">&#39;1se&#39;</span>,</span>
<span id="cb45-7"><a href="explore-sparsity.html#cb45-7"></a> <span class="dt">newx=</span>test_lcpm_mtx</span>
<span id="cb45-8"><a href="explore-sparsity.html#cb45-8"></a>)</span>
<span id="cb45-9"><a href="explore-sparsity.html#cb45-9"></a></span>
<span id="cb45-10"><a href="explore-sparsity.html#cb45-10"></a>test_lasso_roc &lt;-<span class="st"> </span>pROC<span class="op">::</span><span class="kw">roc</span>(</span>
<span id="cb45-11"><a href="explore-sparsity.html#cb45-11"></a> <span class="dt">response =</span> <span class="kw">as.numeric</span>(test_group_vec<span class="op">==</span><span class="st">&#39;HCC&#39;</span>),</span>
<span id="cb45-12"><a href="explore-sparsity.html#cb45-12"></a> <span class="dt">predictor =</span> test_lasso_oofProb_vec)</span></code></pre></div>
<pre><code>## Setting levels: control = 0, case = 1</code></pre>
<pre><code>## Warning in roc.default(response = as.numeric(test_group_vec == &quot;HCC&quot;), predictor
## = test_lasso_oofProb_vec): Deprecated use a matrix as predictor. Unexpected
## results may be produced, please pass a numeric vector.</code></pre>
<pre><code>## Setting direction: controls &lt; cases</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="explore-sparsity.html#cb49-1"></a><span class="co"># lassoR</span></span>
<span id="cb49-2"><a href="explore-sparsity.html#cb49-2"></a>test_lassoR_oofProb_vec &lt;-<span class="st"> </span><span class="kw">predict</span>(</span>
<span id="cb49-3"><a href="explore-sparsity.html#cb49-3"></a> cv_lassoR,</span>
<span id="cb49-4"><a href="explore-sparsity.html#cb49-4"></a> <span class="dt">type=</span><span class="st">&#39;resp&#39;</span>,</span>
<span id="cb49-5"><a href="explore-sparsity.html#cb49-5"></a> <span class="dt">lambda=</span><span class="st">&#39;1se&#39;</span>,</span>
<span id="cb49-6"><a href="explore-sparsity.html#cb49-6"></a> <span class="dt">newx=</span>test_lcpm_mtx,</span>
<span id="cb49-7"><a href="explore-sparsity.html#cb49-7"></a> <span class="dt">gamma=</span><span class="dv">0</span>,</span>
<span id="cb49-8"><a href="explore-sparsity.html#cb49-8"></a>)</span>
<span id="cb49-9"><a href="explore-sparsity.html#cb49-9"></a></span>
<span id="cb49-10"><a href="explore-sparsity.html#cb49-10"></a>test_lassoR_roc &lt;-<span class="st"> </span>pROC<span class="op">::</span><span class="kw">roc</span>(</span>
<span id="cb49-11"><a href="explore-sparsity.html#cb49-11"></a> <span class="dt">response =</span> <span class="kw">as.numeric</span>(test_group_vec<span class="op">==</span><span class="st">&#39;HCC&#39;</span>),</span>
<span id="cb49-12"><a href="explore-sparsity.html#cb49-12"></a> <span class="dt">predictor =</span> test_lassoR_oofProb_vec)</span></code></pre></div>
<pre><code>## Setting levels: control = 0, case = 1</code></pre>
<pre><code>## Warning in roc.default(response = as.numeric(test_group_vec == &quot;HCC&quot;), predictor
## = test_lassoR_oofProb_vec): Deprecated use a matrix as predictor. Unexpected
## results may be produced, please pass a numeric vector.</code></pre>
<pre><code>## Setting direction: controls &lt; cases</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="explore-sparsity.html#cb53-1"></a><span class="co"># blended mix (gamma=0.5)</span></span>
<span id="cb53-2"><a href="explore-sparsity.html#cb53-2"></a>test_blended_oofProb_vec &lt;-<span class="st"> </span><span class="kw">predict</span>(</span>
<span id="cb53-3"><a href="explore-sparsity.html#cb53-3"></a> cv_lassoR,</span>
<span id="cb53-4"><a href="explore-sparsity.html#cb53-4"></a> <span class="dt">type=</span><span class="st">&#39;resp&#39;</span>,</span>
<span id="cb53-5"><a href="explore-sparsity.html#cb53-5"></a> <span class="dt">lambda=</span><span class="st">&#39;1se&#39;</span>,</span>
<span id="cb53-6"><a href="explore-sparsity.html#cb53-6"></a> <span class="dt">newx=</span>test_lcpm_mtx,</span>
<span id="cb53-7"><a href="explore-sparsity.html#cb53-7"></a> <span class="dt">gamma=</span><span class="fl">0.5</span>,</span>
<span id="cb53-8"><a href="explore-sparsity.html#cb53-8"></a>)</span>
<span id="cb53-9"><a href="explore-sparsity.html#cb53-9"></a></span>
<span id="cb53-10"><a href="explore-sparsity.html#cb53-10"></a>test_blended_roc &lt;-<span class="st"> </span>pROC<span class="op">::</span><span class="kw">roc</span>(</span>
<span id="cb53-11"><a href="explore-sparsity.html#cb53-11"></a> <span class="dt">response =</span> <span class="kw">as.numeric</span>(test_group_vec<span class="op">==</span><span class="st">&#39;HCC&#39;</span>),</span>
<span id="cb53-12"><a href="explore-sparsity.html#cb53-12"></a> <span class="dt">predictor =</span> test_blended_oofProb_vec)</span></code></pre></div>
<pre><code>## Setting levels: control = 0, case = 1</code></pre>
<pre><code>## Warning in roc.default(response = as.numeric(test_group_vec == &quot;HCC&quot;), predictor
## = test_blended_oofProb_vec): Deprecated use a matrix as predictor. Unexpected
## results may be produced, please pass a numeric vector.</code></pre>
<pre><code>## Setting direction: controls &lt; cases</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="explore-sparsity.html#cb57-1"></a><span class="kw">plot</span>(test_lasso_roc)</span>
<span id="cb57-2"><a href="explore-sparsity.html#cb57-2"></a><span class="kw">lines</span>(test_lassoR_roc, <span class="dt">col=</span><span class="st">&#39;blue&#39;</span>)</span>
<span id="cb57-3"><a href="explore-sparsity.html#cb57-3"></a><span class="kw">lines</span>(test_blended_roc, <span class="dt">col=</span><span class="st">&#39;green&#39;</span>)</span>
<span id="cb57-4"><a href="explore-sparsity.html#cb57-4"></a></span>
<span id="cb57-5"><a href="explore-sparsity.html#cb57-5"></a><span class="kw">legend</span>(<span class="st">&#39;bottomright&#39;</span>, <span class="dt">title=</span><span class="st">&#39;AUC&#39;</span>,</span>
<span id="cb57-6"><a href="explore-sparsity.html#cb57-6"></a> <span class="dt">legend=</span><span class="kw">c</span>(</span>
<span id="cb57-7"><a href="explore-sparsity.html#cb57-7"></a>  <span class="kw">paste</span>(<span class="st">&#39;lasso =&#39;</span>, <span class="kw">round</span>(test_lasso_roc[[<span class="st">&#39;auc&#39;</span>]],<span class="dv">3</span>)),</span>
<span id="cb57-8"><a href="explore-sparsity.html#cb57-8"></a>  <span class="kw">paste</span>(<span class="st">&#39;lassoR =&#39;</span>, <span class="kw">round</span>(test_lassoR_roc[[<span class="st">&#39;auc&#39;</span>]],<span class="dv">3</span>)),</span>
<span id="cb57-9"><a href="explore-sparsity.html#cb57-9"></a>  <span class="kw">paste</span>(<span class="st">&#39;blended =&#39;</span>, <span class="kw">round</span>(test_blended_roc[[<span class="st">&#39;auc&#39;</span>]],<span class="dv">3</span>))</span>
<span id="cb57-10"><a href="explore-sparsity.html#cb57-10"></a> ),</span>
<span id="cb57-11"><a href="explore-sparsity.html#cb57-11"></a> <span class="dt">text.col =</span> <span class="kw">c</span>(<span class="st">&#39;black&#39;</span>, <span class="st">&#39;blue&#39;</span>, <span class="st">&#39;green&#39;</span>))</span></code></pre></div>
<div class="figure"><span id="fig:testROC"></span>
<img src="Static/figures/testROC-1.png" alt="Test data out-of-sample ROCs" width="480" />
<p class="caption">
Figure 4.5: Test data out-of-sample ROCs
</p>
</div>
<p>Look at desnities of predicted probabilities.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="explore-sparsity.html#cb58-1"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb58-2"><a href="explore-sparsity.html#cb58-2"></a></span>
<span id="cb58-3"><a href="explore-sparsity.html#cb58-3"></a><span class="co"># lasso</span></span>
<span id="cb58-4"><a href="explore-sparsity.html#cb58-4"></a><span class="kw">plot</span>(<span class="kw">density</span>(test_lasso_oofProb_vec[test_group_vec<span class="op">==</span><span class="st">&#39;Control&#39;</span>]),</span>
<span id="cb58-5"><a href="explore-sparsity.html#cb58-5"></a> <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">main=</span><span class="st">&#39;&#39;</span>, <span class="dt">xlab=</span><span class="st">&#39;&#39;</span>, <span class="dt">col=</span><span class="st">&#39;green&#39;</span>)</span>
<span id="cb58-6"><a href="explore-sparsity.html#cb58-6"></a><span class="kw">lines</span>(<span class="kw">density</span>(test_lasso_oofProb_vec[test_group_vec<span class="op">==</span><span class="st">&#39;HCC&#39;</span>]),</span>
<span id="cb58-7"><a href="explore-sparsity.html#cb58-7"></a>   <span class="dt">co=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb58-8"><a href="explore-sparsity.html#cb58-8"></a><span class="kw">title</span>(<span class="st">&quot;lasso&quot;</span>)</span>
<span id="cb58-9"><a href="explore-sparsity.html#cb58-9"></a></span>
<span id="cb58-10"><a href="explore-sparsity.html#cb58-10"></a><span class="co"># lassoR</span></span>
<span id="cb58-11"><a href="explore-sparsity.html#cb58-11"></a><span class="kw">plot</span>(<span class="kw">density</span>(test_lassoR_oofProb_vec[test_group_vec<span class="op">==</span><span class="st">&#39;Control&#39;</span>]),</span>
<span id="cb58-12"><a href="explore-sparsity.html#cb58-12"></a> <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">main=</span><span class="st">&#39;&#39;</span>, <span class="dt">xlab=</span><span class="st">&#39;&#39;</span>, <span class="dt">col=</span><span class="st">&#39;green&#39;</span>)</span>
<span id="cb58-13"><a href="explore-sparsity.html#cb58-13"></a><span class="kw">lines</span>(<span class="kw">density</span>(test_lassoR_oofProb_vec[test_group_vec<span class="op">==</span><span class="st">&#39;HCC&#39;</span>]),</span>
<span id="cb58-14"><a href="explore-sparsity.html#cb58-14"></a>   <span class="dt">co=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb58-15"><a href="explore-sparsity.html#cb58-15"></a><span class="kw">title</span>(<span class="st">&quot;lassoR&quot;</span>)</span>
<span id="cb58-16"><a href="explore-sparsity.html#cb58-16"></a></span>
<span id="cb58-17"><a href="explore-sparsity.html#cb58-17"></a><span class="kw">sapply</span>(<span class="kw">split</span>(test_lassoR_oofProb_vec,test_group_vec), summary)</span></code></pre></div>
<pre><code>##              Control          HCC
## Min.    2.352635e-09 4.183949e-05
## 1st Qu. 4.850862e-04 8.373417e-01
## Median  3.050687e-03 9.925541e-01
## Mean    9.277576e-02 8.424789e-01
## 3rd Qu. 3.704167e-02 9.999439e-01
## Max.    9.999883e-01 1.000000e+00</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="explore-sparsity.html#cb60-1"></a><span class="co"># blended</span></span>
<span id="cb60-2"><a href="explore-sparsity.html#cb60-2"></a><span class="kw">plot</span>(<span class="kw">density</span>(test_blended_oofProb_vec[test_group_vec<span class="op">==</span><span class="st">&#39;Control&#39;</span>]),</span>
<span id="cb60-3"><a href="explore-sparsity.html#cb60-3"></a> <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">main=</span><span class="st">&#39;&#39;</span>, <span class="dt">xlab=</span><span class="st">&#39;&#39;</span>, <span class="dt">col=</span><span class="st">&#39;green&#39;</span>)</span>
<span id="cb60-4"><a href="explore-sparsity.html#cb60-4"></a><span class="kw">lines</span>(<span class="kw">density</span>(test_blended_oofProb_vec[test_group_vec<span class="op">==</span><span class="st">&#39;HCC&#39;</span>]),</span>
<span id="cb60-5"><a href="explore-sparsity.html#cb60-5"></a>   <span class="dt">co=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb60-6"><a href="explore-sparsity.html#cb60-6"></a><span class="kw">title</span>(<span class="st">&quot;blended&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:testOOFprops"></span>
<img src="Static/figures/testOOFprops-1.png" alt="Test data out-of-fold predicted probabilities" width="960" />
<p class="caption">
Figure 4.6: Test data out-of-fold predicted probabilities
</p>
</div>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="explore-sparsity.html#cb61-1"></a><span class="co"># Train - preval is out-of-fold linear predictor for training design points</span></span>
<span id="cb61-2"><a href="explore-sparsity.html#cb61-2"></a>onese_ndx &lt;-<span class="st"> </span><span class="kw">match</span>(cv_lasso<span class="op">$</span>lambda<span class="fl">.1</span>se,cv_lasso<span class="op">$</span>lambda)</span>
<span id="cb61-3"><a href="explore-sparsity.html#cb61-3"></a>train_1se_preval_vec &lt;-<span class="st"> </span>cv_lasso<span class="op">$</span>fit.preval[,onese_ndx]</span>
<span id="cb61-4"><a href="explore-sparsity.html#cb61-4"></a>train_1se_predProb_vec &lt;-<span class="st"> </span><span class="kw">logistic_f</span>(train_1se_preval_vec)</span>
<span id="cb61-5"><a href="explore-sparsity.html#cb61-5"></a></span>
<span id="cb61-6"><a href="explore-sparsity.html#cb61-6"></a><span class="co">#Test</span></span>
<span id="cb61-7"><a href="explore-sparsity.html#cb61-7"></a>test_1se_predProb_vec &lt;-<span class="st"> </span><span class="kw">predict</span>(</span>
<span id="cb61-8"><a href="explore-sparsity.html#cb61-8"></a> cv_lasso, </span>
<span id="cb61-9"><a href="explore-sparsity.html#cb61-9"></a> <span class="dt">newx=</span>test_lcpm_mtx,</span>
<span id="cb61-10"><a href="explore-sparsity.html#cb61-10"></a> <span class="dt">s=</span><span class="st">&quot;lambda.1se&quot;</span>,</span>
<span id="cb61-11"><a href="explore-sparsity.html#cb61-11"></a> <span class="dt">type=</span><span class="st">&#39;resp&#39;</span></span>
<span id="cb61-12"><a href="explore-sparsity.html#cb61-12"></a>)</span>
<span id="cb61-13"><a href="explore-sparsity.html#cb61-13"></a></span>
<span id="cb61-14"><a href="explore-sparsity.html#cb61-14"></a>tmp &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb61-15"><a href="explore-sparsity.html#cb61-15"></a> <span class="dt">train=</span><span class="kw">split</span>(train_1se_predProb_vec, train_group_vec),</span>
<span id="cb61-16"><a href="explore-sparsity.html#cb61-16"></a> <span class="dt">test=</span><span class="kw">split</span>(test_1se_predProb_vec, test_group_vec))</span>
<span id="cb61-17"><a href="explore-sparsity.html#cb61-17"></a><span class="kw">names</span>(tmp) &lt;-<span class="st"> </span><span class="kw">sub</span>(<span class="st">&#39;</span><span class="ch">\\</span><span class="st">.&#39;</span>,<span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span>,<span class="kw">names</span>(tmp))</span>
<span id="cb61-18"><a href="explore-sparsity.html#cb61-18"></a></span>
<span id="cb61-19"><a href="explore-sparsity.html#cb61-19"></a></span>
<span id="cb61-20"><a href="explore-sparsity.html#cb61-20"></a><span class="kw">boxplot</span>(tmp)</span></code></pre></div>
<div class="figure"><span id="fig:fitPrevalByGroup"></span>
<img src="Static/figures/fitPrevalByGroup-1.png" alt="Predicted Probabilities - Train and Test" width="768" />
<p class="caption">
Figure 4.7: Predicted Probabilities - Train and Test
</p>
</div>
<!--
Another look - plot train and test set logitstic curves with annotation.

The following shows that predcited classes come from fitted
probabilities - not out of sample probabilities.
Also shows that threshold is at 0.5 

-->
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:confMtxTrainLasso">Table 4.6: </span>cv lasso confusion matrix: train set
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Control
</th>
<th style="text-align:right;">
HCC
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Control
</td>
<td style="text-align:right;">
615
</td>
<td style="text-align:right;">
31
</td>
</tr>
<tr>
<td style="text-align:left;">
HCC
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
413
</td>
</tr>
</tbody>
</table>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:confMtxTrainLassoR">Table 4.7: </span>cv lassoR confusion matrix: train set
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Control
</th>
<th style="text-align:right;">
HCC
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Control
</td>
<td style="text-align:right;">
607
</td>
<td style="text-align:right;">
34
</td>
</tr>
<tr>
<td style="text-align:left;">
HCC
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
410
</td>
</tr>
</tbody>
</table>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:confMtxTestLasso">Table 4.8: </span>cv lasso confusion matrix: test set
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Control
</th>
<th style="text-align:right;">
HCC
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Control
</td>
<td style="text-align:right;">
148
</td>
<td style="text-align:right;">
22
</td>
</tr>
<tr>
<td style="text-align:left;">
HCC
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
89
</td>
</tr>
</tbody>
</table>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:confMtxTestlassoR">Table 4.9: </span>cv lassoR confusion matrix: test set
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Control
</th>
<th style="text-align:right;">
HCC
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Control
</td>
<td style="text-align:right;">
146
</td>
<td style="text-align:right;">
17
</td>
</tr>
<tr>
<td style="text-align:left;">
HCC
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
94
</td>
</tr>
</tbody>
</table>

</div>
</div>
<div id="refit-with-auc-as-optimization" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Refit with “auc” as optimization</h2>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="explore-sparsity.html#cb62-1"></a>start_time &lt;-<span class="st">  </span><span class="kw">proc.time</span>()</span>
<span id="cb62-2"><a href="explore-sparsity.html#cb62-2"></a></span>
<span id="cb62-3"><a href="explore-sparsity.html#cb62-3"></a>cv_lasso2 &lt;-<span class="st"> </span>glmnet<span class="op">::</span><span class="kw">cv.glmnet</span>(</span>
<span id="cb62-4"><a href="explore-sparsity.html#cb62-4"></a> <span class="dt">x=</span>train_lcpm_mtx,</span>
<span id="cb62-5"><a href="explore-sparsity.html#cb62-5"></a> <span class="dt">y=</span>train_group_vec,</span>
<span id="cb62-6"><a href="explore-sparsity.html#cb62-6"></a> <span class="dt">foldid=</span>train_foldid_vec,</span>
<span id="cb62-7"><a href="explore-sparsity.html#cb62-7"></a> <span class="dt">alpha=</span><span class="dv">1</span>,</span>
<span id="cb62-8"><a href="explore-sparsity.html#cb62-8"></a> <span class="dt">family=</span><span class="st">&#39;binomial&#39;</span>, </span>
<span id="cb62-9"><a href="explore-sparsity.html#cb62-9"></a> <span class="dt">type.measure =</span> <span class="st">&quot;auc&quot;</span>)</span>
<span id="cb62-10"><a href="explore-sparsity.html#cb62-10"></a></span>
<span id="cb62-11"><a href="explore-sparsity.html#cb62-11"></a><span class="kw">message</span>(<span class="st">&quot;lasso time: &quot;</span>, <span class="kw">round</span>((<span class="kw">proc.time</span>() <span class="op">-</span><span class="st"> </span>start_time)[<span class="dv">3</span>],<span class="dv">2</span>),<span class="st">&quot;s&quot;</span>)</span></code></pre></div>
<pre><code>## lasso time: 23.89s</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="explore-sparsity.html#cb64-1"></a>start_time &lt;-<span class="st">  </span><span class="kw">proc.time</span>()</span>
<span id="cb64-2"><a href="explore-sparsity.html#cb64-2"></a></span>
<span id="cb64-3"><a href="explore-sparsity.html#cb64-3"></a>cv_ridge2 &lt;-<span class="st"> </span>glmnet<span class="op">::</span><span class="kw">cv.glmnet</span>(</span>
<span id="cb64-4"><a href="explore-sparsity.html#cb64-4"></a> <span class="dt">x=</span>train_lcpm_mtx,</span>
<span id="cb64-5"><a href="explore-sparsity.html#cb64-5"></a> <span class="dt">y=</span>train_group_vec,</span>
<span id="cb64-6"><a href="explore-sparsity.html#cb64-6"></a> <span class="dt">foldid=</span>train_foldid_vec,</span>
<span id="cb64-7"><a href="explore-sparsity.html#cb64-7"></a> <span class="dt">alpha=</span><span class="dv">0</span>,</span>
<span id="cb64-8"><a href="explore-sparsity.html#cb64-8"></a> <span class="dt">family=</span><span class="st">&#39;binomial&#39;</span>, </span>
<span id="cb64-9"><a href="explore-sparsity.html#cb64-9"></a> <span class="dt">type.measure =</span> <span class="st">&quot;auc&quot;</span>)</span>
<span id="cb64-10"><a href="explore-sparsity.html#cb64-10"></a></span>
<span id="cb64-11"><a href="explore-sparsity.html#cb64-11"></a><span class="kw">message</span>(<span class="st">&quot;ridge time: &quot;</span>, <span class="kw">round</span>((<span class="kw">proc.time</span>() <span class="op">-</span><span class="st"> </span>start_time)[<span class="dv">3</span>],<span class="dv">2</span>),<span class="st">&quot;s&quot;</span>)</span></code></pre></div>
<pre><code>## ridge time: 266.7s</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="explore-sparsity.html#cb66-1"></a>start_time &lt;-<span class="st">  </span><span class="kw">proc.time</span>()</span>
<span id="cb66-2"><a href="explore-sparsity.html#cb66-2"></a></span>
<span id="cb66-3"><a href="explore-sparsity.html#cb66-3"></a>cv_enet2 &lt;-<span class="st"> </span>glmnet<span class="op">::</span><span class="kw">cv.glmnet</span>(</span>
<span id="cb66-4"><a href="explore-sparsity.html#cb66-4"></a> <span class="dt">x=</span>train_lcpm_mtx,</span>
<span id="cb66-5"><a href="explore-sparsity.html#cb66-5"></a> <span class="dt">y=</span>train_group_vec,</span>
<span id="cb66-6"><a href="explore-sparsity.html#cb66-6"></a> <span class="dt">foldid=</span>train_foldid_vec,</span>
<span id="cb66-7"><a href="explore-sparsity.html#cb66-7"></a> <span class="dt">alpha=</span><span class="fl">0.5</span>,</span>
<span id="cb66-8"><a href="explore-sparsity.html#cb66-8"></a> <span class="dt">family=</span><span class="st">&#39;binomial&#39;</span>,</span>
<span id="cb66-9"><a href="explore-sparsity.html#cb66-9"></a> <span class="dt">type.measure =</span> <span class="st">&quot;auc&quot;</span>)</span>
<span id="cb66-10"><a href="explore-sparsity.html#cb66-10"></a></span>
<span id="cb66-11"><a href="explore-sparsity.html#cb66-11"></a><span class="kw">message</span>(<span class="st">&quot;enet time: &quot;</span>, <span class="kw">round</span>((<span class="kw">proc.time</span>() <span class="op">-</span><span class="st"> </span>start_time)[<span class="dv">3</span>],<span class="dv">2</span>),<span class="st">&quot;s&quot;</span>)</span></code></pre></div>
<pre><code>## enet time: 23.54s</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="explore-sparsity.html#cb68-1"></a>start_time &lt;-<span class="st">  </span><span class="kw">proc.time</span>()</span>
<span id="cb68-2"><a href="explore-sparsity.html#cb68-2"></a></span>
<span id="cb68-3"><a href="explore-sparsity.html#cb68-3"></a>cv_lassoC2 &lt;-<span class="st">  </span>glmnet<span class="op">::</span><span class="kw">cv.glmnet</span>(</span>
<span id="cb68-4"><a href="explore-sparsity.html#cb68-4"></a> <span class="dt">x=</span>train_lcpm_mtx,</span>
<span id="cb68-5"><a href="explore-sparsity.html#cb68-5"></a> <span class="dt">y=</span>train_group_vec,</span>
<span id="cb68-6"><a href="explore-sparsity.html#cb68-6"></a> <span class="dt">foldid=</span>train_foldid_vec,</span>
<span id="cb68-7"><a href="explore-sparsity.html#cb68-7"></a> <span class="dt">alpha=</span><span class="dv">1</span><span class="op">-</span>EPS,</span>
<span id="cb68-8"><a href="explore-sparsity.html#cb68-8"></a> <span class="dt">family=</span><span class="st">&#39;binomial&#39;</span>,</span>
<span id="cb68-9"><a href="explore-sparsity.html#cb68-9"></a> <span class="dt">type.measure =</span> <span class="st">&quot;class&quot;</span>)</span>
<span id="cb68-10"><a href="explore-sparsity.html#cb68-10"></a></span>
<span id="cb68-11"><a href="explore-sparsity.html#cb68-11"></a><span class="kw">message</span>(<span class="st">&quot;lassoC time: &quot;</span>, <span class="kw">round</span>((<span class="kw">proc.time</span>() <span class="op">-</span><span class="st"> </span>start_time)[<span class="dv">3</span>],<span class="dv">2</span>),<span class="st">&quot;s&quot;</span>)</span></code></pre></div>
<pre><code>## lassoC time: 21.92s</code></pre>
<p>The ridge regression model takes over 10 times longer to compute.</p>
<!-- do not show
Define plotting function.
Maybe show in appendix??
-->
<p>Examine model performance.</p>
<pre><code>## Setting levels: control = Control, case = HCC</code></pre>
<pre><code>## Setting direction: controls &lt; cases</code></pre>
<pre><code>## Setting levels: control = Control, case = HCC</code></pre>
<pre><code>## Setting direction: controls &lt; cases</code></pre>
<pre><code>## Setting levels: control = Control, case = HCC</code></pre>
<pre><code>## Setting direction: controls &lt; cases</code></pre>
<pre><code>## Setting levels: control = Control, case = HCC</code></pre>
<pre><code>## Setting direction: controls &lt; cases</code></pre>
<pre><code>## Setting levels: control = Control, case = HCC</code></pre>
<pre><code>## Setting direction: controls &lt; cases</code></pre>
<pre><code>## Setting levels: control = Control, case = HCC</code></pre>
<pre><code>## Setting direction: controls &lt; cases</code></pre>
<div class="figure"><span id="fig:lookFits2"></span>
<img src="Static/figures/lookFits2-1.png" alt="compare fits" width="1056" />
<p class="caption">
Figure 4.8: compare fits
</p>
</div>
<p>All models produce cv assessments of Misclassification Error that are slightly better than
the test set assessments. <code>lasso</code> performs comparably to <code>enet</code> and
better than the <code>ridge</code> model.</p>
</div>
<div id="relaxed-lasso-and-blended-mix-1" class="section level2" number="4.6">
<h2><span class="header-section-number">4.6</span> Relaxed lasso and blended mix</h2>
<!--
The relaxed fit takes quite a bit longer.  
-->
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="explore-sparsity.html#cb82-1"></a> <span class="kw">library</span>(glmnet)</span>
<span id="cb82-2"><a href="explore-sparsity.html#cb82-2"></a></span>
<span id="cb82-3"><a href="explore-sparsity.html#cb82-3"></a> cv_lassoR2_sum &lt;-<span class="st"> </span><span class="kw">print</span>(cv_lassoR2)</span></code></pre></div>
<pre><code>## 
## Call:  glmnet::cv.glmnet(x = train_lcpm_mtx, y = train_group_vec, type.measure = &quot;auc&quot;,      foldid = train_foldid_vec, relax = T, alpha = 1, family = &quot;binomial&quot;) 
## 
## Measure: AUC 
## 
##     Gamma  Lambda Measure       SE Nonzero
## min  0.25 0.04153  0.9765 0.003813      32
## 1se  0.50 0.04558  0.9729 0.003849      31</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="explore-sparsity.html#cb84-1"></a> <span class="kw">plot</span>(cv_lassoR2)</span></code></pre></div>
<div class="figure"><span id="fig:lookLassoR2"></span>
<img src="Static/figures/lookLassoR2-1.png" alt="lassoR fit" width="480" />
<p class="caption">
Figure 4.9: lassoR fit
</p>
</div>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="explore-sparsity.html#cb85-1"></a>test_pred_1se_vec &lt;-<span class="st"> </span><span class="kw">predict</span>(</span>
<span id="cb85-2"><a href="explore-sparsity.html#cb85-2"></a>  cv_lassoR2, </span>
<span id="cb85-3"><a href="explore-sparsity.html#cb85-3"></a>  <span class="dt">newx=</span>test_lcpm_mtx, </span>
<span id="cb85-4"><a href="explore-sparsity.html#cb85-4"></a>  <span class="dt">s=</span><span class="st">&quot;lambda.1se&quot;</span>,</span>
<span id="cb85-5"><a href="explore-sparsity.html#cb85-5"></a>  <span class="dt">type=</span><span class="st">&quot;response&quot;</span></span>
<span id="cb85-6"><a href="explore-sparsity.html#cb85-6"></a>)</span>
<span id="cb85-7"><a href="explore-sparsity.html#cb85-7"></a>test_pred_1se_auc &lt;-<span class="st"> </span><span class="kw">suppressWarnings</span>(pROC<span class="op">::</span><span class="kw">auc</span>(test_group_vec,test_pred_1se_vec)[<span class="dv">1</span>])</span></code></pre></div>
<pre><code>## Setting levels: control = Control, case = HCC</code></pre>
<pre><code>## Setting direction: controls &lt; cases</code></pre>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="explore-sparsity.html#cb88-1"></a>test_pred_min_vec &lt;-<span class="st"> </span><span class="kw">predict</span>(</span>
<span id="cb88-2"><a href="explore-sparsity.html#cb88-2"></a>  cv_lassoR2, </span>
<span id="cb88-3"><a href="explore-sparsity.html#cb88-3"></a>  <span class="dt">newx=</span>test_lcpm_mtx, </span>
<span id="cb88-4"><a href="explore-sparsity.html#cb88-4"></a>  <span class="dt">s=</span><span class="st">&quot;lambda.min&quot;</span>,</span>
<span id="cb88-5"><a href="explore-sparsity.html#cb88-5"></a>  <span class="dt">type=</span><span class="st">&quot;response&quot;</span></span>
<span id="cb88-6"><a href="explore-sparsity.html#cb88-6"></a>)</span>
<span id="cb88-7"><a href="explore-sparsity.html#cb88-7"></a>test_pred_min_auc &lt;-<span class="st"> </span><span class="kw">suppressWarnings</span>(pROC<span class="op">::</span><span class="kw">auc</span>(test_group_vec,test_pred_min_vec)[<span class="dv">1</span>])</span></code></pre></div>
<pre><code>## Setting levels: control = Control, case = HCC
## Setting direction: controls &lt; cases</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="explore-sparsity.html#cb90-1"></a>cv_lassoR2_1se_auc &lt;-<span class="st"> </span>cv_lassoR2_sum[<span class="st">&#39;1se&#39;</span>,<span class="st">&#39;Measure&#39;</span>]</span>
<span id="cb90-2"><a href="explore-sparsity.html#cb90-2"></a>cv_lassoR2_min_auc &lt;-<span class="st"> </span>cv_lassoR2_sum[<span class="st">&#39;min&#39;</span>,<span class="st">&#39;Measure&#39;</span>]</span>
<span id="cb90-3"><a href="explore-sparsity.html#cb90-3"></a></span>
<span id="cb90-4"><a href="explore-sparsity.html#cb90-4"></a>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">rbind</span>(</span>
<span id="cb90-5"><a href="explore-sparsity.html#cb90-5"></a> <span class="dt">onese=</span><span class="kw">c</span>(<span class="dt">cv_eucg=</span>cv_lassoR2_1se_auc, <span class="dt">test_auc=</span>test_pred_1se_auc)<span class="op">*</span><span class="dv">100</span>,</span>
<span id="cb90-6"><a href="explore-sparsity.html#cb90-6"></a> <span class="dt">min=</span><span class="kw">c</span>(<span class="dt">cv_eucg=</span>cv_lassoR2_min_auc, <span class="dt">test_auc=</span>test_pred_min_auc)<span class="op">*</span><span class="dv">100</span></span>
<span id="cb90-7"><a href="explore-sparsity.html#cb90-7"></a>),</span>
<span id="cb90-8"><a href="explore-sparsity.html#cb90-8"></a> <span class="dt">caption=</span><span class="st">&quot;CV vs test Errors&quot;</span>, <span class="dt">digits=</span><span class="dv">1</span></span>
<span id="cb90-9"><a href="explore-sparsity.html#cb90-9"></a>) <span class="op">%&gt;%</span></span>
<span id="cb90-10"><a href="explore-sparsity.html#cb90-10"></a><span class="st">  </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F)</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:lookLassoR2">Table 4.10: </span>CV vs test Errors
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
cv_eucg
</th>
<th style="text-align:right;">
test_auc
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
onese
</td>
<td style="text-align:right;">
97.3
</td>
<td style="text-align:right;">
95.8
</td>
</tr>
<tr>
<td style="text-align:left;">
min
</td>
<td style="text-align:right;">
97.7
</td>
<td style="text-align:right;">
95.6
</td>
</tr>
</tbody>
</table>
<p>Look at confusion matrices</p>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:confMtxTrainLasso2">Table 4.11: </span>cv lasso confusion matrix: train set
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Control
</th>
<th style="text-align:right;">
HCC
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Control
</td>
<td style="text-align:right;">
614
</td>
<td style="text-align:right;">
48
</td>
</tr>
<tr>
<td style="text-align:left;">
HCC
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
396
</td>
</tr>
</tbody>
</table>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:confMtxTrainLassoR2">Table 4.12: </span>cv lassoR2 confusion matrix: train set
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Control
</th>
<th style="text-align:right;">
HCC
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Control
</td>
<td style="text-align:right;">
608
</td>
<td style="text-align:right;">
39
</td>
</tr>
<tr>
<td style="text-align:left;">
HCC
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
405
</td>
</tr>
</tbody>
</table>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:confMtxTestLasso2">Table 4.13: </span>cv lasso confusion matrix: test set
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Control
</th>
<th style="text-align:right;">
HCC
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Control
</td>
<td style="text-align:right;">
148
</td>
<td style="text-align:right;">
25
</td>
</tr>
<tr>
<td style="text-align:left;">
HCC
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
86
</td>
</tr>
</tbody>
</table>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:confMtxTestlassoR2">Table 4.14: </span>cv lassoR2 confusion matrix: test set
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Control
</th>
<th style="text-align:right;">
HCC
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Control
</td>
<td style="text-align:right;">
147
</td>
<td style="text-align:right;">
19
</td>
</tr>
<tr>
<td style="text-align:left;">
HCC
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
92
</td>
</tr>
</tbody>
</table>
<p>In all models the sensitivity weak compared to the specificity. Let’s examine the
ROC curves to see where the trade-off is.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="modeling-background.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="examine-feature-selection.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["HCC5hmCExplore.pdf", "HCC5hmCExplore.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
