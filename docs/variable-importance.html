<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 6 Variable importance | DNA Hydroxymethylation in Hepatocellular Carcinoma</title>
  <meta name="description" content="Data from Cai et al. (2019) paper are explored" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 6 Variable importance | DNA Hydroxymethylation in Hepatocellular Carcinoma" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Data from Cai et al. (2019) paper are explored" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 6 Variable importance | DNA Hydroxymethylation in Hepatocellular Carcinoma" />
  
  <meta name="twitter:description" content="Data from Cai et al. (2019) paper are explored" />
  

<meta name="author" content="Francois Collin" />


<meta name="date" content="2020-01-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="model-suite.html"/>
<link rel="next" href="conclusions.html"/>
<script src="libs/header-attrs-2.2/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script type="text/javascript">
// source:https://stackoverflow.com/questions/45360998/code-folding-in-bookdown
// toggle visibility of R source blocks in R Markdown output
function toggle_R() {
  var x = document.getElementsByClassName('r');
  if (x.length == 0) return;
  function toggle_vis(o) {
    var d = o.style.display;
    o.style.display = (d == 'block' || d == '') ? 'none':'block';
  }

  for (i = 0; i < x.length; i++) {
    var y = x[i];
    if (y.tagName.toLowerCase() === 'pre') toggle_vis(y);
  }

    var elem = document.getElementById("myButton1");
    if (elem.value === "Hide Global") elem.value = "Show Global";
    else elem.value = "Hide Global";
}

document.write('<input onclick="toggle_R();" type="button" value="Hide Global" id="myButton1" style="position: absolute; top: 10%; right: 2%; z-index: 200"></input>')

</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">DNA Hydroxymethylation in Hepatocellular Carcinoma</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preamble</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="modeling-background.html"><a href="modeling-background.html"><i class="fa fa-check"></i><b>2</b> Classification Analysis in the <code>n &lt;&lt; p</code> Context</a>
<ul>
<li class="chapter" data-level="2.1" data-path="modeling-background.html"><a href="modeling-background.html#caret-for-model-evaluation"><i class="fa fa-check"></i><b>2.1</b> caret for model evaluation</a></li>
<li class="chapter" data-level="2.2" data-path="modeling-background.html"><a href="modeling-background.html#the-glmnet-r-package"><i class="fa fa-check"></i><b>2.2</b> The <code>glmnet</code> R package</a>
<ul>
<li><a href="modeling-background.html#alpha-hyper-parameter"><strong>alpha</strong> hyper-parameter</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="modeling-background.html"><a href="modeling-background.html#signal-to-noise"><i class="fa fa-check"></i><b>2.3</b> Signal-to-noise Ratio</a></li>
<li class="chapter" data-level="2.4" data-path="modeling-background.html"><a href="modeling-background.html#lasso-vs-best-sub"><i class="fa fa-check"></i><b>2.4</b> Lasso vs Best Subset</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="preproc.html"><a href="preproc.html"><i class="fa fa-check"></i><b>3</b> 5hmc Data Preprocessing</a>
<ul>
<li class="chapter" data-level="3.1" data-path="preproc.html"><a href="preproc.html#load-the-data"><i class="fa fa-check"></i><b>3.1</b> Load the data</a></li>
<li class="chapter" data-level="3.2" data-path="preproc.html"><a href="preproc.html#dra"><i class="fa fa-check"></i><b>3.2</b> Differential representation analysis</a>
<ul>
<li class="chapter" data-level="" data-path="preproc.html"><a href="preproc.html#remove-lowly-expressed-genes"><i class="fa fa-check"></i>Remove lowly expressed genes</a></li>
<li class="chapter" data-level="" data-path="preproc.html"><a href="preproc.html#creating-a-design-matrix-and-contrasts"><i class="fa fa-check"></i>Creating a design matrix and contrasts</a></li>
<li class="chapter" data-level="" data-path="preproc.html"><a href="preproc.html#removing-heteroscedasticity-from-the-count-data"><i class="fa fa-check"></i>Removing heteroscedasticity from the count data</a></li>
<li class="chapter" data-level="" data-path="preproc.html"><a href="preproc.html#fit-linear-models-and-examine-the-results"><i class="fa fa-check"></i>Fit linear models and examine the results</a></li>
<li class="chapter" data-level="" data-path="preproc.html"><a href="preproc.html#graphical-representations-of-de-results-md-plots"><i class="fa fa-check"></i>Graphical representations of DE results: MD Plots</a></li>
<li class="chapter" data-level="" data-path="preproc.html"><a href="preproc.html#de-genes-at-10-fold-change"><i class="fa fa-check"></i>DE genes at 10% fold change</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="preproc.html"><a href="preproc.html#snr-regime"><i class="fa fa-check"></i><b>3.3</b> Signal-to-noise ratio regime</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="explore-sparsity.html"><a href="explore-sparsity.html"><i class="fa fa-check"></i><b>4</b> The bet on sparsity</a>
<ul>
<li class="chapter" data-level="4.1" data-path="explore-sparsity.html"><a href="explore-sparsity.html#cross-validation-analysis-setup"><i class="fa fa-check"></i><b>4.1</b> Cross-validation analysis setup</a></li>
<li class="chapter" data-level="4.2" data-path="explore-sparsity.html"><a href="explore-sparsity.html#fit-and-compare-models"><i class="fa fa-check"></i><b>4.2</b> Fit and compare models</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="explore-sparsity.html"><a href="explore-sparsity.html#logistic-regression-in-glmnet"><i class="fa fa-check"></i><b>4.2.1</b> Logistic regression in <code>glmnet</code></a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="explore-sparsity.html"><a href="explore-sparsity.html#the-relaxed-lasso-and-blended-mix-models"><i class="fa fa-check"></i><b>4.3</b> The relaxed lasso and blended mix models</a></li>
<li class="chapter" data-level="4.4" data-path="explore-sparsity.html"><a href="explore-sparsity.html#examination-of-sensitivity-vs-specificity"><i class="fa fa-check"></i><b>4.4</b> Examination of sensitivity vs specificity</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="explore-sparsity.html"><a href="explore-sparsity.html#training-data-out-of-fold-roc-curves"><i class="fa fa-check"></i><b>4.4.1</b> Training data out-of-fold ROC curves</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="explore-sparsity.html"><a href="explore-sparsity.html#compare-predictions-at-misclassified-samples"><i class="fa fa-check"></i><b>4.5</b> Compare predictions at misclassified samples</a></li>
<li class="chapter" data-level="4.6" data-path="explore-sparsity.html"><a href="explore-sparsity.html#compare-coefficient-profiles"><i class="fa fa-check"></i><b>4.6</b> Compare coefficient profiles</a></li>
<li class="chapter" data-level="4.7" data-path="explore-sparsity.html"><a href="explore-sparsity.html#examine-feature-selection"><i class="fa fa-check"></i><b>4.7</b> Examine feature selection</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="model-suite.html"><a href="model-suite.html"><i class="fa fa-check"></i><b>5</b> Sample size investigation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="model-suite.html"><a href="model-suite.html#full-data-set-fit"><i class="fa fa-check"></i><b>5.1</b> Full data set fit</a>
<ul>
<li class="chapter" data-level="" data-path="model-suite.html"><a href="model-suite.html#get-sample-quality-scores"><i class="fa fa-check"></i>Get sample quality scores</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="model-suite.html"><a href="model-suite.html#selected-feature-list-stability"><i class="fa fa-check"></i><b>5.2</b> Selected feature list stability</a></li>
<li class="chapter" data-level="5.3" data-path="model-suite.html"><a href="model-suite.html#simulation-design"><i class="fa fa-check"></i><b>5.3</b> Simulation Design</a></li>
<li class="chapter" data-level="5.4" data-path="model-suite.html"><a href="model-suite.html#setup-simulation"><i class="fa fa-check"></i><b>5.4</b> Setup simulation</a></li>
<li class="chapter" data-level="5.5" data-path="model-suite.html"><a href="model-suite.html#run-simulations"><i class="fa fa-check"></i><b>5.5</b> Run simulations</a></li>
<li class="chapter" data-level="5.6" data-path="model-suite.html"><a href="model-suite.html#simulation-results"><i class="fa fa-check"></i><b>5.6</b> Simulation results</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="model-suite.html"><a href="model-suite.html#simulation-results---look-at-one-simulation"><i class="fa fa-check"></i><b>5.6.1</b> Simulation Results - look at one simulation</a></li>
<li class="chapter" data-level="5.6.2" data-path="model-suite.html"><a href="model-suite.html#summarize-results-across-simulation-runs."><i class="fa fa-check"></i><b>5.6.2</b> Summarize results across simulation runs.</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="model-suite.html"><a href="model-suite.html#effect-of-sample-quality"><i class="fa fa-check"></i><b>5.7</b> Effect of sample quality</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="variable-importance.html"><a href="variable-importance.html"><i class="fa fa-check"></i><b>6</b> Variable importance</a>
<ul>
<li class="chapter" data-level="" data-path="variable-importance.html"><a href="variable-importance.html#in-progess"><i class="fa fa-check"></i>IN PROGESS</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="conclusions.html"><a href="conclusions.html"><i class="fa fa-check"></i><b>7</b> Conclusions</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="" data-path="appendix-1.html"><a href="appendix-1.html"><i class="fa fa-check"></i>Appendix 1 - Sample size in elastic net fits</a>
<ul>
<li class="chapter" data-level="" data-path="appendix-1.html"><a href="appendix-1.html#selected-feature-list-stability-1"><i class="fa fa-check"></i>Selected feature list stability</a></li>
<li class="chapter" data-level="" data-path="appendix-1.html"><a href="appendix-1.html#run-simulations---enet"><i class="fa fa-check"></i>Run simulations - enet</a></li>
<li class="chapter" data-level="" data-path="appendix-1.html"><a href="appendix-1.html#enet-simulation-results"><i class="fa fa-check"></i>enet Simulation results</a>
<ul>
<li class="chapter" data-level="" data-path="appendix-1.html"><a href="appendix-1.html#simulation-results---look-at-one-simulation-1"><i class="fa fa-check"></i>Simulation Results - look at one simulation</a></li>
<li class="chapter" data-level="" data-path="appendix-1.html"><a href="appendix-1.html#summarize-results-across-simulation-runs"><i class="fa fa-check"></i>Summarize results across simulation runs</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="LICENSE.md" style="font:em;" target="blank">Copyright (c) 2020 Francois Collin</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">DNA Hydroxymethylation in Hepatocellular Carcinoma</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="variable-importance" class="section level1" number="6">
<h1><span class="header-section-number">Section 6</span> Variable importance</h1>
<p>Cai et al. <span class="citation">[<a href="references.html#ref-Cai:2019aa" role="doc-biblioref">2</a>]</span> used the fequency of selection across
bootstrap replicates to select features from their final model.
We suspect that this simply selects features with large coefficients
which would correspond the the variable importance metric
used in the <code>caret</code> package.</p>
<p>In this section we measure variable importance as the loss in performance when the variable is left out
of the model. Depending on the correlation structure, it is quite possible
for a feature to have a large coefficient and be un-important, in our sense of the word.
It is also possible for a feature to be frequently selected in bootstrap samples, and
still not un-important. In a sense, this measure of importance is really a measure
of <code>single importance</code>. We should therefore also have a measure of <code>group importance</code>.</p>
<p>For this exercise, we will use the min lambda error assessment as it has
lower variability across repeated cv fits.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="variable-importance.html#cb107-1"></a><span class="co">### CLEAR CACHE</span></span>
<span id="cb107-2"><a href="variable-importance.html#cb107-2"></a></span>
<span id="cb107-3"><a href="variable-importance.html#cb107-3"></a></span>
<span id="cb107-4"><a href="variable-importance.html#cb107-4"></a><span class="co"># min</span></span>
<span id="cb107-5"><a href="variable-importance.html#cb107-5"></a>lassoAll_coef_min_lst &lt;-<span class="st"> </span><span class="kw">lapply</span>(cv_lassoAll_lst, <span class="cf">function</span>(cv_fit){</span>
<span id="cb107-6"><a href="variable-importance.html#cb107-6"></a> cv_fit_coef &lt;-<span class="st"> </span><span class="kw">coef</span>(</span>
<span id="cb107-7"><a href="variable-importance.html#cb107-7"></a> cv_fit,</span>
<span id="cb107-8"><a href="variable-importance.html#cb107-8"></a> <span class="dt">s =</span> <span class="st">&quot;lambda.min&quot;</span></span>
<span id="cb107-9"><a href="variable-importance.html#cb107-9"></a> )</span>
<span id="cb107-10"><a href="variable-importance.html#cb107-10"></a> cv_fit_coef<span class="op">@</span>Dimnames[[<span class="dv">1</span>]][cv_fit_coef<span class="op">@</span>i[<span class="op">-</span><span class="dv">1</span>]]</span>
<span id="cb107-11"><a href="variable-importance.html#cb107-11"></a> })</span>
<span id="cb107-12"><a href="variable-importance.html#cb107-12"></a></span>
<span id="cb107-13"><a href="variable-importance.html#cb107-13"></a></span>
<span id="cb107-14"><a href="variable-importance.html#cb107-14"></a></span>
<span id="cb107-15"><a href="variable-importance.html#cb107-15"></a><span class="co"># min</span></span>
<span id="cb107-16"><a href="variable-importance.html#cb107-16"></a>lassoAll_coefVal_min_lst &lt;-<span class="st"> </span><span class="kw">lapply</span>(cv_lassoAll_lst, <span class="cf">function</span>(cv_fit){</span>
<span id="cb107-17"><a href="variable-importance.html#cb107-17"></a> cv_fit_coef &lt;-<span class="st"> </span><span class="kw">coef</span>(</span>
<span id="cb107-18"><a href="variable-importance.html#cb107-18"></a> cv_fit,</span>
<span id="cb107-19"><a href="variable-importance.html#cb107-19"></a> <span class="dt">s =</span> <span class="st">&quot;lambda.min&quot;</span></span>
<span id="cb107-20"><a href="variable-importance.html#cb107-20"></a> )</span>
<span id="cb107-21"><a href="variable-importance.html#cb107-21"></a> coef_vec &lt;-<span class="st"> </span>cv_fit_coef<span class="op">@</span>x[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb107-22"><a href="variable-importance.html#cb107-22"></a> <span class="kw">names</span>(coef_vec) &lt;-<span class="st">  </span>cv_fit_coef<span class="op">@</span>Dimnames[[<span class="dv">1</span>]][cv_fit_coef<span class="op">@</span>i[<span class="op">-</span><span class="dv">1</span>]]</span>
<span id="cb107-23"><a href="variable-importance.html#cb107-23"></a></span>
<span id="cb107-24"><a href="variable-importance.html#cb107-24"></a> coef_vec</span>
<span id="cb107-25"><a href="variable-importance.html#cb107-25"></a> })</span>
<span id="cb107-26"><a href="variable-importance.html#cb107-26"></a></span>
<span id="cb107-27"><a href="variable-importance.html#cb107-27"></a></span>
<span id="cb107-28"><a href="variable-importance.html#cb107-28"></a></span>
<span id="cb107-29"><a href="variable-importance.html#cb107-29"></a><span class="co"># put feature occurence into matrix</span></span>
<span id="cb107-30"><a href="variable-importance.html#cb107-30"></a>lassoAll_coef_min_all &lt;-<span class="st"> </span><span class="kw">Reduce</span>(union, lassoAll_coef_min_lst)</span>
<span id="cb107-31"><a href="variable-importance.html#cb107-31"></a>lassoAll_coef_min_mtx &lt;-<span class="st"> </span><span class="kw">sapply</span>(lassoAll_coef_min_lst, </span>
<span id="cb107-32"><a href="variable-importance.html#cb107-32"></a>  <span class="cf">function</span>(LL) <span class="kw">is.element</span>(lassoAll_coef_min_all, LL)</span>
<span id="cb107-33"><a href="variable-importance.html#cb107-33"></a>)</span>
<span id="cb107-34"><a href="variable-importance.html#cb107-34"></a><span class="kw">rownames</span>(lassoAll_coef_min_mtx) &lt;-<span class="st"> </span>lassoAll_coef_min_all</span>
<span id="cb107-35"><a href="variable-importance.html#cb107-35"></a></span>
<span id="cb107-36"><a href="variable-importance.html#cb107-36"></a><span class="co"># put festures coefficients into matrix</span></span>
<span id="cb107-37"><a href="variable-importance.html#cb107-37"></a>lassoAll_coefVal_lse_mtx &lt;-<span class="st"> </span><span class="kw">matrix</span>(</span>
<span id="cb107-38"><a href="variable-importance.html#cb107-38"></a> <span class="dt">nrow=</span><span class="kw">nrow</span>(lassoAll_coef_min_mtx), </span>
<span id="cb107-39"><a href="variable-importance.html#cb107-39"></a> <span class="dt">ncol=</span><span class="kw">ncol</span>(lassoAll_coef_min_mtx))</span>
<span id="cb107-40"><a href="variable-importance.html#cb107-40"></a><span class="kw">rownames</span>(lassoAll_coefVal_lse_mtx) &lt;-<span class="st"> </span><span class="kw">rownames</span>(lassoAll_coef_min_mtx)</span>
<span id="cb107-41"><a href="variable-importance.html#cb107-41"></a></span>
<span id="cb107-42"><a href="variable-importance.html#cb107-42"></a><span class="cf">for</span>(FF <span class="cf">in</span> <span class="kw">rownames</span>(lassoAll_coefVal_lse_mtx))</span>
<span id="cb107-43"><a href="variable-importance.html#cb107-43"></a><span class="cf">for</span>(SIM <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(lassoAll_coefVal_lse_mtx))</span>
<span id="cb107-44"><a href="variable-importance.html#cb107-44"></a>lassoAll_coefVal_lse_mtx[FF, SIM] &lt;-<span class="st"> </span>lassoAll_coefVal_min_lst[[SIM]][FF]</span>
<span id="cb107-45"><a href="variable-importance.html#cb107-45"></a>lassoAll_coefVal_lse_mtx[<span class="kw">is.na</span>(lassoAll_coefVal_lse_mtx)] &lt;-<span class="st"> </span><span class="dv">0</span></span></code></pre></div>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="variable-importance.html#cb108-1"></a><span class="co"># order by selection frequencey</span></span>
<span id="cb108-2"><a href="variable-importance.html#cb108-2"></a>feature_freq_vec &lt;-<span class="st"> </span><span class="kw">rowSums</span>(<span class="kw">abs</span>(lassoAll_coefVal_lse_mtx) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb108-3"><a href="variable-importance.html#cb108-3"></a><span class="co">#table(feature_freq_vec)</span></span>
<span id="cb108-4"><a href="variable-importance.html#cb108-4"></a></span>
<span id="cb108-5"><a href="variable-importance.html#cb108-5"></a>feature_o &lt;-<span class="st"> </span><span class="kw">order</span>(feature_freq_vec)</span>
<span id="cb108-6"><a href="variable-importance.html#cb108-6"></a></span>
<span id="cb108-7"><a href="variable-importance.html#cb108-7"></a><span class="kw">boxplot</span>(</span>
<span id="cb108-8"><a href="variable-importance.html#cb108-8"></a>   <span class="kw">t</span>(lassoAll_coefVal_lse_mtx)[,feature_o], </span>
<span id="cb108-9"><a href="variable-importance.html#cb108-9"></a>   <span class="dt">ylab=</span><span class="st">&#39;Coefficient&#39;</span>, <span class="dt">xlab=</span><span class="st">&#39;Frequency of selection&#39;</span>,</span>
<span id="cb108-10"><a href="variable-importance.html#cb108-10"></a>   <span class="dt">xaxt=</span><span class="st">&#39;n&#39;</span>, </span>
<span id="cb108-11"><a href="variable-importance.html#cb108-11"></a>   <span class="dt">outline=</span>F)</span>
<span id="cb108-12"><a href="variable-importance.html#cb108-12"></a><span class="kw">abline</span>(<span class="dt">h=</span><span class="dv">0</span>, <span class="dt">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb108-13"><a href="variable-importance.html#cb108-13"></a><span class="kw">axis</span>(</span>
<span id="cb108-14"><a href="variable-importance.html#cb108-14"></a> <span class="dt">side=</span><span class="dv">1</span>, </span>
<span id="cb108-15"><a href="variable-importance.html#cb108-15"></a> <span class="dt">at=</span><span class="kw">match</span>(<span class="kw">unique</span>(feature_freq_vec), <span class="kw">sort</span>(feature_freq_vec)),</span>
<span id="cb108-16"><a href="variable-importance.html#cb108-16"></a> <span class="kw">unique</span>(feature_freq_vec))</span></code></pre></div>
<div class="figure"><span id="fig:varOccurence"></span>
<img src="Static/figures/varOccurence-1.png" alt="one-standard-error rule lasso feature selection" width="672" />
<p class="caption">
Figure 6.1: one-standard-error rule lasso feature selection
</p>
</div>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="variable-importance.html#cb109-1"></a> <span class="co">#title(&quot;one-standard-error rule lasso feature selection&quot;)</span></span></code></pre></div>
<p>As we suspected, features with large absolute regularized coefficients tend to
be selected more frequently across repreated cross validated fits. So essntially,
the Cai et al. frequecny filter is essentially a size of coefficient filter.</p>
<p>We not turn to this other notion of variable importance: what is the increase in
error rate when each variable is excluded from the fit. We will us cv error rates in
the one-standard-error rule lasso models for this assessment. As this computation
will be pretty costly, we will select 30 features from different
selection frequency blocks</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="variable-importance.html#cb110-1"></a>selFreq_bin_vec &lt;-<span class="st"> </span><span class="kw">cut</span>(feature_freq_vec, <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">29</span>,<span class="dv">30</span>))</span>
<span id="cb110-2"><a href="variable-importance.html#cb110-2"></a><span class="co">#table(selFreq_bin_vec)</span></span>
<span id="cb110-3"><a href="variable-importance.html#cb110-3"></a></span>
<span id="cb110-4"><a href="variable-importance.html#cb110-4"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb110-5"><a href="variable-importance.html#cb110-5"></a>sel_features_lst &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">split</span>(feature_freq_vec, selFreq_bin_vec),</span>
<span id="cb110-6"><a href="variable-importance.html#cb110-6"></a>  <span class="cf">function</span>(FF) <span class="kw">sample</span>(FF, <span class="dt">size=</span><span class="dv">5</span>))</span>
<span id="cb110-7"><a href="variable-importance.html#cb110-7"></a></span>
<span id="cb110-8"><a href="variable-importance.html#cb110-8"></a><span class="kw">cat</span>(<span class="st">&quot;List of features to assess picked by frequency of lasso selection:</span><span class="ch">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## List of features to assess picked by frequency of lasso selection:</code></pre>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="variable-importance.html#cb112-1"></a>sel_features_lst</span></code></pre></div>
<pre><code>## $`(0,10]`
##   TRH PRR19 TUBA8  RHOH CCBL2 
##     3     2     6     9     5 
## 
## $`(10,15]`
## ARHGAP11B     CDC26    ZNF335   PPP2R1A    TRIM61 
##        15        12        13        15        15 
## 
## $`(15,20]`
## RP11-136C24.3          PAK2         HERC2        ZBTB17         ABCA5 
##            20            18            18            20            20 
## 
## $`(20,25]`
##   LMBR1L ATP6V1C2  DEFB132    LPAR3  RALGPS1 
##       24       21       24       21       24 
## 
## $`(25,29]`
## MEIS2 ADNP2  MSR1 CRYGA ACSL5 
##    29    26    29    28    29 
## 
## $`(29,30]`
## JAKMIP2   CEP83    NEK3    TDP2 C5orf47 
##      30      30      30      30      30</code></pre>
<p>For each selected feature, run 10 cv fits with 30 lambda values, and compute the
min lambda error.</p>
<div id="in-progess" class="section level2 unnumbered" number="">
<h2>IN PROGESS</h2>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="variable-importance.html#cb114-1"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb114-2"><a href="variable-importance.html#cb114-2"></a></span>
<span id="cb114-3"><a href="variable-importance.html#cb114-3"></a>start_time &lt;-<span class="st">  </span><span class="kw">proc.time</span>()</span>
<span id="cb114-4"><a href="variable-importance.html#cb114-4"></a></span>
<span id="cb114-5"><a href="variable-importance.html#cb114-5"></a>cv_lassoLOO_lst  &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">as.vector</span>(<span class="kw">sapply</span>(sel_features_lst, names)),</span>
<span id="cb114-6"><a href="variable-importance.html#cb114-6"></a> <span class="cf">function</span>(FF) {</span>
<span id="cb114-7"><a href="variable-importance.html#cb114-7"></a>  FF_ndx &lt;-<span class="st"> </span><span class="kw">match</span>(FF, <span class="kw">colnames</span>(all_lcpm_mtx))</span>
<span id="cb114-8"><a href="variable-importance.html#cb114-8"></a></span>
<span id="cb114-9"><a href="variable-importance.html#cb114-9"></a>  cv_lassoMFF_lst &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="cf">function</span>(REP) {</span>
<span id="cb114-10"><a href="variable-importance.html#cb114-10"></a>  glmnet<span class="op">::</span><span class="kw">cv.glmnet</span>(</span>
<span id="cb114-11"><a href="variable-importance.html#cb114-11"></a>   <span class="dt">x =</span> all_lcpm_mtx[,<span class="op">-</span>FF_ndx],</span>
<span id="cb114-12"><a href="variable-importance.html#cb114-12"></a>   <span class="dt">y =</span> <span class="kw">factor</span>(all_group_vec,<span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&#39;Control&#39;</span>, <span class="st">&#39;HCC&#39;</span>)),</span>
<span id="cb114-13"><a href="variable-importance.html#cb114-13"></a>   <span class="dt">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb114-14"><a href="variable-importance.html#cb114-14"></a>   <span class="dt">family =</span> <span class="st">&#39;binomial&#39;</span>,</span>
<span id="cb114-15"><a href="variable-importance.html#cb114-15"></a>   <span class="dt">type.measure  =</span>  <span class="st">&quot;class&quot;</span>,</span>
<span id="cb114-16"><a href="variable-importance.html#cb114-16"></a>   <span class="dt">keep =</span> F,</span>
<span id="cb114-17"><a href="variable-importance.html#cb114-17"></a>   <span class="dt">nlambda =</span> <span class="dv">10</span></span>
<span id="cb114-18"><a href="variable-importance.html#cb114-18"></a>   )</span>
<span id="cb114-19"><a href="variable-importance.html#cb114-19"></a>  })</span>
<span id="cb114-20"><a href="variable-importance.html#cb114-20"></a> </span>
<span id="cb114-21"><a href="variable-importance.html#cb114-21"></a>  <span class="kw">cbind</span>(</span>
<span id="cb114-22"><a href="variable-importance.html#cb114-22"></a> <span class="st">`</span><span class="dt">1se</span><span class="st">`</span> =<span class="st"> </span><span class="kw">sapply</span>(cv_lassoMFF_lst, <span class="cf">function</span>(LL) </span>
<span id="cb114-23"><a href="variable-importance.html#cb114-23"></a>          LL<span class="op">$</span>cvm[LL<span class="op">$</span>lambda<span class="op">==</span>LL<span class="op">$</span>lambda<span class="fl">.1</span>se]),</span>
<span id="cb114-24"><a href="variable-importance.html#cb114-24"></a>  <span class="st">`</span><span class="dt">min</span><span class="st">`</span> =<span class="st"> </span><span class="kw">sapply</span>(cv_lassoMFF_lst, <span class="cf">function</span>(LL)</span>
<span id="cb114-25"><a href="variable-importance.html#cb114-25"></a>          LL<span class="op">$</span>cvm[LL<span class="op">$</span>lambda<span class="op">==</span>LL<span class="op">$</span>lambda<span class="fl">.1</span>se])</span>
<span id="cb114-26"><a href="variable-importance.html#cb114-26"></a>  )</span>
<span id="cb114-27"><a href="variable-importance.html#cb114-27"></a>  })</span>
<span id="cb114-28"><a href="variable-importance.html#cb114-28"></a></span>
<span id="cb114-29"><a href="variable-importance.html#cb114-29"></a>   <span class="kw">save</span>(<span class="dt">list=</span><span class="st">&#39;cv_lassoMFF_lst&#39;</span>, <span class="dt">file=</span><span class="kw">file.path</span>(<span class="st">&quot;RData&quot;</span>,<span class="st">&#39;cv_lassoMFF_lst&#39;</span>))</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="model-suite.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="conclusions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["HCC5hmCExplore.pdf", "HCC5hmCExplore.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
