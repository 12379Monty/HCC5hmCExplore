# The bet on sparsity {#explore-sparsity}

We explore some glmnet fits and the "bet on sparsity"  

* All fits must be assessed by cv and test set    
* Do sparse models produced by lasso ($\alpha = 1.0$) perform better than ridge ($\alpha = 0$) or ridge-lasso ($\alpha = 0.5$)?  
* Does the relaxed lasso improve performance?  
* How sparse is the model undelying best 5hmC classifier for Early HCC vs Control?  
* Is the degree of sparsity, or the size of the model, a stable feature of the problem and data set?

First we divide the analysis dataset into `train` and `test` in a 4:1 ratio.  Here `test` will
play the role of the external test set used to provide an independent assessment data set.
```{r getTrainVal, cache=T, cache.vars=c('sampID_train_vec', 'sampID_val_vec','group_train_vec','group_test_vec','train_lcpm_mtx','test_lcpm_mtx')}

set.seed(1)
sampID_train_vec <- with(AF_dgel$samples,
AF_dgel$samples$sampID[caret::createDataPartition(y=group, p=0.8, list=F)]
)

sampID_test_vec <- with(AF_dgel$samples,
setdiff(sampID, sampID_train_vec)
)

group_train_vec <- AF_dgel$samples[sampID_train_vec, 'group']
group_test_vec <- AF_dgel$samples[sampID_test_vec, 'group']

knitr::kable(table(group_train_vec),
  caption="Train set") %>%
   kableExtra::kable_styling(full_width = F)

knitr::kable(table(group_test_vec),
  caption="Test set") %>%
   kableExtra::kable_styling(full_width = F)

train_lcpm_mtx <- t(lcpm_mtx[,sampID_train_vec])
test_lcpm_mtx <- t(lcpm_mtx[,sampID_test_vec])

```


## Baseline lasso fit

* Cross-validated accuracy
* sparsity
* test set accuracy  

```{r lassoFit, cache=T, cache.vars='AF_lasso_cvfit', fig.height=5, fig.width=6, fig.cap="lasso fit the train set with cv"}
require(doMC)
registerDoMC(cores=14)


AF_lasso_cvfit <- glmnet::cv.glmnet(
 x=train_lcpm_mtx,
 y=group_train_vec,
 family='binomial', alpha=1,
 type.measure = "class")

 lambda.1se <- AF_lasso_cvfit$lambda.1se
 lambda.1se_p <- sum(abs(coef(AF_lasso_cvfit, s = AF_lasso_cvfit$lambda.1se))>0)

plot(
 AF_lasso_cvfit, 
 sub=paste("cv lambda.1se =", round(lambda.1se, 2), "; p =", lambda.1se_p)
)


```


## Relaxed lasso 

## Shrunken relaxed lasso

## ridge

## ridge-lasso

## Sparsity stability


